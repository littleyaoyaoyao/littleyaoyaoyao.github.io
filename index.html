<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>We-Param</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="New Land">
<meta property="og:type" content="website">
<meta property="og:title" content="We-Param">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="We-Param">
<meta property="og:description" content="New Land">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="We-Param">
<meta name="twitter:description" content="New Land">
  
    <link rel="alternate" href="/atom.xml" title="We-Param" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">We-Param</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-Redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/05/Redis/" class="article-date">
  <time datetime="2017-07-05T12:55:12.075Z" itemprop="datePublished">2017-07-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/05/Redis/">Redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Redis</p>
<hr>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>Redis是一个key-value数据库，支持<em>持久化</em>、<em>数据备份</em>等。</p>
<p>Redis运行在内存中但可以持久化到硬盘中，并且在内存中可以完成很多复杂性强的工作。</p>
<p>Redis有五种数据结构：<strong>字符串String、列表List、哈希表Hash、集合Set、有序集合ZSet</strong>。</p>
<p>Redis不使用表，它的数据库也没有预定义或者强制的方式来要求用户关联Redis存储的不同数据</p>
<p>使用Redis而不是关系数据库或者其他磁盘存储数据库，可以避免写入不必要的临时数据，也免去了对临时数据进行扫描或者删除的麻烦，并最终改善程序的性能。</p>
<ul>
<li><strong>使用场景：</strong><br>缓存（数据查询、短连接、新闻内容、商品内容等等）。（最多使用）<br>分布式集群架构中的session分离。<br>聊天室的在线好友列表。<br>任务队列。（秒杀、抢购、12306等等）<br>应用排行榜。<br>网站访问统计。<br>数据过期处理（可以精确到毫秒）</li>
</ul>
<h2 id="1-Redis的单机版"><a href="#1-Redis的单机版" class="headerlink" title="1. Redis的单机版"></a>1. Redis的单机版</h2><p><strong>安装步骤</strong>：</p>
<ol>
<li>安装gcc编译环境<br>yum install gcc-c++</li>
<li>把redis源码上传到服务器</li>
<li>解压缩<br>tar -zxvf redis-3.0.0.tar.gz</li>
<li>make</li>
<li>make install PREFIX=/usr/local(要安装的位置)</li>
</ol>
<p><strong>启动redis:</strong></p>
<p>前端启动：./redis-server</p>
<p>后台启动：<br>将redis解压后的源码包中的redis.conf拷贝到bin目录下，编辑此文件：daemonize yes<br>./redis-server redis.conf</p>
<p><strong>关闭:</strong><br>强制关闭：kill -9 进程号<br>正常关闭：./redis-cli shutdown</p>
<p>在项目中，建议使用正常关闭。因为redis作为缓存来使用的话，将数据存储到内存中，如果使用正常关闭，则会将内存数据持久化到本地之后再关闭；若是强制关闭，可能会导致部分数据的丢失。</p>
<h2 id="2-Redis客户端"><a href="#2-Redis客户端" class="headerlink" title="2. Redis客户端"></a>2. Redis客户端</h2><h3 id="2-1-启动客户端命令："><a href="#2-1-启动客户端命令：" class="headerlink" title="2.1 启动客户端命令："></a>2.1 启动客户端命令：</h3><p>./redis-cli-p 端口 -h ip地址 &lt;-c&gt;连接集群时使用此参数<br>（其中，-h表示指定访问的redis服务器的ip地址；-p表示指定访问的redis服务器的port端口）</p>
<p><strong>默认端口是6379，ip是localhost:</strong><br>使用：./redis-cli</p>
<p><strong>关闭:</strong></p>
<ol>
<li>ctrl+c</li>
<li>127.0.0.1 &gt; quit</li>
</ol>
<h3 id="2-2-图形界面客户端"><a href="#2-2-图形界面客户端" class="headerlink" title="2.2 图形界面客户端"></a>2.2 图形界面客户端</h3><p>若连接失败，需要设置防火墙：<br>vim /etc/sysconfig/iptables<br>端口设置完成之后，需要重新启动：service iptables restart </p>
<p>redis.conf中设置了默认的数据库16个，如果不指定哪个数据库的话，就默认将数据存储到下标为0的数据库。</p>
<p><strong>redis.conf中的数据库数量的设置：</strong><br><code>databases 16</code></p>
<p><strong>redis.conf中的选择数据库的方式：</strong><br>使用select加上数据库的下标就可以选择指定的数据库来使用(下标从0开始) —&gt;<br>127.0.0.1 &gt; select 15</p>
<h3 id="2-3-Java客户端-Jedis"><a href="#2-3-Java客户端-Jedis" class="headerlink" title="2.3 Java客户端 : Jedis"></a>2.3 Java客户端 : Jedis</h3><p>使用jedis先添加两个jar包：common-pool2-2.3.jar  ， jedis-2.7.0.jar</p>
<p><strong>单实例连接redis：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisClient</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// Jedis</span></div><div class="line">		Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过redis赋值</span></div><div class="line">		jedis.set(<span class="string">"s2"</span>, <span class="string">"222"</span>);</div><div class="line">		<span class="comment">// 通过redis取值</span></div><div class="line">		String result = jedis.get(<span class="string">"s2"</span>);</div><div class="line">		System.out.println(result);</div><div class="line">		<span class="comment">// 关闭jedis</span></div><div class="line">		jedis.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p><strong>使用jedis连接池连接redis服务器:</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisPool</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// JedisPool</span></div><div class="line">		JedisPool pool = <span class="keyword">new</span> JedisPool(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过连接池获取jedis对象</span></div><div class="line">		Jedis jedis = pool.getResource();</div><div class="line"></div><div class="line">		jedis.set(<span class="string">"s4"</span>, <span class="string">"444"</span>);</div><div class="line"></div><div class="line">		String result = jedis.get(<span class="string">"s3"</span>);</div><div class="line">		System.out.println(result);</div><div class="line"></div><div class="line">		<span class="comment">// 关闭jedis客户端</span></div><div class="line">		jedis.close();</div><div class="line"></div><div class="line">		<span class="comment">// 关闭连接池</span></div><div class="line">		pool.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-Redis数据类型"><a href="#3-Redis数据类型" class="headerlink" title="3. Redis数据类型"></a>3. Redis数据类型</h2><h3 id="3-1-String类型"><a href="#3-1-String类型" class="headerlink" title="3.1 String类型"></a>3.1 String类型</h3><h3 id="3-2-Hash类型"><a href="#3-2-Hash类型" class="headerlink" title="3.2 Hash类型"></a>3.2 Hash类型</h3><h3 id="3-3-List类型"><a href="#3-3-List类型" class="headerlink" title="3.3 List类型"></a>3.3 List类型</h3><h3 id="3-3-Set类型"><a href="#3-3-Set类型" class="headerlink" title="3.3 Set类型"></a>3.3 Set类型</h3><h3 id="3-3-Zset类型"><a href="#3-3-Zset类型" class="headerlink" title="3.3 Zset类型"></a>3.3 Zset类型</h3><h2 id="4-keys命令"><a href="#4-keys命令" class="headerlink" title="4. keys命令"></a>4. keys命令</h2><p>keys：查询所有的key<br>exits：确认一个key是否存在<br>rename：重命名key<br>type：返回值的类型<br>expire：设置key的生存时间<br>ttl：查询key的生存时间</p>
<h2 id="5-redis持久化方案"><a href="#5-redis持久化方案" class="headerlink" title="5. redis持久化方案"></a>5. redis持久化方案</h2><h3 id="5-1-Rdb"><a href="#5-1-Rdb" class="headerlink" title="5.1 Rdb"></a>5.1 Rdb</h3><p>redis的默认方式，reids通过快照来将数据持久化到磁盘中。</p>
<p><strong>设置持久化快照的条件：</strong><br>在redis.conf中修改持久化快照的条件</p>
<p><strong>rdb问题：</strong><br>一旦redis非法关闭，那么会丢失最后一次持久化之后的数据。</p>
<h3 id="5-2-Aof方式"><a href="#5-2-Aof方式" class="headerlink" title="5.2 Aof方式"></a>5.2 Aof方式</h3><p>redis默认是不使用该方式持久化的。Aof方式的持久化，是操作一次redis数据库，则将操作的记录存储到aof持久化文件中。<br><code>appendonly no</code>改为<br><code>appendonly yes</code><br>加上：<br><code>appendfilename &quot;appendonly.aof&quot;</code></p>
<h3 id="5-3-总结"><a href="#5-3-总结" class="headerlink" title="5.3 总结"></a>5.3 总结</h3><p>在使用aof和rdb方式时，如果redis重启，则数据从aof中加载</p>
<h2 id="6-redis主从复制"><a href="#6-redis主从复制" class="headerlink" title="6. redis主从复制"></a>6. redis主从复制</h2><p>redis的主从复制可以避免单点故障（比如在redis服务器的磁盘损坏）。<br>一个主机可以有多个从机，主机和从机保持同步；从机也可以作为主机。</p>
<h3 id="6-1-主从复制设置"><a href="#6-1-主从复制设置" class="headerlink" title="6.1 主从复制设置"></a>6.1 主从复制设置</h3><h2 id="7-Redis集群"><a href="#7-Redis集群" class="headerlink" title="7. Redis集群"></a>7. Redis集群</h2><p>集群中应该至少有三个节点，每个节点有一备份节点。需要6台服务器。</p>
<p>步骤：</p>
<ol>
<li>创建6个redis实例，指定端口从7001到7006</li>
<li>修改redis.conf打开Cluster-enable yes前面的注释</li>
<li>需要一个ruby脚本。在redis源码文件夹下的src目录下。redis-trib.rb</li>
<li>把redis-trib.rb文件复制到到redis-cluster目录下。</li>
<li><strong>执行ruby脚本之前，需要安装ruby环境。</strong><ul>
<li>yum install ruby</li>
<li>yum install rubygems</li>
<li>安装redis-trib.rb运行依赖的ruby的包</li>
</ul>
</li>
</ol>
<p>[root@bogon ~]# gem install redis-3.0.0.gem</p>
<ol>
<li>启动所有的redis实例。 </li>
<li>使用redis-trib.rb创建集群。<br>./redis-trib.rb create –replicas 1 192.168.25.153:7001 192.168.25.153:7002 192.168.25.153:7003 192.168.25.153:7004 192.168.25.153:7005  192.168.25.153:7006</li>
</ol>
<p><strong>使用客户端连接集群： redis01/redis-cli -p 7001 -c</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/05/Redis/" data-id="cj4r0dsg3000uhgtxnnbogxiv" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis与Jedis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/Redis与Jedis/" class="article-date">
  <time datetime="2017-06-29T14:41:38.114Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/Redis与Jedis/">Redis与Jedis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： jedis redis spring</p>
<hr>
<h2 id="jedis客户端"><a href="#jedis客户端" class="headerlink" title="jedis客户端"></a>jedis客户端</h2><p>在redis搭建完后，需要在java中使用redis,我们使用jedis连接redis服务器。<br>jedis是redis的java版本的客户端实现</p>
<p><strong>jedis连接单机版和集群版有区别。</strong></p>
<h3 id="1-连接单机版"><a href="#1-连接单机版" class="headerlink" title="1 . 连接单机版"></a>1 . 连接单机版</h3><p>先把jedis依赖的jar包添加到工程中。 </p>
<h3 id="4-项目中使用jedis"><a href="#4-项目中使用jedis" class="headerlink" title="4 . 项目中使用jedis"></a>4 . 项目中使用jedis</h3><p>思路：创建一个redis操作的接口。分别创建两个实现类对应redis的单机版和集群版。当使用单机版redis时，配置单机版的实现类，当使用集群版本的时候，配置集群版的实现类。</p>
<p><strong>单机版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * redis客户端单机版实现类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientSingle</span> <span class="keyword">implements</span> <span class="title">JedisClient</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisPool jedisPool;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.set(key, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.get(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.hset(key, item, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.hget(key, item);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.incr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.decr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.expire(key, second);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.ttl(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>集群版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientCluster</span> <span class="keyword">implements</span> <span class="title">JedisClient</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.set(key, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.get(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hset(key, item, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hget(key, item);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.incr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.decr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.expire(key, second);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.ttl(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>spring的配置</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置redis客户端单机版 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPool"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"192.168.25.153"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6379"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置redis客户端实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisClientSingle"</span> <span class="attr">class</span>=<span class="string">"com.taotao.rest.component.impl.JedisClientSingle"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置redis客户端集群版 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;bean id="jedisCluster" class="redis.clients.jedis.JedisCluster"&gt;</span></div><div class="line">		&lt;constructor-arg&gt;</div><div class="line">			&lt;set&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7001"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7002"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7003"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7004"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7005"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7006"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">			&lt;/set&gt;</div><div class="line">		&lt;/constructor-arg&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	&lt;bean id="jedisClientCluster" class="com.taotao.rest.component.impl.JedisClientCluster"/&gt; --&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>若要测试单机版，将集群版进行注释即可；若要测试集群版，将单机版进行注释。</p>
<p><strong>测试</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJedisClientSpring</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">//创建一个spring容器</span></div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:spring/applicationContext-*.xml"</span>);</div><div class="line">		<span class="comment">//从容器中获得JedisClient对象</span></div><div class="line">		JedisClient jedisClient = applicationContext.getBean(JedisClient.class);</div><div class="line">		<span class="comment">//jedisClient操作redis</span></div><div class="line">		jedisClient.set(<span class="string">"cliet1"</span>, <span class="string">"1000"</span>);</div><div class="line">		String string = jedisClient.get(<span class="string">"cliet1"</span>);</div><div class="line">		System.out.println(string);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5-业务逻辑中添加缓存"><a href="#5-业务逻辑中添加缓存" class="headerlink" title="5 . 业务逻辑中添加缓存"></a>5 . 业务逻辑中添加缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;TbContent&gt; <span class="title">getContentList</span><span class="params">(Long cid)</span> </span>&#123;</div><div class="line">		<span class="comment">//添加缓存</span></div><div class="line">		<span class="comment">//查询数据库之前先查询缓存，如果有直接返回</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//从redis中取缓存数据</span></div><div class="line">			String json = jedisClient.hget(REDIS_CONTENT_KEY, cid+<span class="string">""</span>);</div><div class="line">			<span class="keyword">if</span> (!StringUtils.isBlank(json)) &#123;</div><div class="line">				<span class="comment">//把json转换成List</span></div><div class="line">				List&lt;TbContent&gt; list = JsonUtils.jsonToList(json, TbContent.class);</div><div class="line">				<span class="keyword">return</span> list;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 根据cid查询内容列表</span></div><div class="line">		TbContentExample example = <span class="keyword">new</span> TbContentExample();</div><div class="line">		Criteria criteria = example.createCriteria();</div><div class="line">		criteria.andCategoryIdEqualTo(cid);</div><div class="line">		<span class="comment">//执行查询</span></div><div class="line">		List&lt;TbContent&gt; list = contentMapper.selectByExampleWithBLOBs(example);</div><div class="line">		</div><div class="line">		<span class="comment">//返回结果之前，向缓存中添加数据</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//为了规范key可以使用hash</span></div><div class="line">			<span class="comment">//定义一个保存内容的key，hash中每个项就是cid</span></div><div class="line">			<span class="comment">//value是list，需要把list转换成json数据。</span></div><div class="line">			jedisClient.hset(REDIS_CONTENT_KEY, cid+<span class="string">""</span>, JsonUtils.objectToJson(list));</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> list;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="6-缓存同步"><a href="#6-缓存同步" class="headerlink" title="6 . 缓存同步"></a>6 . 缓存同步</h3><p>当后台修改信息后，只需要把redis中缓存的数据删除即可。<br>后台系统并不会直接操作redis数据库。<br>可以发布一个服务，在后台修改数据时，调用该服务。该服务的功能就是删除redis中的缓存。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/29/Redis与Jedis/" data-id="cj4r0dsf3000ghgtx1jd8bji5" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Solr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/Solr/" class="article-date">
  <time datetime="2017-06-29T14:41:12.850Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/Solr/">Solr</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Solr 搜索系统</p>
<h2 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h2><p>搜索功能需要发布服务供pc端、移动端使用。根据关键词搜索，得到json格式的搜索结果。创建一个搜索系统，发布搜索服务。</p>
<p>搜索系统使用的技术：</p>
<ul>
<li>mybatis</li>
<li>spring</li>
<li>springmvc</li>
<li>solrj(solr服务的客户端)</li>
</ul>
<h3 id="1-solr服务的搭建"><a href="#1-solr服务的搭建" class="headerlink" title="1 . solr服务的搭建"></a>1 . solr服务的搭建</h3><p>需要在linux系统下搭建solr服务。</p>
<ol>
<li>需要安装tomcat</li>
<li>安装jdk</li>
</ol>
<p><strong>1.1 centos单机版安装：</strong><br>第一步：安装jdk、安装tomcat<br>第二步：解压solr压缩包。<br>第三步：把dist/solr-4.10.3.war部署到tomcat下。<br>第四步：解压缩war包。启动tomcat解压。<br>第五步：需要把/root/solr-4.10.3/example/lib/ext目录下的所有的jar包添加到solr工程中。<br>第六步：创建solrhome。把/root/solr-4.10.3/example/solr文件夹复制一份作为solrhome。<br>第七步：告诉solr服务solrhome的位置。需要修改web.xml<br>第八步：启动tomcat。</p>
<p><strong>1.2 配置中文分析器、自定义业务域</strong></p>
<p>分析器使用IKAnalyzer</p>
<p>使用方法：<br><strong>第一步</strong>：把IKAnalyzer依赖的jar包添加到solr工程中。把分析器使用的扩展词典添加到classpath中。<br><strong>第二步</strong>：需要自定义一个FieldType。Schema.xml中定义。可以在FieldType中指定中文分析器。<br><strong>第三步</strong>：自定义域。指定域的类型为自定义的FieldType</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/29/Solr/" data-id="cj4r0dsf5000hhgtxlgexyjno" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式——桥接模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/22/设计模式——桥接模式/" class="article-date">
  <time datetime="2017-06-22T14:46:58.567Z" itemprop="datePublished">2017-06-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/22/设计模式——桥接模式/">设计模式——桥接模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="标签-：-设计模式-结构型模式-桥接模式"><a href="#标签-：-设计模式-结构型模式-桥接模式" class="headerlink" title="标签 ： 设计模式 结构型模式 桥接模式"></a>标签 ： 设计模式 结构型模式 桥接模式</h2><h1 id="桥接模式（Bridge-Pattern）"><a href="#桥接模式（Bridge-Pattern）" class="headerlink" title="桥接模式（Bridge Pattern）"></a>桥接模式（Bridge Pattern）</h1><h2 id="一-概述"><a href="#一-概述" class="headerlink" title="一 . 概述"></a>一 . 概述</h2><p>将抽象部分和其实现部分进行分离，使他们可以独立地变化。</p>
<h2 id="二-适用性"><a href="#二-适用性" class="headerlink" title="二 . 适用性"></a>二 . 适用性</h2><ol>
<li>类的抽象以及它的实现都应该可以通过生成子类的方法加以扩充</li>
<li>对一个抽象的实现部分的修改应对客户不产生影响，即客户的代码不必重新编译。</li>
<li>你不希望在抽象和它的实现部分之间有一个固定的绑定关系。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/22/设计模式——桥接模式/" data-id="cj4r0dsfg000rhgtxcfhtcnw9" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式——适配器模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/16/设计模式——适配器模式/" class="article-date">
  <time datetime="2017-06-16T07:43:12.347Z" itemprop="datePublished">2017-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/16/设计模式——适配器模式/">设计模式——————适配器模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 设计模式 结构型模式</p>
<hr>
<h1 id="适配器模式（Adapter-Pattern）"><a href="#适配器模式（Adapter-Pattern）" class="headerlink" title="适配器模式（Adapter Pattern）"></a>适配器模式（Adapter Pattern）</h1><h2 id="一-概述"><a href="#一-概述" class="headerlink" title="一 . 概述"></a>一 . 概述</h2><p>适配器模式（Adapter Pattern）是作为两个不兼容的接口之间的桥梁。这种类型的设计模式属于结构型模式，它结合了两个独立接口的功能。</p>
<p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p><strong>实例</strong>：</p>
<ol>
<li>美国电器 110V，中国 220V，就要有一个适配器将 110V 转化为 220V。</li>
<li>JAVA JDK 1.1 提供了 Enumeration 接口，而在 1.2 中提供了 Iterator 接口，想要使用 1.2 的 JDK，则要将以前系统的 Enumeration 接口转化为 Iterator 接口，这时就需要适配器模式。 </li>
<li>在 LINUX 上运行 WINDOWS 程序。 </li>
<li>JAVA 中的 jdbc。</li>
</ol>
<p><strong>解决方式：</strong><br><em>继承</em>  或者 <em>对象组合</em></p>
<h2 id="二-适用性"><a href="#二-适用性" class="headerlink" title="二 . 适用性"></a>二 . 适用性</h2><ol>
<li>你想使用一个已经存在的类，而它的接口不符合你的需求。</li>
<li>想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作 </li>
<li>（仅适用于对象Adapter）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口</li>
</ol>
<h2 id="三-模式中的角色"><a href="#三-模式中的角色" class="headerlink" title="三 . 模式中的角色"></a>三 . 模式中的角色</h2><ul>
<li>目标角色（Target）<br>客户所期待的接口，可以是类、接口、抽象类。</li>
<li>源角色（Adaptee）<br>需要适配的接口</li>
<li>适配器角色（Adapter）<br>适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而<strong>必须是具体类</strong>。</li>
</ul>
<h2 id="四-适配器模式的结构"><a href="#四-适配器模式的结构" class="headerlink" title="四 . 适配器模式的结构"></a>四 . 适配器模式的结构</h2><p>适配器模式有<strong>类适配器模式</strong>和<strong>对象适配器模式</strong>两种不同的形式。</p>
<h2 id="五-对象适配器模式"><a href="#五-对象适配器模式" class="headerlink" title="五 . 对象适配器模式"></a>五 . 对象适配器模式</h2><p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/DD5242C4A3CD4F339C174B3A8478563B/665" alt="此处输入图片的描述"></p>
<p>从上图可以看出，Adaptee类没有sampleOperation2()方法，而客户端则期待这个方法。为使客户端能够使用Adaptee类，需要提供一个(Wrapper)包装类Adapter。这个包装类包装了一个Adaptee的实例，从而此包装类能够把Adaptee的API与Target类的API衔接起来。Adapter与Adaptee是委派关系，这决定了适配器模式是对象的。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>Target<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Target</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//Adaptee有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="comment">//Adaptee没有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adaptee<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Adaptee</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adapter<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Target</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> Adaptee adaptee;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(Adaptee adaptee)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee = adaptee;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee有方法sampleOperation1</div><div class="line">     * 因此适配器类直接委派即可</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee.sampleOperation1();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee没有方法sampleOperation2</div><div class="line">     * 因此由适配器类需要补充此方法</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">//写相关的功能代码</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试类Client<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Target target = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> Adaptee());</div><div class="line">        target.sampleOperation1();</div><div class="line">        </div><div class="line">        target.sampleOperation2();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/16/设计模式——适配器模式/" data-id="cj4r0dsfh000shgtx4otns8og" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring框架学习二" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/09/spring框架学习二/" class="article-date">
  <time datetime="2017-06-09T15:57:54.276Z" itemprop="datePublished">2017-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/09/spring框架学习二/">spring框架学习二</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： spring </p>
<hr>
<h2 id="一-AOP"><a href="#一-AOP" class="headerlink" title="一 . AOP"></a>一 . AOP</h2><h3 id="1-AOP介绍"><a href="#1-AOP介绍" class="headerlink" title="1. AOP介绍"></a>1. AOP介绍</h3><p>aop底层将采用代理机制进行实现<br>接口 + 实现类：spring采用jdk的动态代理Proxy<br>实现类：spring采用cglib字节码增强</p>
<h4 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a><strong>AOP术语</strong></h4><ol>
<li><p>target：目标类，需要被代理的类。例如：UserSerVice</p>
</li>
<li><p>Joinpoint：指那些可能被拦截的方法，例如:所有方法</p>
</li>
<li><p>PointCut : 已经被增强的连接点。例如：addUser()</p>
</li>
<li><p>advice : 通知，增强代码。例如：after()、befor()</p>
</li>
<li><p>Weaving ： 织入，把增强advice应用到目标对象target来创建新的代理对象proxy的过程</p>
</li>
<li><p>proxy ： 代理类</p>
</li>
<li><p>Aspect : 切入点pointcut和通知advice的结合</p>
</li>
</ol>
<h3 id="2-手动方式"><a href="#2-手动方式" class="headerlink" title="2. 手动方式"></a>2. 手动方式</h3><h4 id="2-1-JDK的动态代理"><a href="#2-1-JDK的动态代理" class="headerlink" title="2.1 JDK的动态代理"></a>2.1 JDK的动态代理</h4><p>JDK动态代理对“装饰者”设计模式简化。使用前提：必须有接口<br>目标类：接口 + 实现类<br>切面类：用于存放通知<br>工厂类：编写工厂生成代理<br>测试 : </p>
<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"updateUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"adeleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyAspect.java<br>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设开启事务"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设关闭事务"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyBeanFactory.java<br>工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title">createService</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//1 目标类</span></div><div class="line">		<span class="keyword">final</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</div><div class="line">		<span class="comment">//2切面类</span></div><div class="line">		<span class="keyword">final</span> MyAspect myAspect = <span class="keyword">new</span> MyAspect();</div><div class="line">		<span class="comment">/* 3 代理类：将目标类（切入点）和 切面类（通知） 结合 --&gt; 切面</span></div><div class="line">		 * 	Proxy.newProxyInstance</div><div class="line">		 * 		参数1：loader ，类加载器，动态代理类 运行时创建，任何类都需要类加载器将其加载到内存。</div><div class="line">		 * 			一般情况：当前类.class.getClassLoader();</div><div class="line">		 * 					目标类实例.getClass().get...</div><div class="line">		 * 		参数2：Class[] interfaces 代理类需要实现的所有接口</div><div class="line">		 * 			方式1：目标类实例.getClass().getInterfaces()  ;注意：只能获得自己接口，不能获得父元素接口</div><div class="line">		 * 			方式2：new Class[]&#123;UserService.class&#125;   </div><div class="line">		 * 			例如：jdbc 驱动  --&gt; DriverManager  获得接口 Connection</div><div class="line">		 * 		参数3：InvocationHandler  处理类，接口，必须进行实现类，一般采用匿名内部</div><div class="line">		 * 			提供 invoke 方法，代理类的每一个方法执行时，都将调用一次invoke</div><div class="line">		 * 				参数31：Object proxy ：代理对象</div><div class="line">		 * 				参数32：Method method : 代理对象当前执行的方法的描述对象（反射）</div><div class="line">		 * 					执行方法名：method.getName()</div><div class="line">		 * 					执行方法：method.invoke(对象，实际参数)</div><div class="line">		 * 				参数33：Object[] args :方法实际参数</div><div class="line">		 * </div><div class="line">		 */</div><div class="line">		UserService proxService = (UserService)Proxy.newProxyInstance(</div><div class="line">								MyBeanFactory.class.getClassLoader(), </div><div class="line">								userService.getClass().getInterfaces(), </div><div class="line">								<span class="keyword">new</span> InvocationHandler() &#123;</div><div class="line">									</div><div class="line">									<span class="meta">@Override</span></div><div class="line">									<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">										<span class="comment">//前执行</span></div><div class="line">										myAspect.before();</div><div class="line">										<span class="comment">//执行目标类的方法</span></div><div class="line">										Object obj = method.invoke(userService, args);</div><div class="line">										<span class="comment">//后执行</span></div><div class="line">										myAspect.after();</div><div class="line">										<span class="keyword">return</span> obj;</div><div class="line">									&#125;</div><div class="line">								&#125;);</div><div class="line">		<span class="keyword">return</span> proxService;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test01.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		UserService userService = MyBeanFactory.createService();</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：<br>假设开启事务<br>addUser<br>假设关闭事务<br>假设开启事务<br>updateUser<br>假设关闭事务<br>假设开启事务<br>deleteUser<br>假设关闭事务</p>
<h4 id="2-2-CGLIB字节码增强"><a href="#2-2-CGLIB字节码增强" class="headerlink" title="2.2 CGLIB字节码增强"></a>2.2 CGLIB字节码增强</h4><p>在没有定义业务接口的时候，不能使用JDK动态代理，此时就需要使用CGLIB来完成。其采用了底层的字节码技术，将业务层实现类通过字节码技术来创建子类，并使用拦截器，从而达到动态代理的的效果。</p>
<h3 id="AOP联盟通知模型"><a href="#AOP联盟通知模型" class="headerlink" title="AOP联盟通知模型"></a>AOP联盟通知模型</h3><h3 id="3-spring编写代理：半自动"><a href="#3-spring编写代理：半自动" class="headerlink" title="3. spring编写代理：半自动"></a>3. spring编写代理：半自动</h3><p>让spring创建代理对象，从spring容器中手动获取代理对象。</p>
<ol>
<li>导入jar包：</li>
</ol>
<ul>
<li>4 + 1  </li>
<li>AOP：AOP联盟（规范）；spring-aop（实现）</li>
</ul>
<ol>
<li>目标类和目标类接口</li>
</ol>
<p>UserService.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>UserServiceImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean updateUser"</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean deleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3.切面类</p>
<p>MyAspect.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类中确定通知，需要实现不同接口，接口就是规范，从而就确定方法名称。</div><div class="line"> * 采用“环绕通知” MethodInterceptor</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = mi.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4.配置spring</p>
<p>beans.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 3 创建代理类 </span></div><div class="line">		* 使用工厂bean FactoryBean ，底层调用 getObject() 返回特殊bean</div><div class="line">		* ProxyFactoryBean 用于创建代理工厂bean，生成特殊代理对象</div><div class="line">			interfaces : 确定接口们</div><div class="line">				通过&lt;array&gt;可以设置多个值</div><div class="line">				只有一个值时，value=""</div><div class="line">			target : 确定目标类</div><div class="line">			interceptorNames : 通知 切面类的名称，类型String[]，如果设置一个值 value=""</div><div class="line">			optimize :强制使用cglib</div><div class="line">				&lt;property name="optimize" value="true"&gt;&lt;/property&gt;</div><div class="line">		底层机制</div><div class="line">			如果目标类有接口，采用jdk动态代理</div><div class="line">			如果没有接口，采用cglib 字节码增强</div><div class="line">			如果声明 optimize = true ，无论是否有接口，都采用cglib</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyServiceId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interfaces"</span> <span class="attr">value</span>=<span class="string">"com.itheima.b_factory_bean.UserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"userServiceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"myAspectId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFactoryBean</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		String xmlPath = <span class="string">"com/yao/factory_bean/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		<span class="comment">//获得代理类</span></div><div class="line">		UserService userService = (UserService) applicationContext.getBean(<span class="string">"proxyServiceId"</span>);</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="4-spring-aop编程：全自动"><a href="#4-spring-aop编程：全自动" class="headerlink" title="4. spring aop编程：全自动"></a>4. spring aop编程：全自动</h3><p>从spring容器中获得目标类，如果我们配置了AOP，spring将自动生成代理。<br>要确定目标类，aspectj的切入点表达式，导入jar包:<br><strong>spring-framework-3.0.2.RELEASE-dependencies\org.aspectj\com.springsource.org.aspectj.weaver\1.6.8.RELEASE</strong></p>
<p><strong>目标类和切面类同上。没有变化。</strong></p>
<p>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		3.1 导入命名空间</div><div class="line">		3.2 使用 &lt;aop:config&gt;进行配置</div><div class="line">				proxy-target-class="true" 声明时使用cglib代理</div><div class="line">			&lt;aop:pointcut&gt; 切入点 ，从目标对象获得具体方法</div><div class="line">			&lt;aop:advisor&gt; 特殊的切面，只有一个通知 和 一个切入点</div><div class="line">				advice-ref 通知引用</div><div class="line">				pointcut-ref 切入点引用</div><div class="line">		3.3 切入点表达式</div><div class="line">			execution(* com.itheima.c_spring_aop.*.*(..))</div><div class="line">			选择方法         返回值任意   包                                             类名任意   方法名任意   参数任意</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.c_spring_aop.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAspectId"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpringAop</span></span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">        String xml = <span class="string">"com/yao/springaop/ApplicationContext.xml"</span></div><div class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">        </div><div class="line">        UserService userService = (UserService)applicationContext.getBean(<span class="string">"userServiceId"</span>);</div><div class="line">        userService.addUser();</div><div class="line">        userService.updateUser();</div><div class="line">        userService.deleteUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="5-aspectJ"><a href="#5-aspectJ" class="headerlink" title="5. aspectJ"></a>5. aspectJ</h3><h4 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5.1 介绍"></a>5.1 介绍</h4><p>AspectJ是一个基于Java语言的AOP框架。Spring2.0以后新增了对AspectJ切点表达式支持。<br>@AspectJ 是AspectJ1.5新增功能，通过JDK5注解技术，允许直接在Bean类中定义切面新版本Spring框架，建议使用AspectJ方式来开发AOP。<br>主要用途：自定义开发</p>
<pre><code>此处输入代码
</code></pre><h4 id="5-2-切入点表达式"><a href="#5-2-切入点表达式" class="headerlink" title="5.2 切入点表达式"></a>5.2 切入点表达式</h4><ol>
<li><p>execution()用于描述方法<br> 语法：execution(修饰符 返回值 包.类.方法(参数) throws异常)</p>
<pre><code>修饰符 一般省略
    public        公共方法
    *            任意

返回值，不能省略
    void        返回没有值
    String        返回值字符串
    *             任意

包，[省略]
    com.test.crm            固定包
    com.test.crm.*.service    crm包下面子包任意 （例如：com.test.crm.staff.service）
    com.test.crm..            crm包下面的所有子包（含自己）
    com.test.crm.*.service..  crm包下面任意子包，固定目录service，service目录任意包

类，[省略]
    UserServiceImpl            指定类
    *Impl                    以Impl结尾
    User*                    以User开头
    *                        任意
方法名，不能省略
    addUser                    固定方法
    add*                    以add开头
    *Do                        以Do结尾
    *                        任意
(参数)
    ()                            无参
    (int)                        一个整型
    (int ,int)                    两个
    (..)                        参数任意

throws ,可省略，一般不写。
</code></pre></li>
</ol>
<hr>
<h4 id="5-2-AspectJ通知类型"><a href="#5-2-AspectJ通知类型" class="headerlink" title="5.2 AspectJ通知类型"></a>5.2 AspectJ通知类型</h4><p>aop联盟定义的通知类型，具有特定的接口，必须实现，从而确定方法的名称。<br>AspectJ通知类型，只定义类型名称。</p>
<p>around：环绕通知(应用：十分强大，可以做任何事情)<br>        方法执行前后分别执行，可以阻止方法的执行<br>        <strong>必须手动执行目标方法</strong></p>
<h4 id="5-3-导入jar包"><a href="#5-3-导入jar包" class="headerlink" title="5.3 导入jar包"></a>5.3 导入jar包</h4><p>4个：aop联盟规范 、 spring aop实现 、aspect规范 、 spring aspect实现</p>
<hr>
<h4 id="5-4-基于XML"><a href="#5-4-基于XML" class="headerlink" title="5.4 基于XML"></a>5.4 基于XML</h4><p><strong>首先需要搭建环境</strong></p>
<ol>
<li>目标类 ： 接口 + 实现类</li>
<li>切面类 ： 编写多个通知，采用aspectj通知名称任意（方法名任意）</li>
<li>aop编程： 将通知应用到目标类</li>
<li>测试</li>
</ol>
<p>目标类：省略不写，无变化。</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">**</div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		&lt;aop:aspect&gt; 将切面类 声明“切面”，从而获得通知（方法）</div><div class="line">			ref 切面类引用</div><div class="line">		&lt;aop:pointcut&gt; 声明一个切入点，所有的通知都可以使用。</div><div class="line">			expression 切入点表达式</div><div class="line">			id 名称，用于其它通知引用</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspectId"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.d_aspect.a_xml.UserServiceImpl.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.1 前置通知 </span></div><div class="line">				&lt;aop:before method="" pointcut="" pointcut-ref=""/&gt;</div><div class="line">					method : 通知，及方法名</div><div class="line">					pointcut :**切入点表达式**，此表达式只能当前通知使用。</div><div class="line">					pointcut-ref ： 切入点引用，可以与其他通知共享切入点。</div><div class="line">				通知方法格式：public void myBefore(JoinPoint joinPoint)&#123;</div><div class="line">					参数1：org.aspectj.lang.JoinPoint  用于描述连接点（目标方法），获得目标方法名等</div><div class="line">				例如：</div><div class="line">			&lt;aop:before method="myBefore" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.2后置通知  ,目标方法后执行，获得返回值</span></div><div class="line">				&lt;aop:after-returning method="" pointcut-ref="" returning=""/&gt;</div><div class="line">					returning 通知方法第二个参数的名称</div><div class="line">				通知方法格式：public void myAfterReturning(JoinPoint joinPoint,Object ret)&#123;</div><div class="line">					参数1：连接点描述</div><div class="line">					参数2：类型Object，参数名 returning="ret" 配置的</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-returning method="myAfterReturning" pointcut-ref="myPointCut" returning="ret" /&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.3 环绕通知 </span></div><div class="line">				&lt;aop:around method="" pointcut-ref=""/&gt;</div><div class="line">				通知方法格式：public Object myAround(ProceedingJoinPoint joinPoint) throws Throwable&#123;</div><div class="line">					返回值类型：Object</div><div class="line">					方法名：任意</div><div class="line">					参数：org.aspectj.lang.ProceedingJoinPoint</div><div class="line">					抛出异常</div><div class="line">				执行目标方法：Object obj = joinPoint.proceed();</div><div class="line">				例如：</div><div class="line">			&lt;aop:around method="myAround" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.4 抛出异常</span></div><div class="line">				&lt;aop:after-throwing method="" pointcut-ref="" throwing=""/&gt;</div><div class="line">					throwing ：通知方法的第二个参数名称</div><div class="line">				通知方法格式：public void myAfterThrowing(JoinPoint joinPoint,Throwable e)&#123;</div><div class="line">					参数1：连接点描述对象</div><div class="line">					参数2：获得异常信息，类型Throwable ，参数名由throwing="e" 配置</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-throwing method="myAfterThrowing" pointcut-ref="myPointCut" throwing="e"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.5 最终通知 --&gt;</span>			</div><div class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"myAfter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类不变，getBean中还是得到目标类的bean。</p>
<hr>
<h4 id="5-5-基于注解"><a href="#5-5-基于注解" class="headerlink" title="5.5 基于注解"></a>5.5 基于注解</h4><ol>
<li>替换bean</li>
</ol>
<ol>
<li>替换aop</li>
</ol>
<p>必须进行aspectj代理 </p>
<p>声明切面</p>
<p>替换前置通知 </p>
<p>替换公共切入点</p>
<p>替换抛出异常</p>
<p>@around  在只有一个参数的时候，value是可以省略的；但是有超过一个参数的时候，value就不可以省略</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//切入点当前有效</span></div><div class="line"><span class="comment">//	@Before("execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//声明公共切入点</span></div><div class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))"</span>)</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">myPointCut</span><span class="params">()</span></span>&#123;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterReturning(value="myPointCut()" ,returning="ret")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@Around(value = "myPointCut()")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterThrowing(value="execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))" ,throwing="e")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@After</span>(<span class="string">"myPointCut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 1.扫描 注解类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.itheima.d_aspect.b_anno"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 2.确定 aop注解生效 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="5-6-aop注解总结"><a href="#5-6-aop注解总结" class="headerlink" title="5.6 aop注解总结"></a>5.6 aop注解总结</h4><pre><code>@Aspect 声明切面，修饰切面类，从而获得通知。
</code></pre><p>通知<br>    @Before  前置<br>    @AfterReturning  后置<br>    @Around 环绕<br>    @AfterThrowing 抛出异常<br>    @After 最终</p>
<p>切入点<br>    @PointCut ，修饰方法 private void xxx(){}  之后通过“方法名”获得切入点引用</p>
<hr>
<h2 id="二-JdbcTemplate"><a href="#二-JdbcTemplate" class="headerlink" title="二 . JdbcTemplate"></a>二 . JdbcTemplate</h2><ul>
<li>spring所提供的用于操作JDBC的工具类，相当于DBUtils。</li>
<li>依赖连接池DataSource(数据源)</li>
</ul>
<p>步骤目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1.1 环境搭建</div><div class="line"></div><div class="line">1.2 使用api</div><div class="line"></div><div class="line">1.3 配置DBCP</div><div class="line"></div><div class="line">1.4 配置C3P0</div><div class="line"></div><div class="line">1.5 使用JdbcDaoSupport</div><div class="line"></div><div class="line">1.6 配置properties</div></pre></td></tr></table></figure></p>
<h3 id="1-1-环境搭建"><a href="#1-1-环境搭建" class="headerlink" title="1.1 环境搭建"></a>1.1 环境搭建</h3><p>1.1.1 <strong><em>创建表</em></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">creat database spring_day0410;</div><div class="line"><span class="keyword">use</span> spring_day0410;</div><div class="line">creat table t_user(</div><div class="line">id int primary key auto_inrement;</div><div class="line">username varchar(20);</div><div class="line">password varchar(20);</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'tom'</span>,<span class="number">123</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'jerry'</span>,<span class="number">223</span>);</div></pre></td></tr></table></figure>
<p>1.1.2 <strong><em>导包</em></strong></p>
<p><strong><em>注意：spring3.2和jdk1.8会发生冲突。</em></strong></p>
<p>4+1；<br>数据库驱动；<br>spring-jdba开发；<br>spring事务；<br>c3p0连接池；<br>dbcp连接池（2个）</p>
<p>1.1.3 <strong><em>javabean</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String passsword;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-2-使用api"><a href="#1-2-使用api" class="headerlink" title="1.2 使用api"></a>1.2 使用api</h3><p>通过对api的使用，能够进一步理解spring配置DBCP和C3P0；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApi</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">        <span class="comment">//创建数据源</span></div><div class="line">        BasiataSource dataSource = <span class="keyword">new</span> BasicDataSource();</div><div class="line">        dataSource.setDriveerClassName(<span class="string">"com.sql.jdbc.Driver"</span>);</div><div class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql://localhost:3306/spring_day0410"</span>);</div><div class="line">        dataSource.setUsername(<span class="string">"root"</span>);</div><div class="line">        dataSource.setPassword(<span class="string">"admin"</span>);</div><div class="line">        <span class="comment">//创建模板</span></div><div class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</div><div class="line">        jdbcTemplate.setDataSource(dataSource);</div><div class="line">        <span class="comment">//api操作</span></div><div class="line">        jdbcTemplate.update(<span class="string">"insert into t_user(username,password) values(?,?);"</span>, <span class="string">"tom"</span>,<span class="string">"998"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-配置DBCP"><a href="#1-3-配置DBCP" class="headerlink" title="1.3 配置DBCP"></a>1.3 配置DBCP</h3><p>对照着1.2对api的使用，进行配置DBCP.<br>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 创建数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceId"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ee19_spring_day02"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 创建模板 ,需要注入数据源--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplateId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置dao --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDaoId"</span> <span class="attr">class</span>=<span class="string">"com.yao.c_dbcp.UserDao"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplateId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>UserDao.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line">	<span class="comment">//jdbc模板将由spring注入</span></div><div class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>&#123;</div><div class="line">		String sql = <span class="string">"update t_user set username=?,password=? where id =?"</span>;</div><div class="line">		Object[] args = &#123;user.getUsername(),user.getPassword(),user.getId()&#125;;</div><div class="line">		jdbcTemplate.update(sql, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDBCP</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		User user = <span class="keyword">new</span> User();</div><div class="line">		user.setId(<span class="number">1</span>);</div><div class="line">		user.setUsername(<span class="string">"sam"</span>);</div><div class="line">		user.setPassword(<span class="string">"999"</span>);</div><div class="line">		</div><div class="line">		String xmlPath = <span class="string">"com/itheima/c_dbcp/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		</div><div class="line">		<span class="comment">//获得目标类</span></div><div class="line">		UserDao userDao = (UserDao) applicationContext.getBean(<span class="string">"userDaoId"</span>);</div><div class="line">		userDao.update(user);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-4-配置C3P0"><a href="#1-4-配置C3P0" class="headerlink" title="1.4 配置C3P0"></a>1.4 配置C3P0</h3><p>在创建数据源的部分有变化，<br><code>&lt;bean id=&quot;&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</code></p>
<h3 id="1-5-使用JdbcDaoSupport"><a href="#1-5-使用JdbcDaoSupport" class="headerlink" title="1.5 使用JdbcDaoSupport"></a>1.5 使用JdbcDaoSupport</h3><p>将C3P0和DBCP中的jdbc模板写到了JdbcDaoSupport，作为父类，且作为final存在。<br>因此，要使用JdbcTemplate，就<code>this.getJdbcTemplate()</code>即可。<br>从而，在dao层中， 只需要注入数据源，底层将自动创建模板。</p>
<h3 id="1-6-配置properties"><a href="#1-6-配置properties" class="headerlink" title="1.6 配置properties"></a>1.6 配置properties</h3><p>在spring配置中—–<br>加载配置文件：”classpath:”表示src下<br>使用配置文件：通过${key获得内容}</p>
<p>1.6.1 <strong><em>properties文件</em></strong></p>
<p>1.6.2 <strong><em>spring配置</em></strong></p>
<h2 id="三-整合Junit"><a href="#三-整合Junit" class="headerlink" title="三 . 整合Junit"></a>三 . 整合Junit</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/09/spring框架学习二/" data-id="cj4r0dsfh000thgtxysjyfuun" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/07/js跨域/" class="article-date">
  <time datetime="2017-06-07T15:57:36.265Z" itemprop="datePublished">2017-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Js跨域"><a href="#Js跨域" class="headerlink" title="Js跨域"></a>Js跨域</h1><p>js为了安全进行了限制，不允许跨域访问。</p>
<p>如果：</p>
<ol>
<li>两个url的域名不同</li>
<li>url相同，端口不同</li>
<li>ip不同</li>
</ol>
<p>则是跨域了。</p>
<p>在esale-portal中不能使用ajax直接调用esale-rest的服务。</p>
<h2 id="解决跨域的问题"><a href="#解决跨域的问题" class="headerlink" title="解决跨域的问题"></a>解决跨域的问题</h2><p>可以使用jsonp来解决跨域问题。</p>
<ol>
<li>在js中不能跨域请求数据，但是<strong>js可以跨域请求js片段</strong>。可以把数据包装成js。</li>
<li>可以把数据使用js方法来包装，形成一条方法的调用语句。</li>
<li>可以使用ajax请求js片段，当js到达浏览器会被立即执行</li>
<li>在浏览器端，先创建好回调方法，在回调方法中通过参数可以获得请求的数据。</li>
</ol>
<p>前期准备：</p>
<ol>
<li>把js的回调方法写好</li>
<li>在ajax请求时，需要把回调方法的方法名传递给服务端</li>
<li>服务端接收回调方法，把数据包装好，响应给客户端。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/07/js跨域/" data-id="cj4r0dsfd000phgtxlikzrq7u" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Esale商城项目" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/02/Esale商城项目/" class="article-date">
  <time datetime="2017-06-02T14:42:55.102Z" itemprop="datePublished">2017-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Esale商城项目"><a href="#Esale商城项目" class="headerlink" title="Esale商城项目"></a>Esale商城项目</h1><h2 id="1-基本构建思路"><a href="#1-基本构建思路" class="headerlink" title="1 . 基本构建思路"></a>1 . 基本构建思路</h2><p>该商城和互联网上存在的商城类似，具备有基本的功能。</p>
<h3 id="1-1-技术选型"><a href="#1-1-技术选型" class="headerlink" title="1.1 技术选型"></a>1.1 技术选型</h3><ul>
<li>数据库：mysql</li>
<li>数据库连接池：druid</li>
<li>Dao层：MyBatis</li>
<li>缓存：redis</li>
<li>搜索：solr</li>
<li>Service层：spring</li>
<li>表现层Web层：springmvc jstl EasyUI freemark</li>
<li>图片服务器：FastDFS</li>
<li>反向代理服务器：nginx</li>
<li>定时器：Quartz</li>
<li>Web服务器：tomcat</li>
<li>工程管理：maven</li>
</ul>
<h3 id="1-2-后台管理系统搭建"><a href="#1-2-后台管理系统搭建" class="headerlink" title="1.2 . 后台管理系统搭建"></a>1.2 . 后台管理系统搭建</h3><p>使用maven管理工程：完成项目构建和依赖管理</p>
<p>大致的构架如下：</p>
<p>Taotao-parent（父工程管理jar包的版本）</p>
<p>  |–Taotao-common（把通用的工具类打包）</p>
<p>  |–Taotao-manager（继承父工程）</p>
<pre><code>|-taotao-manager-pojo

  |-taotao-manager-dao

  |-taotao-manager-service

  |-taotao-manager-web（war包）
</code></pre><h2 id="2-技术框架SSM"><a href="#2-技术框架SSM" class="headerlink" title="2 . 技术框架SSM"></a>2 . 技术框架SSM</h2><p>包括三层：dao层、service层、web层。</p>
<ul>
<li>dao层：整合mybatis和spring</li>
</ul>
<h2 id="4-商品列表展示"><a href="#4-商品列表展示" class="headerlink" title="4 . 商品列表展示"></a>4 . 商品列表展示</h2><p>需要展示列表，就需要引入js和css文件。但是如果将js和css文件放在WEB-INF下，则无法直接访问。因此在springmvc中，需要引入静态资源映射来完成资源的加载。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>使用了easyUI模板完成了前端代码的编写，因此需要再次基础上进行后台代码的编写。</p>
<p>商品的列表展示除了要向数据库查询商品信息外，还需要进行分页处理。</p>
<p>在item-list.jsp页面中，有如下的一段代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"easyui-datagrid"</span> <span class="attr">id</span>=<span class="string">"itemList"</span> <span class="attr">title</span>=<span class="string">"商品列表"</span> </span></div><div class="line">       <span class="attr">data-options</span>=<span class="string">"singleSelect:false,collapsible:true,pagination:true,url:'/item/list',method:'get',pageSize:30,toolbar:toolbar"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'ck',checkbox:true"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'id',width:60"</span>&gt;</span>商品ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'title',width:200"</span>&gt;</span>商品标题<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'cid',width:100"</span>&gt;</span>叶子类目<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'sellPoint',width:100"</span>&gt;</span>卖点<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'price',width:70,align:'right',formatter:TAOTAO.formatPrice"</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'num',width:70,align:'right'"</span>&gt;</span>库存数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'barcode',width:100"</span>&gt;</span>条形码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'status',width:60,align:'center',formatter:TAOTAO.formatItemStatus"</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'created',width:130,align:'center',formatter:TAOTAO.formatDateTime"</span>&gt;</span>创建日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'updated',width:130,align:'center',formatter:TAOTAO.formatDateTime"</span>&gt;</span>更新日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这段代码则会发出如下的请求url:<a href="http://localhost:8080/item/list?page=1&amp;rows=30" target="_blank" rel="external">http://localhost:8080/item/list?page=1&amp;rows=30</a></p>
<p>而且，在easyUI中，datagrid要求<strong>响应的数据格式</strong>：json数据格式，并且需要包含”total”<br>和”rows”两个参数。</p>
<ul>
<li>参数说明</li>
</ul>
<p>Total：查询结果的总记录数</p>
<p>Rows：集合，包含显示的所有数据。其中集合中每个元素的key应该和dategrid的field对应。</p>
<ul>
<li>dao</li>
</ul>
<p>使用逆向工程生成的代码即可。</p>
<ul>
<li>service </li>
</ul>
<p>在service层中，接受到的参数是page（当前的页码）和row（每页所显示的记录数）数据；</p>
<p>返回值：自己创建的pojo对象,对象中包含两个参数。</p>
<p>EasyUIDataGridResult.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EasyUIDataGridResult</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Long total;</div><div class="line">	<span class="keyword">private</span> List&lt;?&gt; rows;</div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> total;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(Long total)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.total = total;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> List&lt;?&gt; getRows() &#123;</div><div class="line">		<span class="keyword">return</span> rows;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRows</span><span class="params">(List&lt;?&gt; rows)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.rows = rows;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此处，需要使用到Mybatis的分页插件，需要在maven工程的pom.xml文件中添加：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.miemiedev<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-paginator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>并且在SqlMapConfig.xml中添加配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置分页插件 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageHelper"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 指定使用的数据库是什么 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ItemServiceImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> EasyUIDataGridResult <span class="title">getItemList</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> rows)</span> </span>&#123;</div><div class="line">		<span class="comment">//分页处理</span></div><div class="line">		PageHelper.startPage(page, rows);</div><div class="line">		<span class="comment">//执行查询</span></div><div class="line">		TbItemExample example = <span class="keyword">new</span> TbItemExample();</div><div class="line">		List&lt;TbItem&gt; list = itemMapper.selectByExample(example);</div><div class="line">		<span class="comment">//取分页信息</span></div><div class="line">		PageInfo&lt;TbItem&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(list);</div><div class="line">		<span class="comment">//返回处理结果</span></div><div class="line">		EasyUIDataGridResult result = <span class="keyword">new</span> EasyUIDataGridResult();</div><div class="line">		result.setTotal(pageInfo.getTotal());</div><div class="line">		result.setRows(list);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>controller </li>
</ul>
<p>在controller层需要拦截到page和rows参数。需要返回的是json格式的参数，因此会使用到<br>@ResponseBody注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/item/list"</span>)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> EasyUIDataGridResult <span class="title">getItemList</span><span class="params">(Integer page,Integer rows)</span></span>&#123;</div><div class="line">	EasyUIDataGridResult result = itemService.getItemList(page, rows);</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-商品类目选择"><a href="#5-商品类目选择" class="headerlink" title="5 . 商品类目选择"></a>5 . 商品类目选择</h2><h2 id="6-图片上传"><a href="#6-图片上传" class="headerlink" title="6 . 图片上传"></a>6 . 图片上传</h2><ol>
<li>使用Nginx服务器</li>
<li>分布式文件系统FastDFS</li>
</ol>
<h2 id="7-规格参数模块"><a href="#7-规格参数模块" class="headerlink" title="7 . 规格参数模块"></a>7 . 规格参数模块</h2><h3 id="7-1-判断规格参数模板是否存在"><a href="#7-1-判断规格参数模板是否存在" class="headerlink" title="7.1 判断规格参数模板是否存在"></a>7.1 判断规格参数模板是否存在</h3><p>根据圣品的分类id查询tb_item_param表，如果查询到结果说明此模板已经添加。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">TAOTAO.initItemCat(&#123;</div><div class="line">	<span class="attr">fun</span>:<span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</div><div class="line">	$(<span class="string">".addGroupTr"</span>).hide().find(<span class="string">".param"</span>).remove();</div><div class="line">		<span class="comment">//  判断选择的目录是否已经添加过规格</span></div><div class="line">	  $.getJSON(<span class="string">"/item/param/query/itemcatid/"</span> + node.id,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">		  <span class="keyword">if</span>(data.status == <span class="number">200</span> &amp;&amp; data.data)&#123;</div><div class="line">			  $.messager.alert(<span class="string">"提示"</span>, <span class="string">"该类目已经添加，请选择其他类目。"</span>, <span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				 $(<span class="string">"#itemParamAddTable .selectItemCat"</span>).click();</div><div class="line">			  &#125;);</div><div class="line">			  <span class="keyword">return</span> ;</div><div class="line">		  &#125;</div><div class="line">		  $(<span class="string">".addGroupTr"</span>).show();</div><div class="line">	  &#125;);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>分析这段js代码，先会向/item/param/query/itemcatid/{cid}进行请求，请求会返回json数据进行解析，判断其中的status和data. </p>
<p>请求的url:/item/param/query/itemcatid/{cid}</p>
<p>参数：cid</p>
<p>返回结果：status和data,因此可以使用esaleResult</p>
<ul>
<li>dao层</li>
</ul>
<p>可以使用逆向工程生成的代码</p>
<ul>
<li>service</li>
</ul>
<p>接受参数cid ，根据参数cid调用mapper查询模板是否存在，如果存在应该返回esaleResult，并且把查询的结果放到esaleResult的data属性；如果不存在，则直接返回esaleResult。</p>
<p>参数：cid</p>
<p>返回值：esaleResult</p>
<ul>
<li>controller</li>
</ul>
<h3 id="7-2-提交规格参数模板"><a href="#7-2-提交规格参数模板" class="headerlink" title="7.2 提交规格参数模板"></a>7.2 提交规格参数模板</h3><h3 id="7-3-保存规格参数"><a href="#7-3-保存规格参数" class="headerlink" title="7.3 保存规格参数"></a>7.3 保存规格参数</h3><p>生成规格参数json字符串的处理：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//取商品的规格</span></div><div class="line">		<span class="keyword">var</span> paramJson = [];</div><div class="line">		$(<span class="string">"#itemAddForm .params li"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,e</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> trs = $(e).find(<span class="string">"tr"</span>);</div><div class="line">			<span class="keyword">var</span> group = trs.eq(<span class="number">0</span>).text();</div><div class="line">			<span class="keyword">var</span> ps = [];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>;i&lt;trs.length;i++)&#123;</div><div class="line">				<span class="keyword">var</span> tr = trs.eq(i);</div><div class="line">				ps.push(&#123;</div><div class="line">					<span class="string">"k"</span> : $.trim(tr.find(<span class="string">"td"</span>).eq(<span class="number">0</span>).find(<span class="string">"span"</span>).text()),</div><div class="line">					<span class="string">"v"</span> : $.trim(tr.find(<span class="string">"input"</span>).val())</div><div class="line">				&#125;);</div><div class="line">			&#125;</div><div class="line">			paramJson.push(&#123;</div><div class="line">				<span class="string">"group"</span> : group,</div><div class="line">				<span class="string">"params"</span>: ps</div><div class="line">			&#125;);</div><div class="line">		&#125;);</div><div class="line">		<span class="comment">//把json对象转换成字符串</span></div><div class="line">		paramJson = <span class="built_in">JSON</span>.stringify(paramJson);</div><div class="line">		$(<span class="string">"#itemAddForm [name=itemParams]"</span>).val(paramJson);</div></pre></td></tr></table></figure></p>
<p>需要在controller和service中添加一个参数接受商品的规格参数即可。</p>
<ul>
<li>service</li>
</ul>
<h2 id="8-前台系统搭建——服务层和表现层"><a href="#8-前台系统搭建——服务层和表现层" class="headerlink" title="8 . 前台系统搭建——服务层和表现层"></a>8 . 前台系统搭建——服务层和表现层</h2><p><img src="http://note.youdao.com/noteshare?id=9a0c71e86f2d1fafa0560e962a2f8588" alt="image"></p>
<p>可以把业务逻辑提取出来，发布服务，供pc、移动端公用。</p>
<ul>
<li>好处：</li>
</ul>
<ol>
<li>提高代码复用度</li>
<li>可以灵活的进行分布式部署。</li>
<li>系统之间耦合度低</li>
<li>团队之间开发不冲突。</li>
</ol>
<ul>
<li>缺点</li>
</ul>
<ol>
<li>需要发布Webservice,系统之间需要远程调用。</li>
<li>工作量增加</li>
<li>需要系统之间协作才能完成业务，系统调用之间变得复杂</li>
</ol>
<p>需要创建两个工程：</p>
<p>服务层esale-rest：没有表现层只有业务逻辑，需要发布服务</p>
<p>表现层esale-portal：只有表现层，没有业务逻辑，不需要连接数据库</p>
<p>表现层和服务层通信，使用Webservice进行通信。Rest形式的Webservice:http+json数据</p>
<h3 id="8-1-服务层esale-rest工程搭建"><a href="#8-1-服务层esale-rest工程搭建" class="headerlink" title="8.1 服务层esale-rest工程搭建"></a>8.1 服务层esale-rest工程搭建</h3><p>使用maven来管理工程。需要发布和调用服务，因此是一个web工程，打包成war包。</p>
<ul>
<li>使用的技术</li>
</ul>
<ol>
<li>Mybatis</li>
<li>Spring</li>
<li>发布服务：springmvc（此处不用cxf）</li>
</ol>
<ul>
<li>框架整合</li>
</ul>
<p>参考esale-manager</p>
<ul>
<li>pom.xml</li>
</ul>
<p>添加esale-manager-dao的依赖</p>
<p>添加spring的一来</p>
<p>配置tomcat插件（注意改端口）</p>
<h3 id="8-2-表现层esale-portal"><a href="#8-2-表现层esale-portal" class="headerlink" title="8.2 表现层esale-portal"></a>8.2 表现层esale-portal</h3><ul>
<li>使用的技术：</li>
</ul>
<ol>
<li>spring</li>
<li>springmvc</li>
</ol>
<ul>
<li>依赖的jar包：</li>
</ul>
<ol>
<li>esale-manager-pojo</li>
<li>spring</li>
<li>tomcat插件（注意改端口）</li>
</ol>
<ul>
<li>框架整合</li>
</ul>
<p>spring和springmvc</p>
<p>Maven安装到本地仓库，跳过测试：clean install -DskipTest</p>
<h2 id="9-首页商品类目展示"><a href="#9-首页商品类目展示" class="headerlink" title="9 . 首页商品类目展示"></a>9 . 首页商品类目展示</h2><ol>
<li>类目展示需要异步加载；</li>
<li>商品类目从数据空中获得，调用esale-rest发布的服务获得数据；</li>
<li>可以在首页中使用js直接调用esale-rest发布的服务获得数据</li>
</ol>
<h3 id="9-1-发布商品类目查询服务"><a href="#9-1-发布商品类目查询服务" class="headerlink" title="9.1 发布商品类目查询服务"></a>9.1 发布商品类目查询服务</h3><ul>
<li>分析：<br>获得一个分类列表的数据，要从数据库中查找，从tb_item_cat表中取数据。</li>
</ul>
<p>可以创建一个pojo描述树形列表的节点，其中包含三个属性u\n\i。</p>
<ul>
<li>U：url        String</li>
<li>N：name        String</li>
<li>I：items        List</li>
</ul>
<p>业务逻辑：根据parentid查询子节点列表，并递归调用。</p>
<h2 id="10"><a href="#10" class="headerlink" title="10 ."></a>10 .</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/02/Esale商城项目/" data-id="cj4r0dsec0001hgtxb2hylw2e" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/31/Nginx/" class="article-date">
  <time datetime="2017-05-31T09:42:19.633Z" itemprop="datePublished">2017-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 . 介绍"></a>1 . 介绍</h2><p>Nginx是一个使用c语言开发的高性能的http服务器及反向代理服务器。</p>
<p>Nginx是一款高性能的http服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev所开发，官方测试nginx能够支支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定。</p>
<h2 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2 . 应用场景"></a>2 . 应用场景</h2><ol>
<li>http服务器。Nginx是一个http服务可以独立提供http服务。可以做网页静态服务器。</li>
<li>虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机。</li>
<li>反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用n ginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。</li>
</ol>
<h2 id="3-Nginx的安装"><a href="#3-Nginx的安装" class="headerlink" title="3 . Nginx的安装"></a>3 . Nginx的安装</h2><p>Nginx一般推荐安装在Linux系统，并且要安装c语言的编译环境gcc.</p>
<p><strong><em>注意：以下说明和操作都是在linux操作系统下进行的。</em></strong></p>
<h3 id="3-1-安装nginx依赖的包"><a href="#3-1-安装nginx依赖的包" class="headerlink" title="3.1 安装nginx依赖的包"></a>3.1 安装nginx依赖的包</h3><ul>
<li><p>gcc</p>
<p>  安装nginx需要先将官网下载的源码进行编译，编译依赖gcc环境，如果没有gcc环境，需要安装gcc：yum install gcc-c++ </p>
</li>
<li><p>PCRE</p>
<p>  PCRE(Perl Compatible RegularExpressions)是一个Perl库，包括perl兼容的正则表达式库。<br>nginx的http模块使用pcre来解析正则表达式，所以需要在linux上安装pcre库。<br>yum install -y pcre pcre-devel</p>
<p>  注：pcre-devel是使用pcre开发的一个二次开发库。nginx也需要此库。</p>
</li>
<li><p>zlib</p>
<p>  zlib库提供了很多种压缩和解压缩的方式，nginx使用zlib对http包的内容进行gzip，所以需要在linux上安装zlib库。yum install -y zlib zlib-devel</p>
</li>
<li><p>OpenSSL</p>
<p>  是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。<br>  nginx不仅支持http协议，还支持https（即在ssl协议上传输http），所以需要在linux安装openssl库。yum install -y openssl openssl-devel</p>
</li>
</ul>
<h3 id="3-2-安装nginx步骤"><a href="#3-2-安装nginx步骤" class="headerlink" title="3.2 安装nginx步骤"></a>3.2 安装nginx步骤</h3><ol>
<li>把nginx的源码上传到linux系统</li>
<li>把压缩包解压缩。</li>
<li><p>在当前文件夹中进行configure。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">./configure \</div><div class="line">--prefix=/usr/local/nginx \</div><div class="line">--pid-path=/var/run/nginx/nginx.pid \</div><div class="line">--lock-path=/var/lock/nginx.lock \</div><div class="line">--error-log-path=/var/log/nginx/error.log \</div><div class="line">--http-log-path=/var/log/nginx/access.log \</div><div class="line">--with-http_gzip_static_module \</div><div class="line">--http-client-body-temp-path=/var/temp/nginx/client \</div><div class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \</div><div class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</div><div class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</div><div class="line">--http-scgi-temp-path=/var/temp/nginx/scgi</div></pre></td></tr></table></figure>
<p> 注意：上边将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录</p>
</li>
<li><p>在当前文件夹中执行：make</p>
</li>
<li>在当前文件夹中执行：make install . 执行完毕后，在/usr/local/nginx/文件夹下会生成新的nginx文件夹</li>
</ol>
<h2 id="4-Nginx的启动和停止"><a href="#4-Nginx的启动和停止" class="headerlink" title="4 . Nginx的启动和停止"></a>4 . Nginx的启动和停止</h2><ul>
<li><p>启动</p>
<p>  进入nginx的sbin目录，./nginx就可以启动。<br>  如果正常启动但是无法访问，可能是防火墙造成的问题，使用指令：<br>  vim /etc/sysconfig/iptables来将端口号打开，再重启service iptables restart</p>
</li>
<li><p>停止</p>
<p>  关闭nginx：可以使用kill命令，但是不推荐使用。推荐使用：./nginx -s stop</p>
</li>
<li><p>刷新配置</p>
<p>  ./nginx -s reload</p>
</li>
</ul>
<h2 id="5-Nginx的配置"><a href="#5-Nginx的配置" class="headerlink" title="5 . Nginx的配置"></a>5 . Nginx的配置</h2><p>在/usr/local/nginx/conf目录下nginx.conf文件是nginx的配置文件。</p>
<p>截取部分配置代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">       listen       80;</div><div class="line">       server_name  localhost;</div><div class="line"></div><div class="line">       #charset koi8-r;</div><div class="line"></div><div class="line">       #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">       location / &#123;</div><div class="line">           root   html;</div><div class="line">           index  index.html index.htm;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>其中，<br>一个server就是一个虚拟机；<br>80表示端口号；<br>root html表示虚拟主机的根目录；若配置了另一个虚拟主机，在改变了这个虚拟主机的端口号之后，可以重新配置root html至新的根目录，并且可以修改根目录中的显示内容。</p>
<h2 id="5-使用Nginx配置虚拟机，通过域名区分虚拟机"><a href="#5-使用Nginx配置虚拟机，通过域名区分虚拟机" class="headerlink" title="5 . 使用Nginx配置虚拟机，通过域名区分虚拟机"></a>5 . 使用Nginx配置虚拟机，通过域名区分虚拟机</h2><p>DNS服务器的作用：把域名转换成对应的ip地址，并进行返回。</p>
<p>可以通过修改host文件来指定域名的ip地址。</p>
<p>host文件的位置：C:\Windows\System32\drivers\etc</p>
<p>添加如下修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># test</div><div class="line">10.108.250.115 esale.com</div></pre></td></tr></table></figure></p>
<p>当在本地访问esale.com时，会跳转到10.108.250.115这个ip地址。</p>
<p><strong>若要通过域名区分虚拟机，需要修改nginx.conf配置文件。</strong></p>
<p>在nginx.conf中添加一段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  test.esale.com;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   html-test;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>然后配置DNS来指定域名对应的ip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># test</div><div class="line">10.108.250.115 test.esale.com</div></pre></td></tr></table></figure></p>
<p>再在nginx文件夹下添加拷贝html文件夹并重命名为html-test，则可以访问成功。</p>
<h2 id="6-Nginx的反向代理"><a href="#6-Nginx的反向代理" class="headerlink" title="6 . Nginx的反向代理"></a>6 . Nginx的反向代理</h2><p>反向代理服务器是应用在服务端。决定哪台服务器提供服务。</p>
<h3 id="6-1-反向代理的模拟"><a href="#6-1-反向代理的模拟" class="headerlink" title="6.1 反向代理的模拟"></a>6.1 反向代理的模拟</h3><p>应该有一个nginx服务器，多个应用服务器（可以是tomcat）。需要安装一个nginx和多个tomcat进行模拟。</p>
<p>nginx服务器按上述的过程已经部署完毕。可以在/usr/local/中安装多个tomcat(此处安装了2个tomcat)。并且修改端口号以避免冲突：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8006"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></div><div class="line">···</div><div class="line"> <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8081"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></div><div class="line">               <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></div><div class="line">               <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</div><div class="line">···</div><div class="line"><span class="comment">&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8010"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong><em>Nginx配置文件nginx.conf：</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">upstream tomcats&#123;</div><div class="line">	server 10.108.250.115:8080 ;</div><div class="line">	server 10.108.250.115:8081;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">       listen       80;</div><div class="line">       server_name  tomcat.esale.com;</div><div class="line"></div><div class="line">       #charset koi8-r;</div><div class="line"></div><div class="line">       #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">       location / &#123;</div><div class="line">           proxy_pass http://tomcats;</div><div class="line">           index  index.html index.htm;</div><div class="line">       	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong><em>负载均衡：</em></strong><br>只需要在upstream的server后面添加一个weight即可代表权重。权重越高，分配请求的数量就越多。默认权重是1。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream tomcats&#123;</div><div class="line">	server 10.108.250.115:8080 ;</div><div class="line">	server 10.108.250.115:8081;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/31/Nginx/" data-id="cj4r0dsez000chgtxd71czbbq" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringMVC学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/25/SpringMVC学习/" class="article-date">
  <time datetime="2017-05-25T14:54:21.372Z" itemprop="datePublished">2017-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/25/SpringMVC学习/">SpringMVC学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： SpringMVC</p>
<hr>
<h2 id="二-SpringMVC入门案例"><a href="#二-SpringMVC入门案例" class="headerlink" title="二 . SpringMVC入门案例"></a>二 . SpringMVC入门案例</h2><h2 id="三-HandlerMapping"><a href="#三-HandlerMapping" class="headerlink" title="三 . HandlerMapping"></a>三 . HandlerMapping</h2><p>HandlerMapping：简单url处理器映射器，把url进行集中配置。</p>
<p>注意：映射器之间可以共存</p>
<h2 id="四-HandlerAdapter"><a href="#四-HandlerAdapter" class="headerlink" title="四 . HandlerAdapter"></a>四 . HandlerAdapter</h2><h3 id="4-1-SimpleControllerHandlerAdapter"><a href="#4-1-SimpleControllerHandlerAdapter" class="headerlink" title="4.1 SimpleControllerHandlerAdapter"></a>4.1 SimpleControllerHandlerAdapter</h3><p>继承Controller接口</p>
<h2 id="五-接收页面参数"><a href="#五-接收页面参数" class="headerlink" title="五 . 接收页面参数"></a>五 . 接收页面参数</h2><p>springmvc使用<strong><em>命令设计模式</em></strong>设计封装对象</p>
<h3 id="时间类型转换"><a href="#时间类型转换" class="headerlink" title="时间类型转换"></a>时间类型转换</h3><p>POJO类中定义了时间类Date(),使用initBinder()来进行时间类型转换。<br><code>binder.registerCustomEditor()</code></p>
<h2 id="六-注解开发"><a href="#六-注解开发" class="headerlink" title="六 . 注解开发"></a>六 . 注解开发</h2><h3 id="6-1-RequestMapping"><a href="#6-1-RequestMapping" class="headerlink" title="6.1 RequestMapping"></a>6.1 RequestMapping</h3><ul>
<li><p>集中使用方法：<br>requestMapping(“hello”)<br>requestMapping(“/hello.do”)<br>requestMapping(value=”/hello.do”)<br>requestMapping(value=”/hello.do”,method=RequestMethod.GET) — 注：使用GET方式，则不能直接使用url访问<br>requestMapping(value=”/hello.do”,method=RequestMethod.POST)<br>requestMapping(value=”/hello.do”,method={RequestMethod.POST, RequestMethod.GET})</p>
</li>
<li><p>RequestMapping根路径<br>在类的上方加上RequestMapping(/根路径)，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>此举有利于解决在不同的Controller中出现相同方法时而不能正常封装参数的问题。</p>
<h3 id="6-2-SpringMVC封装参数"><a href="#6-2-SpringMVC封装参数" class="headerlink" title="6.2 SpringMVC封装参数"></a>6.2 SpringMVC封装参数</h3><p><strong><em>注意：springmvc没有成员变量，把需要传递参数对象放入方法中，当请求方法的时候，这个方法里的对象会自动被创建，需要封装的参数会自动被封装到方法的对象里面。</em></strong></p>
<p>在struts2中，参数的封装是基于属性封装的；在SpringMVC中，参数是基于方法进行封装。</p>
<p>SpringMVC可以接受的数据类型包括：基本类型、String类型、数组类型、POJO类型、包装类型、集合类型（List、Map等）···</p>
<p>在参数的接收方面需要注意一定的问题：</p>
<ul>
<li>在基本类型、String类型、数组类型中，表单input标签中的name属性值要和Controller中方法的参数名<strong>一致</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;form action=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/receiveInt.do"</span> method=<span class="string">"post"</span>&gt;</div><div class="line">ID：&lt;input type=<span class="string">"text"</span> name=<span class="string">"id"</span> id=<span class="string">"id"</span>&gt;</div><div class="line">&lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//接受int类型参数</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"receiveInt"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">recieveInt</span><span class="params">(Integer id)</span></span>&#123;</div><div class="line">	System.out.println(id);</div><div class="line">	<span class="keyword">return</span> <span class="string">"success"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>POJO类</li>
</ul>
<h2 id="七-SpringMVC支持json数据"><a href="#七-SpringMVC支持json数据" class="headerlink" title="七 . SpringMVC支持json数据"></a>七 . SpringMVC支持json数据</h2><p>@RequestBody接受前台json数据，把json数据自动封装javaBean。</p>
<p>@responseBody把后台pojo转换json对象，返回到页面。</p>
<h2 id="八-Springmvc多视图"><a href="#八-Springmvc多视图" class="headerlink" title="八 . Springmvc多视图"></a>八 . Springmvc多视图</h2><h2 id="十-Oscache整合SSM项目"><a href="#十-Oscache整合SSM项目" class="headerlink" title="十 . Oscache整合SSM项目"></a>十 . Oscache整合SSM项目</h2><p>约定 ： 商品页面访问量特别大，给商品页面缓存。items路径下所有请求都缓存。</p>
<p>在web.xml中配置过滤器：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>oscache<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.opensymphony.oscache.web.filter.CacheFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>time<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>scope<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>application<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>oscache<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/items/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>利用断点来判断是否存在缓存。</p>
<h2 id="十-SpringMVC的拦截器"><a href="#十-SpringMVC的拦截器" class="headerlink" title="十 . SpringMVC的拦截器"></a>十 . SpringMVC的拦截器</h2><p>在请求处理器映射器映射的时候，就发生拦截。</p>
<h3 id="10-1-局部拦截器"><a href="#10-1-局部拦截器" class="headerlink" title="10.1 局部拦截器"></a>10.1 局部拦截器</h3><p>针对单个处理器映射器，就叫局部拦截器。</p>
<h3 id="10-2-全局拦截器"><a href="#10-2-全局拦截器" class="headerlink" title="10.2 全局拦截器"></a>10.2 全局拦截器</h3><p>在springmvc.xml中添加如下配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--拦截器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--多个拦截器,顺序执行 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.yao.interceptor.Interceptor1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.yao.interceptor.Interceptor2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>拦截器类需要实现<strong><em>HandlerInterceptor接口</em></strong></p>
<p>preHandler在处理映射器之前进行执行<br>return false:拦截<br>return true ：放行</p>
<p>postHandler在还没有调用Controller，还没有返回modelAndView执行</p>
<p>afterCompletion在返回modelAndView之后执行</p>
<p><strong>测试</strong>：</p>
<ul>
<li>测试1<br>拦截器1放行，拦截器2放行：<br>HandlerInterceptor1………preHandle<br>HandlerInterceptor2………preHandle<br>HandlerInterceptor2………postHandle<br>HandlerInterceptor1………postHandle<br>HandlerInterceptor2………afterCompletion<br>HandlerInterceptor1………afterCompletion</li>
<li><p>测试2<br>拦截器1放行，拦截器2阻止：<br>HandlerInterceptor1………preHandle<br>HandlerInterceptor2………preHandle<br>HandlerInterceptor1………afterCompletion</p>
</li>
<li><p>测试3：<br>拦截器1阻止，拦截器2阻止：<br>HandlerInterceptor1………preHandle</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/25/SpringMVC学习/" data-id="cj4r0dsf1000ehgtxt79otay4" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/05/Redis/">Redis</a>
          </li>
        
          <li>
            <a href="/2017/06/29/Redis与Jedis/">Redis与Jedis</a>
          </li>
        
          <li>
            <a href="/2017/06/29/Solr/">Solr</a>
          </li>
        
          <li>
            <a href="/2017/06/22/设计模式——桥接模式/">设计模式——桥接模式</a>
          </li>
        
          <li>
            <a href="/2017/06/16/设计模式——适配器模式/">设计模式——————适配器模式</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Yao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
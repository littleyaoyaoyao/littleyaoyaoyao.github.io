<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>We-Param</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="New Land">
<meta property="og:type" content="website">
<meta property="og:title" content="We-Param">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="We-Param">
<meta property="og:description" content="New Land">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="We-Param">
<meta name="twitter:description" content="New Land">
  
    <link rel="alternate" href="/atom.xml" title="We-Param" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">We-Param</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-MINA" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/10/16/MINA/" class="article-date">
  <time datetime="2017-10-16T01:12:24.179Z" itemprop="datePublished">2017-10-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/10/16/MINA/">MINA</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： MINA</p>
<hr>
<h2 id="一-介绍"><a href="#一-介绍" class="headerlink" title="一 . 介绍"></a>一 . 介绍</h2><p>MINA 是一个专门设计既能工作在客户端又能工作在服务器端的网络框架。</p>
<p>MINA的优点：</p>
<ol>
<li>易于使用</li>
<li>高并发的用户量</li>
<li>对于现有协议的支持</li>
</ol>
<p>MINA是一个简单、有效的网络框架，它提供了诸多的功能，包括：</p>
<p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/41C4475BB94842AC9FB2079CB72A0573/1880" alt="此处输入图片的描述"></p>
<h2 id="二-服务端和客户端架构"><a href="#二-服务端和客户端架构" class="headerlink" title="二 . 服务端和客户端架构"></a>二 . 服务端和客户端架构</h2><h2 id="三-Acceptor"><a href="#三-Acceptor" class="headerlink" title="三 . Acceptor"></a>三 . Acceptor</h2><p>为了构建一个服务器，需要选择一个IoAccepor接口的实现</p>
<h3 id="3-1-IoAcceptor"><a href="#3-1-IoAcceptor" class="headerlink" title="3.1 IoAcceptor"></a>3.1 IoAcceptor</h3><p>IoAcceptor接口是因为accept()方法的缘故所命名，这个方法负责客户端和服务器端连接的创建。服务器端接收连入的连接请求。</p>
<h2 id="四-Session"><a href="#四-Session" class="headerlink" title="四 . Session"></a>四 . Session</h2><p>Session（会话）是MINA的核心。每当一个客户端连接到服务器，一个新的会话会被创建，并会在客户端关掉连接前一直保存在内存中。</p>
<p>会话用于保存连接的持久信息，以及在请求处理过程中、会话的生命周期中服务器可能需要用到的任何信息。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/10/16/MINA/" data-id="cj8thj5if000d24txfx7xbltn" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Shiro" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/22/Shiro/" class="article-date">
  <time datetime="2017-09-22T02:03:07.734Z" itemprop="datePublished">2017-09-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/22/Shiro/">Shiro</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Shiro</p>
<hr>
<h2 id="一-简介"><a href="#一-简介" class="headerlink" title="一 . 简介"></a>一 . 简介</h2><p>Apache Shiro 是Java 的一个安全框架。<br>Shiro 可以帮助我们完成：认证、授权、加密、会话管理、与Web 集成、缓存等。<br><strong>记住一点，Shiro 不会去维护用户、维护权限；这些需要我们自己去设计/提供；然后通过<br>相应的接口注入给Shiro即可。</strong></p>
<p>一个最简单的Shiro应用经历了如下的过程:</p>
<ol>
<li>应用代码通过Subject来进行认证和授权，而Subject又委托给SecurityManager</li>
<li>我们需要给Shiro 的SecurityManager 注入Realm，从而让SecurityManager 能得到合法<br>的用户及其权限进行判断。</li>
</ol>
<p><strong>Shiro内部框架：</strong><br><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/BBB8CD67388446FF9D30F2055E7D3F33/1622" alt="此处输入图片的描述"></p>
<p><strong>Subject</strong>：主体，可以看到主体可以是任何可以与应用交互的“用户”；</p>
<p><strong>SecurityManager</strong> ：相当于SpringMVC中的DispatcherServlet或者Struts2中的FilterDispatcher；是Shiro的心脏；所有具体的交互都通过SecurityManager进行控制；它管理着所有Subject、且负责进行认证和授权、及会话、缓存的管理。</p>
<p><strong>Authenticator</strong>：认证器，负责主体认证的，这是一个扩展点，如果用户觉得Shiro默认的不好，可以自定义实现；其需要认证策略（Authentication Strategy），即什么情况下算用户认证通过了；</p>
<p><strong>Authrizer</strong>：授权器，或者访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；</p>
<p><strong>Realm</strong>：可以有1个或多个Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是JDBC实现，也可以是LDAP实现，或者内存实现等等；由用户提供；不知道你的用户/权限存储在哪及以何种格式存储；所以我们一般在应用中都需要实现自己的Realm；</p>
<p><strong>SessionManager</strong>：如果写过Servlet就应该知道Session的概念，Session需要有人去管理它的生命周期，这个组件就是SessionManager；而Shiro并不仅仅可以用在Web环境，也可以用在如普通的JavaSE环境、EJB等环境；所有呢，Shiro 就抽象了一个自己的Session来管理主体与应用之间交互的数据；这样的话，比如我们在Web 环境用，刚开始是一台Web 服务器；接着又上了台EJB服务器；这时想把两台服务器的会话数据放到一个地方，这个时候就可以实现自己的分布式会话（如把数据放到Memcached服务器）；</p>
<p><strong>SessionDAO</strong>：DAO 大家都用过，数据访问对象，用于会话的CRUD，比如我们想把Session保存到数据库，那么可以实现自己的SessionDAO，通过如JDBC写到数据库；比如想把Session放到Memcached中，<br>可以实现自己的Memcached SessionDAO；另外SessionDAO中可以使用Cache进行缓存，以提高性能；</p>
<p><strong>CacheManager</strong>：缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本<br>上很少去改变，放到缓存中后可以提高访问的性能</p>
<p><strong>Cryptography</strong>：密码模块，Shiro 提高了一些常见的加密组件用于如密码加密/解密的。</p>
<h2 id="二-身份验证"><a href="#二-身份验证" class="headerlink" title="二 . 身份验证"></a>二 . 身份验证</h2><p>身份验证的步骤：</p>
<ol>
<li>收集用户身份/凭证，即如用户名/密码；</li>
<li>调用Subject.login 进行登录，如果失败将得到相应的AuthenticationException 异常，根<br>据异常提示用户错误信息；否则登录成功；</li>
<li>最后调用Subject.logout进行退出操作。</li>
</ol>
<p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/1B2095C372974E20AA6C7F1F4E836606/1626" alt="此处输入图片的描述"></p>
<p><strong>流程如下：</strong></p>
<ol>
<li><p>首先调用Subject.login(token)进行登录，其会自动委托给SecurityManager，调用之前必须通过SecurityUtils. setSecurityManager()设置；</p>
</li>
<li><p>SecurityManager负责真正的身份验证逻辑；它会委托给Authenticator进行身份验证；</p>
</li>
<li><p>Authenticator才是真正的身份验证者，ShiroAPI中核心的身份认证入口点，此处可以自定义插入自己的实现；</p>
</li>
<li><p>Authenticator可能会委托给相应的AuthenticationStrategy进行多Realm身份验证，默认ModularRealmAuthenticator会调用AuthenticationStrategy进行多Realm身份验证；</p>
</li>
<li><p>Authenticator 会把相应的token传入Realm，从Realm获取身份验证信息，如果没有返回/抛出异常表示身份验证失败了。此处可以配置多个Realm，将按照相应的顺序及策略进行访问。</p>
</li>
</ol>
<h2 id="三-授权"><a href="#三-授权" class="headerlink" title="三 . 授权"></a>三 . 授权</h2><p>授权，也叫访问控制，即在应用中控制谁能访问哪些资源（如访问页面/编辑数据/页面操作等）。在授权中需了解的几个关键对象：主体（Subject）、资源（Resource）、权限（Permission）、角色（Role）。</p>
<h3 id="1-授权方式"><a href="#1-授权方式" class="headerlink" title="1.授权方式"></a>1.授权方式</h3><p>Shiro支持三种方式的授权</p>
<p><strong>编程式</strong>:通过if/else授权代码块完成</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">Subject subject = SecurityUtils.getSubject();</div><div class="line">if(subject.hasRole(“admin”)) &#123;</div><div class="line">//有权限</div><div class="line">&#125; else &#123;</div><div class="line">//无权限</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>注解式</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@RequiresRoles(&quot;admin&quot;)</div><div class="line">public void hello() &#123;</div><div class="line">//有权限</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p><strong>JSP/GSP 标签</strong><br>在JSP/GSP 页面通过相应的标签完成<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;shiro:hasRole name=&quot;admin&quot;&gt;</div><div class="line">&lt;!— 有权限—&gt;</div><div class="line">&lt;/shiro:hasRole&gt;</div></pre></td></tr></table></figure></p>
<h3 id="2-授权"><a href="#2-授权" class="headerlink" title="2.授权"></a>2.授权</h3><h4 id="基于角色的访问控制（隐式角色）"><a href="#基于角色的访问控制（隐式角色）" class="headerlink" title="基于角色的访问控制（隐式角色）"></a><strong>基于角色的访问控制（隐式角色）</strong></h4><ol>
<li>在ini配置文件配置用户拥有的角色(shiro-role.ini)<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;shiro:hasRole name=&quot;admin&quot;&gt;</div><div class="line">&lt;!— 有权限—&gt;</div><div class="line">&lt;/shiro:hasRole&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>规则即：“用户名=密码,角色1，角色2”，如果需要在应用中判断用户是否有相应角色，就需要在相应的Realm中返回角色信息，也就是说Shiro不负责维护用户-角色信息，需要应用提供，Shiro只是提供相应的接口方便验证，后续会介绍如何动态的获取用户角色。</p>
<p><strong>测试</strong><br>这段代码主要是为了判断某个用户是否拥有某个角色或权限，使用了hasRole<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void testHasRole() &#123;</div><div class="line">login(&quot;classpath:shiro-role.ini&quot;, &quot;zhang&quot;, &quot;123&quot;);</div><div class="line">//判断拥有角色：role1</div><div class="line">Assert.assertTrue(subject().hasRole(&quot;role1&quot;));</div><div class="line">//判断拥有角色：role1 and role2</div><div class="line">Assert.assertTrue(subject().hasAllRoles(Arrays.asList(&quot;role1&quot;, &quot;role2&quot;)));</div><div class="line">//判断拥有角色：role1 and role2 and !role3</div><div class="line">boolean[] result = subject().hasRoles(Arrays.asList(&quot;role1&quot;, &quot;role2&quot;, &quot;role3&quot;));</div><div class="line">Assert.assertEquals(true, result[0]);</div><div class="line">Assert.assertEquals(true, result[1]);</div><div class="line">Assert.assertEquals(false, result[2]);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>checkRole判断是否拥有权限中的某一个，若不存在则会抛出异常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Test(expected = UnauthorizedException.class)</div><div class="line">public void testCheckRole() &#123;</div><div class="line">login(&quot;classpath:shiro-role.ini&quot;, &quot;zhang&quot;, &quot;123&quot;);</div><div class="line">//断言拥有角色：role1</div><div class="line">subject().checkRole(&quot;role1&quot;);</div><div class="line">//断言拥有角色：role1 and role3 失败抛出异常</div><div class="line">subject().checkRoles(&quot;role1&quot;, &quot;role3&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>总结：<br>这种方式的缺点就是如果很多地方进行了角色判断，但是有一天不需要了那么就需要修改相应代码把所有相关的地方进行删除；这就是粗粒度造成的问题。</p>
<h4 id="基于资源的访问控制（显示角色）"><a href="#基于资源的访问控制（显示角色）" class="headerlink" title="基于资源的访问控制（显示角色）"></a><strong>基于资源的访问控制（显示角色）</strong></h4><ol>
<li>在ini配置文件配置用户拥有的角色及角色-权限关系（shiro-permission.ini）<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[users]</div><div class="line">zhang=123,role1,role2</div><div class="line">wang=123,role1</div><div class="line">[roles]</div><div class="line">role1=user:create,user:update</div><div class="line">role2=user:create,user:delete</div></pre></td></tr></table></figure>
</li>
</ol>
<p><strong>规则</strong>：<strong>“用户名=密码，角色1，角色2” “角色=权限1，权限2”</strong>，<br>即首先根据用户名找到角色，然后根据角色再找到权限；即角色是权限集合；Shiro 同样不进行权限的维护，需<br>要我们通过Realm返回相应的权限信息。只需要维护“用户——角色”之间的关系即可。</p>
<ol>
<li>测试<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">@Test</div><div class="line">public void testIsPermitted() &#123;</div><div class="line">login(&quot;classpath:shiro-permission.ini&quot;, &quot;zhang&quot;, &quot;123&quot;);</div><div class="line">//判断拥有权限：user:create</div><div class="line">Assert.assertTrue(subject().isPermitted(&quot;user:create&quot;));</div><div class="line">//判断拥有权限：user:update and user:delete</div><div class="line">Assert.assertTrue(subject().isPermittedAll(&quot;user:update&quot;, &quot;user:delete&quot;));</div><div class="line">//判断没有权限：user:view</div><div class="line">Assert.assertFalse(subject().isPermitted(&quot;user:view&quot;));</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Test(expected = UnauthorizedException.class)</div><div class="line">public void testCheckPermission () &#123;</div><div class="line">login(&quot;classpath:shiro-permission.ini&quot;, &quot;zhang&quot;, &quot;123&quot;);</div><div class="line">//断言拥有权限：user:create</div><div class="line">subject().checkPermission(&quot;user:create&quot;);</div><div class="line">//断言拥有权限：user:delete and user:update</div><div class="line">subject().checkPermissions(&quot;user:delete&quot;, &quot;user:update&quot;);</div><div class="line">//断言拥有权限：user:view 失败抛出异常</div><div class="line">subject().checkPermissions(&quot;user:view&quot;);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>总结：<br>这种方式的一般规则是“资源标识符：操作”，即是资源级别的粒度；这种方式的好处就是如果要修改基本都是一个资源级别的修改，不会对其他模块代码产生影响，粒度小。但是实现起来可能稍微复杂点，需要维护“用户——角色，角色——权限（资源：操作）”之间的关系。</p>
<h3 id="3-Permission"><a href="#3-Permission" class="headerlink" title="3.Permission"></a>3.Permission</h3><h4 id="字符串通配符权限"><a href="#字符串通配符权限" class="headerlink" title="字符串通配符权限"></a><strong>字符串通配符权限</strong></h4><p><strong>规则：“资源标识符：操作：对象实例ID”</strong><br><strong>即对哪个资源的哪个实例可以进行什么操作</strong>。其默认支持通配符权限字符串， “:”表示资源/操作/实例的分割； “,”表示操作的分割； “*”表示任意资源/操作/实例。</p>
<ol>
<li><p><strong>单个资源单个权限</strong><br><code>subject().checkPermissions(&quot;system:user:update&quot;);</code><br>用户拥有资源“system:user”的“update”权限</p>
</li>
<li><p><strong>单个资源多个权限</strong></p>
</li>
</ol>
<p>首先，ini配置文件：<br><code>role41=system:user:update,system:user:delete</code></p>
<p>然后，通过代码判断：<br><code>subject().checkPermissions(&quot;system:user:update&quot;, &quot;system:user:delete&quot;);</code></p>
<p>用户拥有资源“system:user”的“update”和“delete”权限。如上可以简写成：</p>
<p>首先，ini配置（表示角色4 拥有system:user资源的update和delete 权限）<br><code>role42=system:user:updata,delete</code></p>
<p>然后，通过代码判断：<br><code>subject().checkPermissions(&quot;system:user:update,delete&quot;);</code><br>如上</p>
<p>3.<strong>单个资源全部权限</strong></p>
<p>ini配置：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">role51=&quot;system:user:create,update,delete,view&quot;</div><div class="line">//亦可以写成:</div><div class="line">role51=system:user:*</div><div class="line">//或者：</div><div class="line">role51=sysytem:user</div></pre></td></tr></table></figure></p>
<p>代码判断：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">subject().checkPermissions(&quot;system:user:create,delete,update:view&quot;);</div><div class="line">//或者</div><div class="line">subject().checkPermissions(&quot;system:user:*&quot;);</div><div class="line">subject().checkPermissions(&quot;system:user&quot;);</div></pre></td></tr></table></figure></p>
<p>4.<strong>所有资源全部权限</strong></p>
<p><code>role=*:view</code><br>如下代码判断：<br><code>subject().checkPermissions(&quot;user:view&quot;);</code><br>用户拥有所有资源的“view”所有权限。</p>
<p>5.<strong>实例级别的权限</strong></p>
<p>5.1 单个实例单个权限</p>
<p>ini配置：<br><code>role=user:view:1</code><br>对资源user的1实例拥有view权限</p>
<p>5.2 单个实例多个权限</p>
<p>ini配置：<br><code>role=&quot;user:update,delete:1&quot;</code><br>对资源user的1实例拥有update,delete权限</p>
<p>同理，将配置改成：<br><code>role=user:*:1</code><br>就能实现所有权限</p>
<p>5.3 所有实例单个权限<br><code>role=user:auth:*</code><br>对资源user的1实例拥有所有权限</p>
<p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/36F95D48822A4378B6B1F7C6CCABFD3B/1628" alt="此处输入图片的描述"></p>
<p><strong>流程如下：</strong></p>
<ol>
<li><p>首先调用Subject.isPermitted<em>/hasRole</em>接口，其会委托给SecurityManager，而<br>SecurityManager接着会委托给Authorizer；</p>
</li>
<li><p>Authorizer是真正的授权者，如果我们调用如isPermitted(“user:view”)，其首先会通过<br>PermissionResolver把字符串转换成相应的Permission实例；</p>
</li>
<li><p>在进行授权之前，其会调用相应的Realm获取Subject相应的角色/权限用于匹配传入的<br>角色/权限；</p>
</li>
<li><p>Authorizer会判断Realm的角色/权限是否和传入的匹配，如果有多个Realm，会委托给<br>ModularRealmAuthorizer 进行循环判断，如果匹配如isPermitted<em>/hasRole</em>会返回true，否<br>则返回false表示授权失败。</p>
</li>
</ol>
<h3 id="4-Authorizer-PerssionResolver-RolePermissionResolver"><a href="#4-Authorizer-PerssionResolver-RolePermissionResolver" class="headerlink" title="4 . Authorizer PerssionResolver RolePermissionResolver"></a>4 . Authorizer PerssionResolver RolePermissionResolver</h3><p><strong>Authorizer</strong>的职责是进行授权（访问控制），是Shiro API中授权核心的入口点，其提供了<br>相应的角色/权限判断接口，具体请参考其Javadoc。<br>SecurityManager 继承了Authorizer接口，且提供了ModularRealmAuthorizer用于多Realm时的授权匹配。<br><strong>PermissionResolver</strong>用于解析权限字符串到Permission实例，而<strong>RolePermissionResolver</strong>用于根据角色解析相应的权限集合。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/22/Shiro/" data-id="cj8thj5iq000m24tx6lugz5ee" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Hadoop" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/08/Hadoop/" class="article-date">
  <time datetime="2017-09-08T08:56:29.771Z" itemprop="datePublished">2017-09-08</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/08/Hadoop/">Hadoop</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Hadoop</p>
<hr>
<h2 id="一-Hadoop概念"><a href="#一-Hadoop概念" class="headerlink" title="一 . Hadoop概念"></a>一 . Hadoop概念</h2><p>Hadoop的三部分 ：<br>mapreduce（分布式计算系统） + yarn（资源管理系统） +  hdfs（分布式文件系统）</p>
<h2 id="二-Hadoop-HDFS核心组件"><a href="#二-Hadoop-HDFS核心组件" class="headerlink" title="二 . Hadoop HDFS核心组件"></a>二 . Hadoop HDFS核心组件</h2><p>分布式的文件存储系统<br>HDFS有两个核心角色：NameNode、DataNode</p>
<ul>
<li>NameNode（仅一个）<br>在HDFS中提供元数据服务<br>负责管理文件系统名称空间和控制外部客户机的访问</li>
</ul>
<p>保存元数据信息，我文件属性，服务器，文件怎么存储</p>
<ul>
<li>DataNode<br>为HDFS提供存储块<br>定期向NameNode汇报存储的文件信息</li>
</ul>
<p>保存文件、心跳汇报</p>
<h2 id="三-Hadoop-MapReduce核心组件"><a href="#三-Hadoop-MapReduce核心组件" class="headerlink" title="三 . Hadoop MapReduce核心组件"></a>三 . Hadoop MapReduce核心组件</h2><p>MapReduce是一种编程模型，分布式计算框架，用于大规模数据集的并行运算。</p>
<ul>
<li>JobTracker<br>任务管理、资源管理（hadoop2 yarn）</li>
</ul>
<ul>
<li>Tasktracker<br>执行（map、reduce），心跳</li>
</ul>
<p><strong>跨服务器的通信是如何完成的？</strong><br>RPC通信框架，自定义RPC<br>远程过程调用协议：webservice、httpclient</p>
<h2 id="四-Hadoop-Hbase核心组件"><a href="#四-Hadoop-Hbase核心组件" class="headerlink" title="四 . Hadoop Hbase核心组件"></a>四 . Hadoop Hbase核心组件</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/08/Hadoop/" data-id="cj8thj5ht000124txsubh3ej5" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Python3 学习笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/01/Python3 学习笔记/" class="article-date">
  <time datetime="2017-09-01T09:41:48.592Z" itemprop="datePublished">2017-09-01</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/01/Python3 学习笔记/">Python3 学习笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： python python3</p>
<hr>
<h2 id="一-散碎的知识点"><a href="#一-散碎的知识点" class="headerlink" title="一 . 散碎的知识点"></a>一 . 散碎的知识点</h2><ol>
<li><p>ord()获取字符的整数表示  chr()把编码转化为对应的字符</p>
</li>
<li><p>list是有序的集合。<strong>list里的元素的数据类型可以不同，list中元素可以是另一个list</strong><br>如：<br>hobby = [‘a’,’b’,’c’]<br>获取最后一个元素：hobby[-1]<br>获取倒数第二个元素：hobby[-2]<br>插入元素到末尾：hobby.append(“d”)<br>出入元素到指定位置：hobby.insert(2,’e’)<br>删除末尾的元素：hobby.pop()<br>删除指定位置的元素：hobby.pop(2)</p>
</li>
<li><p>tuple元祖<br>tuple一旦初始化就不能修改</p>
</li>
<li><p>range(4)生成的序列是从0开始小于5的整数</p>
</li>
<li><p>dict,使用key-value存储<br>其相对于list来说，是用空间换取时间的一种方法</p>
</li>
<li><p>函数中的数据类型检查，是错误和异常处理的一部分</p>
</li>
<li><p>函数默认参数：def power(x , n = 2)默认在缺省第二个参数的时候可以正常运行，<br><strong>默认参数必须指定不变变量</strong>，否则在下次调用函数的时候默认参数的内容就会发生变化</p>
</li>
<li><p>python允许在list或者tuple前面加一个<em>号，把list或tuple的元素变成可变参数传进去<br>num = [1,2,3,4]<br>add(</em>num)</p>
</li>
<li><p><strong>关键字参数：</strong><br>关键字参数允许你传入0个或人一个含参数名的参数，这些关键字参数在函数内部自动组成一个dict</p>
</li>
<li><p><strong>命名关键字参数：</strong><br>命名关键字参数需要一个<strong>特殊分隔符*</strong>，<em>后面的参数被视为命名关键字参数。<br>命名关键字参数必须传入参数名， 如果没有传入参数名，调用将报错。<br><strong>定义：</strong><br>def person(name , age , </em> , city ,job)<br>print(name,age,city,job)<br><strong>调用：</strong><br>person(“tom”,18,city=”beijing”,job=”student”)</p>
</li>
</ol>
<p>此外，命名关键字参数可以有缺省值。</p>
<ol>
<li><strong>参数组合</strong><br>在pyhton中定义函数，可以用必选参数，默认参数，可变参数，关键字参数和命名关键字参数。<br><strong>请注意：</strong>参数定义的顺序必须是：必选参数、默认参数、可变参数/命名关键字参数和关键字参数</li>
</ol>
<h2 id="二-python高级函数"><a href="#二-python高级函数" class="headerlink" title="二 . python高级函数"></a>二 . python高级函数</h2><h3 id="2-1-切片Slice"><a href="#2-1-切片Slice" class="headerlink" title="2.1  切片Slice"></a>2.1  切片Slice</h3><p>例如有一个list , L=[“a”,”b”,”c”,”d”,”e”,”f”,”g”],<br>若要取前4个元素，使用切片的方法可以表示为：<br>L[0:4]。表示从索引0开始，知道索引4结束，不包括索引4。</p>
<p><strong>其他操作示例</strong><br>前10个数，每两个取一个：</p>
<blockquote>
<blockquote>
<blockquote>
<p>L[:10:2]</p>
</blockquote>
</blockquote>
</blockquote>
<p>所有数，每五个取一个：</p>
<blockquote>
<blockquote>
<blockquote>
<p>L[::5]</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="2-2-迭代"><a href="#2-2-迭代" class="headerlink" title="2.2  迭代"></a>2.2  迭代</h3><ul>
<li><p>在python中，迭代是通过for…in来完成。<br>dict也可以迭代，但是由于dict中的存储的是hash值，因此迭代结果的顺序可能不一样。</p>
</li>
<li><p>在python中，只要是<strong>可迭代对象</strong>就可以用使用for循环正常运行。</p>
</li>
</ul>
<p><strong>判断对象是可迭代对象：</strong></p>
<blockquote>
<blockquote>
<blockquote>
<p>from collections import Iterable<br>isinstance(‘abc’, Iterable) #str是否可迭代</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="2-3-列表生成式"><a href="#2-3-列表生成式" class="headerlink" title="2.3  列表生成式"></a>2.3  列表生成式</h3><p>举例：生成平方序列</p>
<blockquote>
<blockquote>
<blockquote>
<p>[a * a for a in range(1,10)]<br>[1,4,9,16,25,36,49,64,81]</p>
</blockquote>
</blockquote>
</blockquote>
<p>还可以加条件：</p>
<blockquote>
<blockquote>
<blockquote>
<p>[a * a for a in range(1,10) if a % 2 ==0]</p>
</blockquote>
</blockquote>
</blockquote>
<p>二层循环：</p>
<blockquote>
<blockquote>
<blockquote>
<p>[m + n for m in ‘ABC’ for n in ‘XYZ’]</p>
</blockquote>
</blockquote>
</blockquote>
<h3 id="2-4-生成器generator"><a href="#2-4-生成器generator" class="headerlink" title="2.4 生成器generator"></a>2.4 生成器generator</h3><p>通过列表生成式，我们可以直接创建一个列表。但是，受到内存限制，列表容量肯定是有限的<br>L是list：<br><code>L = [x * x for x in range(10)]</code></p>
<p>g是generator：<br><code>g = (x * x for x in range(10))</code></p>
<p>将b定义为yield，函数fib()则成为generator：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">def fib(max):</div><div class="line">n, a, b = 0, 0, 1</div><div class="line">while n &lt; max:</div><div class="line">yield b</div><div class="line">a, b = b, a + b</div><div class="line">n = n + 1</div><div class="line">return &apos;done&apos;</div></pre></td></tr></table></figure></p>
<p>generator的函数，在每次调用next()的时候执行，遇到yield语句返回，再次执行时从上次返回的yield语句处继续执行。</p>
<h3 id="2-5-迭代器"><a href="#2-5-迭代器" class="headerlink" title="2.5 迭代器"></a>2.5 迭代器</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/01/Python3 学习笔记/" data-id="cj8thj5ik000h24tx324vmrxe" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-《大型网站系统与Java中间件实践》读书笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/15/《大型网站系统与Java中间件实践》读书笔记/" class="article-date">
  <time datetime="2017-08-15T14:34:29.107Z" itemprop="datePublished">2017-08-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/15/《大型网站系统与Java中间件实践》读书笔记/">《大型网站系统与Java中间件实践》读书笔记</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 读书笔记 中间件</p>
<hr>
<h2 id="一-服务框架"><a href="#一-服务框架" class="headerlink" title="一 . 服务框架"></a>一 . 服务框架</h2><ul>
<li>需求提出：在应用和服务剧增的现状下，转向服务化，调用远程服务。即服务化会是的原来的一些本地调用变成远程调用。</li>
</ul>
<h3 id="1-1-服务调用端（客户端）的设计与实现"><a href="#1-1-服务调用端（客户端）的设计与实现" class="headerlink" title="1.1 服务调用端（客户端）的设计与实现"></a>1.1 服务调用端（客户端）的设计与实现</h3>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/15/《大型网站系统与Java中间件实践》读书笔记/" data-id="cj8thj5j5000z24txmt8v4b9b" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-单点登录系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/02/单点登录系统/" class="article-date">
  <time datetime="2017-08-02T01:48:17.273Z" itemprop="datePublished">2017-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/02/单点登录系统/">单点登录系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 单点登录</p>
<hr>
<h2 id="一-单点登录系统"><a href="#一-单点登录系统" class="headerlink" title="一 . 单点登录系统"></a>一 . 单点登录系统</h2><p>SSO英文全称Single Sign On，单点登录。<br>SSO是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。它包括可以将这次主要的登录映射到其他应用中用于同一个用户的登录的机制。它是目前比较流行的企业业务整合的解决方案之一。</p>
<p><strong>为什么要使用单点登录系统？</strong><br>传统的登录在并发量高的时候需要做集群，配置session复制。如果集群中节点很多，会形成网络风暴。推荐节点不超过5个。因此将系统进行拆分，拆分为多个子系统可以很好地解决这个问题。</p>
<p>系统架构：</p>
<h2 id="二-功能实现"><a href="#二-功能实现" class="headerlink" title="二 . 功能实现"></a>二 . 功能实现</h2><p><strong>注册功能、登录功能、查询功能</strong></p>
<ol>
<li>数据校验接口</li>
</ol>
<p>测试注册的工具：restclient</p>
<p>用户登录接口：</p>
<ol>
<li>接受用户名和密码</li>
<li>校验用户名密码</li>
<li>生成token，可以使用UUID</li>
<li>把用户信息写入redis,key就是token</li>
<li>把token写入cookie</li>
<li>返回登录成功需要把token返回给客户端</li>
</ol>
<p>cookie在其他系统中也会取，因此放在common中</p>
<p>在md5加密时，可以使用spring的DigestUtils.md5DigestAsHex(password.getBytes())<br>token生成：String token = UUID.randomUUID().toString();</p>
<h2 id="三-用户登录拦截器"><a href="#三-用户登录拦截器" class="headerlink" title="三 . 用户登录拦截器"></a>三 . 用户登录拦截器</h2><p>在网站需要用户进行登录后才能进行操作时，可以使用拦截来实现。<br>拦截器的处理流程可以如下：</p>
<ol>
<li>拦截请求的url（在springmvc.xml中配置）</li>
<li>从cookie中取得token（setcookie(request,response,”name”,token)）</li>
<li>如果没有token跳转到登录页面</li>
<li>有token则需要调用单点登录系统sso的服务查询用户信息</li>
<li>若session过期（在设置cookie时，在浏览器关闭的时候，cookie就会消失，redis中是设定时间的），跳转到登录页面</li>
<li>如果没有过期，放行</li>
</ol>
<h2 id="四-登录回调回调"><a href="#四-登录回调回调" class="headerlink" title="四 . 登录回调回调"></a>四 . 登录回调回调</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/02/单点登录系统/" data-id="cj8thj5j5001024tx8bx3z6lg" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/08/02/Redis/" class="article-date">
  <time datetime="2017-08-02T01:48:04.916Z" itemprop="datePublished">2017-08-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/08/02/Redis/">Redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Redis</p>
<hr>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>Redis是一个key-value数据库，支持<em>持久化</em>、<em>数据备份</em>等。</p>
<p>Redis运行在内存中但可以持久化到硬盘中，并且在内存中可以完成很多复杂性强的工作。</p>
<p>Redis有五种数据结构：<strong>字符串String、列表List、哈希表Hash、集合Set、有序集合ZSet</strong>。</p>
<p>Redis不使用表，它的数据库也没有预定义或者强制的方式来要求用户关联Redis存储的不同数据</p>
<p>使用Redis而不是关系数据库或者其他磁盘存储数据库，可以避免写入不必要的临时数据，也免去了对临时数据进行扫描或者删除的麻烦，并最终改善程序的性能。</p>
<ul>
<li><strong>使用场景：</strong><br>缓存（数据查询、短连接、新闻内容、商品内容等等）。（最多使用）<br>分布式集群架构中的session分离。<br>聊天室的在线好友列表。<br>任务队列。（秒杀、抢购、12306等等）<br>应用排行榜。<br>网站访问统计。<br>数据过期处理（可以精确到毫秒）</li>
</ul>
<h2 id="1-Redis的单机版"><a href="#1-Redis的单机版" class="headerlink" title="1. Redis的单机版"></a>1. Redis的单机版</h2><p><strong>安装步骤</strong>：</p>
<ol>
<li>安装gcc编译环境<br>yum install gcc-c++</li>
<li>把redis源码上传到服务器</li>
<li>解压缩<br>tar -zxvf redis-3.0.0.tar.gz<br>进入redis文件夹中</li>
<li>make</li>
<li>make install PREFIX=/usr/local(要安装的位置)</li>
</ol>
<p><strong>启动redis:</strong></p>
<p>前端启动：./redis-server</p>
<p>后台启动：<br>将redis解压后的源码包中的redis.conf拷贝到bin目录下，编辑此文件：daemonize yes<br>./redis-server redis.conf</p>
<p><strong>关闭:</strong><br>强制关闭：kill -9 进程号<br>正常关闭：./redis-cli shutdown</p>
<p>在项目中，建议使用正常关闭。因为redis作为缓存来使用的话，将数据存储到内存中，如果使用正常关闭，则会将内存数据持久化到本地之后再关闭；若是强制关闭，可能会导致部分数据的丢失。</p>
<h2 id="2-Redis客户端"><a href="#2-Redis客户端" class="headerlink" title="2. Redis客户端"></a>2. Redis客户端</h2><h3 id="2-1-启动客户端命令："><a href="#2-1-启动客户端命令：" class="headerlink" title="2.1 启动客户端命令："></a>2.1 启动客户端命令：</h3><p>./redis-cli-p 端口 -h ip地址 &lt;-c&gt;连接集群时使用此参数<br>（其中，-h表示指定访问的redis服务器的ip地址；-p表示指定访问的redis服务器的port端口）</p>
<p><strong>默认端口是6379，ip是localhost:</strong><br>使用：./redis-cli</p>
<p><strong>关闭:</strong></p>
<ol>
<li>ctrl+c</li>
<li>127.0.0.1 &gt; quit</li>
</ol>
<h3 id="2-2-图形界面客户端"><a href="#2-2-图形界面客户端" class="headerlink" title="2.2 图形界面客户端"></a>2.2 图形界面客户端</h3><p>若连接失败，需要设置防火墙：<br>vim /etc/sysconfig/iptables<br>端口设置完成之后，需要重新启动：service iptables restart </p>
<p>redis.conf中设置了默认的数据库16个，如果不指定哪个数据库的话，就默认将数据存储到下标为0的数据库。</p>
<p><strong>redis.conf中的数据库数量的设置：</strong><br><code>databases 16</code></p>
<p><strong>redis.conf中的选择数据库的方式：</strong><br>使用select加上数据库的下标就可以选择指定的数据库来使用(下标从0开始) —&gt;<br>127.0.0.1 &gt; select 15</p>
<h3 id="2-3-Java客户端-Jedis"><a href="#2-3-Java客户端-Jedis" class="headerlink" title="2.3 Java客户端 : Jedis"></a>2.3 Java客户端 : Jedis</h3><p>使用jedis先添加两个jar包：common-pool2-2.3.jar  ， jedis-2.7.0.jar</p>
<p><strong>单实例连接redis：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisClient</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// Jedis</span></div><div class="line">		Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过redis赋值</span></div><div class="line">		jedis.set(<span class="string">"s2"</span>, <span class="string">"222"</span>);</div><div class="line">		<span class="comment">// 通过redis取值</span></div><div class="line">		String result = jedis.get(<span class="string">"s2"</span>);</div><div class="line">		System.out.println(result);</div><div class="line">		<span class="comment">// 关闭jedis</span></div><div class="line">		jedis.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p><strong>使用jedis连接池连接redis服务器:</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisPool</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// JedisPool</span></div><div class="line">		JedisPool pool = <span class="keyword">new</span> JedisPool(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过连接池获取jedis对象</span></div><div class="line">		Jedis jedis = pool.getResource();</div><div class="line"></div><div class="line">		jedis.set(<span class="string">"s4"</span>, <span class="string">"444"</span>);</div><div class="line"></div><div class="line">		String result = jedis.get(<span class="string">"s3"</span>);</div><div class="line">		System.out.println(result);</div><div class="line"></div><div class="line">		<span class="comment">// 关闭jedis客户端</span></div><div class="line">		jedis.close();</div><div class="line"></div><div class="line">		<span class="comment">// 关闭连接池</span></div><div class="line">		pool.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-Redis数据类型"><a href="#3-Redis数据类型" class="headerlink" title="3. Redis数据类型"></a>3. Redis数据类型</h2><h3 id="3-1-String类型"><a href="#3-1-String类型" class="headerlink" title="3.1 String类型"></a>3.1 String类型</h3><ul>
<li>赋值：set key value</li>
<li>取值：get key value</li>
<li>赋值并取值：getset key value</li>
<li>设置/获取多个键值：<br>MSET key value [key value …]<br>MGET key [key …]</li>
<li>删除：DEL key</li>
<li>数值增减：<br>INCR key<br>INCRBY key increment<br>DECR key<br>DECRBY key decrement</li>
</ul>
<p><strong>应用：</strong><br>商品编号、订单号采用string的递增数字特性生成。</p>
<h3 id="3-2-Hash类型"><a href="#3-2-Hash类型" class="headerlink" title="3.2 Hash类型"></a>3.2 Hash类型</h3><p>假设有User对象以JSON序列化的形式存储到Redis中，User对象有id，username、password、age、name等属性，存储的过程如下：<br>保存、更新：<br>User对象 —&gt;  json(string) —&gt; redis<br>如果在业务上只是更新age属性，其他的属性并不做更新应该怎么做呢？ 如果仍然采用上边的方法在传输、处理时会造成资源浪费。而hash可以很好的解决这个问题。</p>
<p>hash叫散列类型，它提供了字段和字段值的映射。字段值只能是字符串类型，不支持散列类型、集合类型等其它类型。其结构为：键、字段、字段值。</p>
<ul>
<li><p>赋值（一个字段值）：HSET key field value</p>
</li>
<li><p>赋值（多个字段值）：HMSET key field value [field value …]</p>
</li>
<li><p>取值（一次取一个值）：HGET key field    </p>
</li>
<li><p>取值（一次可以获取多个字段值）：HMGET key field [field …]    </p>
</li>
<li><p>取值（获取所有字段值）：HGETALL key</p>
</li>
<li><p>删除字段：HDEL key field [field …]、</p>
</li>
<li><p>增加数字：HINCRBY key field increment</p>
</li>
</ul>
<p><strong>应用：存储商品信息</strong></p>
<ul>
<li>定义商品信息的key：<br>商品1001的信息在 Redis中的key为：[items:1001]</li>
<li>存储商品信息：<code>HMSET items:1001 id 3 name apple price 999.9</code></li>
</ul>
<h3 id="3-3-List类型"><a href="#3-3-List类型" class="headerlink" title="3.3 List类型"></a>3.3 List类型</h3><p>Arraylist是使用数组来存储数据，特点：查询快、增删慢<br>Linkedlist是使用双向链表存储数据，特点：增删快、查询慢，但是查询链表两端的数据也很快。</p>
<p><strong>Redis的list是采用来链表来存储的，所以对于redis的list数据类型的操作，是操作list的两端数据来操作的。</strong></p>
<ul>
<li><p>向列表两端增加元素：<br>LPUSH key value [value …]<br>RPUSH key value [value …]</p>
</li>
<li><p>查看列表：LRANGE key start stop<br>例如：lrange list1 0 -1（-1表示右边最后一个元素）</p>
</li>
<li><p>从列表两端弹出元素：<br>LPOP key<br>RPOP key</p>
</li>
<li><p>获取列表中元素的个数：LLEN key</p>
</li>
</ul>
<p><strong>应用：商品评论列表</strong><br>思路：  在redis中创建商品评论列表，用户发布商品信息，将评论信息转成json存储到list中，用户在页面查询评论列表时，从redis中取出json数据展示到页面</p>
<p>定义：商品评论列表key<br>商品编号为1001的商品评论key [item:comment:1001]<br><code>LPUSH items:comment:1001 &#39;{&quot;id&quot;:1,&quot;name&quot;:&quot;商品不错，很好！！&quot;,&quot;date&quot;:1430295077289}&#39;</code></p>
<h3 id="3-4-Set类型"><a href="#3-4-Set类型" class="headerlink" title="3.4 Set类型"></a>3.4 Set类型</h3><p>特点：无序、不可重复</p>
<ul>
<li><p>增加/删除元素：<br>SADD key member [member …]<br>SREM key member [member …]</p>
</li>
<li><p>获得集合中的所有元素：<br>SMEMBERS key</p>
</li>
<li><p>判断元素是否在集合中：<br>SISMEMBER key member</p>
</li>
<li><p>运算命令（差集、交集、并集）</p>
</li>
<li><p>获得元素的个数：scard key</p>
</li>
</ul>
<h3 id="3-5-Zset类型"><a href="#3-5-Zset类型" class="headerlink" title="3.5 Zset类型"></a>3.5 Zset类型</h3><p>有序、不重复、有分数，<strong>根据分数进行排序</strong>。</p>
<ul>
<li><p>增加元素：ZADD key score member [score member …]</p>
</li>
<li><p>获取元素的分数：ZSCORE key member</p>
</li>
<li><p>删除元素：ZREM key member [member …]</p>
</li>
<li><p>获得排名在某个范围的元素列表：    按照元素分数从小到大的顺序返回索引从start到stop之间的所有元素（包含两端的元素）<br>ZRANGE key start stop [WITHSCORES]</p>
</li>
</ul>
<p>从小到大：ZREVRANGE key start stop [WITHSCORES]</p>
<p><strong>应用：商品销售排行榜</strong></p>
<h2 id="4-keys命令"><a href="#4-keys命令" class="headerlink" title="4. keys命令"></a>4. keys命令</h2><ul>
<li>keys：查询所有的key</li>
<li>exits：确认一个key是否存在</li>
<li>rename：重命名key</li>
<li>type：返回值的类型</li>
<li>expire：设置key的生存时间</li>
<li>ttl：查询key的生存时间</li>
</ul>
<h2 id="5-redis持久化方案"><a href="#5-redis持久化方案" class="headerlink" title="5. redis持久化方案"></a>5. redis持久化方案</h2><h3 id="5-1-Rdb"><a href="#5-1-Rdb" class="headerlink" title="5.1 Rdb"></a>5.1 Rdb</h3><p>redis的默认方式，reids通过快照来将数据持久化到磁盘中。</p>
<p><strong>设置持久化快照的条件：</strong><br>在redis.conf中修改持久化快照的条件</p>
<p><strong>rdb问题：</strong><br>一旦redis非法关闭，那么会丢失最后一次持久化之后的数据。</p>
<h3 id="5-2-Aof方式"><a href="#5-2-Aof方式" class="headerlink" title="5.2 Aof方式"></a>5.2 Aof方式</h3><p>redis默认是不使用该方式持久化的。Aof方式的持久化，是操作一次redis数据库，则将操作的记录存储到aof持久化文件中。<br><code>appendonly no</code>改为<br><code>appendonly yes</code><br>加上：<br><code>appendfilename &quot;appendonly.aof&quot;</code></p>
<h3 id="5-3-总结"><a href="#5-3-总结" class="headerlink" title="5.3 总结"></a>5.3 总结</h3><p>在使用aof和rdb方式时，如果redis重启，则数据从aof中加载</p>
<h2 id="6-redis主从复制"><a href="#6-redis主从复制" class="headerlink" title="6. redis主从复制"></a>6. redis主从复制</h2><p>redis的主从复制可以避免单点故障（比如在redis服务器的磁盘损坏）。<br>一个主机可以有多个从机，主机和从机保持同步；从机也可以作为主机。</p>
<h3 id="6-1-主从复制设置"><a href="#6-1-主从复制设置" class="headerlink" title="6.1 主从复制设置"></a>6.1 主从复制设置</h3><p><strong>主机配置：</strong></p>
<p>无需配置</p>
<p><strong>从机配置：</strong></p>
<ul>
<li><p>第一步：复制出一个从机（将文件夹复制出来）</p>
</li>
<li><p>第二步：修改redis.conf中的配置：<br>语法：<br><code>salveof &lt;masterip&gt; &lt;masterport&gt;</code><br>—&gt;<br><code>slaveof ip地址 端口号</code></p>
</li>
<li><p>第三步：修改从机中的ip地址或者端口号</p>
</li>
<li><p>第四步：清楚从机中的持久化文件</p>
</li>
<li><p>第五步：启动从机</p>
</li>
<li><p>启动从机的客户端</p>
</li>
</ul>
<p><strong>注意：</strong>注意一旦发生增删改操作，那么从机会将数据同步到从机中；从机不能执行写操作。</p>
<h2 id="7-Redis集群"><a href="#7-Redis集群" class="headerlink" title="7. Redis集群"></a>7. Redis集群</h2><p>集群中应该至少有三个节点，每个节点有一备份节点。需要6台服务器。</p>
<p>步骤：</p>
<ol>
<li>创建6个redis实例，指定端口从7001到7006</li>
<li>修改redis.conf打开Cluster-enable yes前面的注释</li>
<li>需要一个ruby脚本。在redis源码文件夹下的src目录下。redis-trib.rb</li>
<li>把redis-trib.rb文件复制到到redis-cluster目录下。</li>
<li><strong>执行ruby脚本之前，需要安装ruby环境。</strong><ul>
<li>yum install ruby</li>
<li>yum install rubygems</li>
<li>安装redis-trib.rb运行依赖的ruby的包</li>
</ul>
</li>
</ol>
<p>[root@bogon ~]# gem install redis-3.0.0.gem</p>
<ol>
<li>启动所有的redis实例。 </li>
<li>使用redis-trib.rb创建集群。<br>./redis-trib.rb create –replicas 1 192.168.25.153:7001 192.168.25.153:7002 192.168.25.153:7003 192.168.25.153:7004 192.168.25.153:7005  192.168.25.153:7006</li>
</ol>
<p><strong>使用客户端连接集群： redis01/redis-cli -p 7001 -c</strong></p>
<h2 id="Pub-Sub模式（发布-订阅模式）"><a href="#Pub-Sub模式（发布-订阅模式）" class="headerlink" title="Pub/Sub模式（发布/订阅模式）"></a>Pub/Sub模式（发布/订阅模式）</h2><p>订阅foo频道：<br><code>subscribe foo</code><br>取消订阅foo：<br><code>unsubscribe foo</code></p>
<p>发布端：<br><code>publish foo &quot;I am foo&quot;</code><br>此时在订阅端就能收到message</p>
<p><code>psubscribe f*</code>表示f后带任何字符的频道都能收到信息</p>
<p><strong>应用场景：</strong></p>
<ol>
<li>服务器集群监控管理</li>
<li>聊天服务器</li>
<li>消息弹幕</li>
<li>视频弹幕</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/08/02/Redis/" data-id="cj8thj5im000j24tx1kiw3hou" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Freemarker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/20/Freemarker/" class="article-date">
  <time datetime="2017-07-20T15:54:27.277Z" itemprop="datePublished">2017-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/20/Freemarker/">Freemarker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Freemarker</p>
<hr>
<h2 id="一-Freemarker简介"><a href="#一-Freemarker简介" class="headerlink" title="一 . Freemarker简介"></a>一 . Freemarker简介</h2><p>FreeMarker是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与Web容器无关，即在Web运行时，它并不知道Servlet或HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java 等。</p>
<h2 id="二-Freemarker使用方法"><a href="#二-Freemarker使用方法" class="headerlink" title="二 . Freemarker使用方法"></a>二 . Freemarker使用方法</h2><p>第一步：把freemarker的jar包添加到工程中<br>第二步：freemarker的运行不依赖web容器，可以在java工程中运行。创建一个测试方法进行测试。<br>第三步：创建一个Configration对象<br>第四步：告诉config对象模板文件存放的路径。<br>第五步：设置config的默认字符集。一般是utf-8<br>第六步：从config对象中获得模板对象。需要制定一个模板文件的名字。<br>第七步：创建模板需要的数据集。可以是一个map对象也可以是一个pojo，把模板需要的数据都放入数据集。<br>第八步：创建一个Writer对象，指定生成的文件保存的路径及文件名。<br>第九步：调用模板对象的process方法生成静态文件。需要两个参数数据集和writer对象。<br>第十步：关闭writer对象。</p>
<p><strong>测试代码：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FreeMarkerTest</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFreeMarker</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// 第一步：把freemarker的jar包添加到工程中</span></div><div class="line">		<span class="comment">// 第二步：freemarker的运行不依赖web容器，可以在java工程中运行。创建一个测试方法进行测试。</span></div><div class="line">		<span class="comment">// 第三步：创建一个Configuration对象</span></div><div class="line">		Configuration configuration = <span class="keyword">new</span> Configuration(Configuration.getVersion());</div><div class="line">		<span class="comment">// 第四步：告诉config对象模板文件存放的路径。</span></div><div class="line">		configuration.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(<span class="string">"D:\\workspaces\\JaveEE\\esale-portal\\src\\main\\webapp\\WEB-INF\\ftl"</span>));</div><div class="line">		<span class="comment">// 第五步：设置config的默认字符集。一般是utf-8</span></div><div class="line">		configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</div><div class="line">		<span class="comment">// 第六步：从config对象中获得模板对象。需要制定一个模板文件的名字。</span></div><div class="line">		Template template = configuration.getTemplate(<span class="string">"first.ftl"</span>);</div><div class="line">		<span class="comment">// 第七步：创建模板需要的数据集。可以是一个map对象也可以是一个pojo，把模板需要的数据都放入数据集。</span></div><div class="line">		Map root = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">		root.put(<span class="string">"hello"</span>, <span class="string">"hello freemarker"</span>);</div><div class="line">		<span class="comment">// 第八步：创建一个Writer对象，指定生成的文件保存的路径及文件名。</span></div><div class="line">		Writer out = <span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"D:\\temp\\html\\hello.html"</span>));</div><div class="line">		<span class="comment">// 第九步：调用模板对象的process方法生成静态文件。需要两个参数数据集和writer对象。</span></div><div class="line">		template.process(root, out);</div><div class="line">		<span class="comment">// 第十步：关闭writer对象。</span></div><div class="line">		out.flush();</div><div class="line">		out.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>模板代码：<br><code>${hello}</code></p>
<h2 id="三-Freemarker模板写法"><a href="#三-Freemarker模板写法" class="headerlink" title="三 . Freemarker模板写法"></a>三 . Freemarker模板写法</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/20/Freemarker/" data-id="cj8thj5hw000224txfr5biq5j" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SSM的配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/11/SSM的配置/" class="article-date">
  <time datetime="2017-07-11T15:43:17.409Z" itemprop="datePublished">2017-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/11/SSM的配置/">SSM的配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： SSM 配置文件</p>
<hr>
<p>写此文重新回顾一些最基本的配置。</p>
<h2 id="1-在web-xml中进行配置"><a href="#1-在web-xml中进行配置" class="headerlink" title="1. 在web.xml中进行配置"></a>1. 在web.xml中进行配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">	<span class="attr">id</span>=<span class="string">"esale"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 初始化spring容器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 解决post乱码 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- springmvc的前端控制器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- contextConfigLocation不是必须的， 如果不配置contextConfigLocation， springmvc的配置文件默认在：WEB-INF/servlet的name+"-servlet.xml" --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 使用/会导致静态资源被拦截 ，需要在springmvc.xml中配置--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">	</div><div class="line">	</div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-创建SpringMVC的xml配置文件"><a href="#2-创建SpringMVC的xml配置文件" class="headerlink" title="2. 创建SpringMVC的xml配置文件"></a>2. 创建SpringMVC的xml配置文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></div><div class="line">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">    </div><div class="line">    <span class="comment">&lt;!-- 配置包扫描器 --&gt;</span>    </div><div class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.esale.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 配置注解驱动 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 视图解析器 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 静态资源映射，只有"/"时能够用到 ,这部分需要注意！！！！！！！--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/11/SSM的配置/" data-id="cj8thj5io000k24tx7wckso9u" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis与Jedis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/Redis与Jedis/" class="article-date">
  <time datetime="2017-06-29T14:41:38.114Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/Redis与Jedis/">Redis与Jedis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： jedis redis spring</p>
<hr>
<h2 id="jedis客户端"><a href="#jedis客户端" class="headerlink" title="jedis客户端"></a>jedis客户端</h2><p>在redis搭建完后，需要在java中使用redis,我们使用jedis连接redis服务器。<br>jedis是redis的java版本的客户端实现</p>
<p><strong>jedis连接单机版和集群版有区别。</strong></p>
<h3 id="1-连接单机版"><a href="#1-连接单机版" class="headerlink" title="1 . 连接单机版"></a>1 . 连接单机版</h3><p>先把jedis依赖的jar包添加到工程中。 </p>
<h3 id="4-项目中使用jedis"><a href="#4-项目中使用jedis" class="headerlink" title="4 . 项目中使用jedis"></a>4 . 项目中使用jedis</h3><p>思路：创建一个redis操作的接口。分别创建两个实现类对应redis的单机版和集群版。当使用单机版redis时，配置单机版的实现类，当使用集群版本的时候，配置集群版的实现类。</p>
<p><strong>单机版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * redis客户端单机版实现类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientSingle</span> <span class="keyword">implements</span> <span class="title">JedisClient</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisPool jedisPool;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.set(key, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.get(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.hset(key, item, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.hget(key, item);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.incr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.decr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.expire(key, second);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.ttl(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>集群版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientCluster</span> <span class="keyword">implements</span> <span class="title">JedisClient</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.set(key, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.get(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hset(key, item, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hget(key, item);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.incr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.decr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.expire(key, second);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.ttl(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>spring的配置</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置redis客户端单机版 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPool"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"192.168.25.153"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6379"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置redis客户端实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisClientSingle"</span> <span class="attr">class</span>=<span class="string">"com.taotao.rest.component.impl.JedisClientSingle"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置redis客户端集群版 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;bean id="jedisCluster" class="redis.clients.jedis.JedisCluster"&gt;</span></div><div class="line">		&lt;constructor-arg&gt;</div><div class="line">			&lt;set&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7001"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7002"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7003"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7004"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7005"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7006"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">			&lt;/set&gt;</div><div class="line">		&lt;/constructor-arg&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	&lt;bean id="jedisClientCluster" class="com.taotao.rest.component.impl.JedisClientCluster"/&gt; --&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>若要测试单机版，将集群版进行注释即可；若要测试集群版，将单机版进行注释。</p>
<p><strong>测试</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJedisClientSpring</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">//创建一个spring容器</span></div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:spring/applicationContext-*.xml"</span>);</div><div class="line">		<span class="comment">//从容器中获得JedisClient对象</span></div><div class="line">		JedisClient jedisClient = applicationContext.getBean(JedisClient.class);</div><div class="line">		<span class="comment">//jedisClient操作redis</span></div><div class="line">		jedisClient.set(<span class="string">"cliet1"</span>, <span class="string">"1000"</span>);</div><div class="line">		String string = jedisClient.get(<span class="string">"cliet1"</span>);</div><div class="line">		System.out.println(string);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5-业务逻辑中添加缓存"><a href="#5-业务逻辑中添加缓存" class="headerlink" title="5 . 业务逻辑中添加缓存"></a>5 . 业务逻辑中添加缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;TbContent&gt; <span class="title">getContentList</span><span class="params">(Long cid)</span> </span>&#123;</div><div class="line">		<span class="comment">//添加缓存</span></div><div class="line">		<span class="comment">//查询数据库之前先查询缓存，如果有直接返回</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//从redis中取缓存数据</span></div><div class="line">			String json = jedisClient.hget(REDIS_CONTENT_KEY, cid+<span class="string">""</span>);</div><div class="line">			<span class="keyword">if</span> (!StringUtils.isBlank(json)) &#123;</div><div class="line">				<span class="comment">//把json转换成List</span></div><div class="line">				List&lt;TbContent&gt; list = JsonUtils.jsonToList(json, TbContent.class);</div><div class="line">				<span class="keyword">return</span> list;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 根据cid查询内容列表</span></div><div class="line">		TbContentExample example = <span class="keyword">new</span> TbContentExample();</div><div class="line">		Criteria criteria = example.createCriteria();</div><div class="line">		criteria.andCategoryIdEqualTo(cid);</div><div class="line">		<span class="comment">//执行查询</span></div><div class="line">		List&lt;TbContent&gt; list = contentMapper.selectByExampleWithBLOBs(example);</div><div class="line">		</div><div class="line">		<span class="comment">//返回结果之前，向缓存中添加数据</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//为了规范key可以使用hash</span></div><div class="line">			<span class="comment">//定义一个保存内容的key，hash中每个项就是cid</span></div><div class="line">			<span class="comment">//value是list，需要把list转换成json数据。</span></div><div class="line">			jedisClient.hset(REDIS_CONTENT_KEY, cid+<span class="string">""</span>, JsonUtils.objectToJson(list));</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> list;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="6-缓存同步"><a href="#6-缓存同步" class="headerlink" title="6 . 缓存同步"></a>6 . 缓存同步</h3><p>当后台修改信息后，只需要把redis中缓存的数据删除即可。<br>后台系统并不会直接操作redis数据库。<br>可以发布一个服务，在后台修改数据时，调用该服务。该服务的功能就是删除redis中的缓存。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/29/Redis与Jedis/" data-id="cj8thj5il000i24txf08m8zwp" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/10/16/MINA/">MINA</a>
          </li>
        
          <li>
            <a href="/2017/09/22/Shiro/">Shiro</a>
          </li>
        
          <li>
            <a href="/2017/09/08/Hadoop/">Hadoop</a>
          </li>
        
          <li>
            <a href="/2017/09/01/Python3 学习笔记/">Python3 学习笔记</a>
          </li>
        
          <li>
            <a href="/2017/08/15/《大型网站系统与Java中间件实践》读书笔记/">《大型网站系统与Java中间件实践》读书笔记</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Yao<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
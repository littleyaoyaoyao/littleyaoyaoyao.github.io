<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>We-Param</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="New Land">
<meta property="og:type" content="website">
<meta property="og:title" content="We-Param">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="We-Param">
<meta property="og:description" content="New Land">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="We-Param">
<meta name="twitter:description" content="New Land">
  
    <link rel="alternate" href="/atom.xml" title="We-Param" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">We-Param</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="Flux RSS"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Rechercher"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-单点登录系统" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/22/单点登录系统/" class="article-date">
  <time datetime="2017-07-22T15:51:40.896Z" itemprop="datePublished">2017-07-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/22/单点登录系统/">单点登录系统</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 单点登录</p>
<hr>
<h2 id="一-单点登录系统"><a href="#一-单点登录系统" class="headerlink" title="一 . 单点登录系统"></a>一 . 单点登录系统</h2><p>SSO英文全称Single Sign On，单点登录。<br>SSO是在多个应用系统中，用户只需要登录一次就可以访问所有相互信任的应用系统。它包括可以将这次主要的登录映射到其他应用中用于同一个用户的登录的机制。它是目前比较流行的企业业务整合的解决方案之一。</p>
<p><strong>为什么要使用单点登录系统？</strong><br>传统的登录在并发量高的时候需要做集群，配置session复制。如果集群中节点很多，会形成网络风暴。推荐节点不超过5个。因此将系统进行拆分，拆分为多个子系统可以很好地解决这个问题。</p>
<p>系统架构：<br><img src="http://note.youdao.com/noteshare?id=9a0c71e86f2d1fafa0560e962a2f8588" alt="系统架构"></p>
<p>功能：<br>注册功能、登录功能、查询功能</p>
<p>注册接口的实现：<br>数据校验接口</p>
<p>测试注册的工具：restclient</p>
<p>用户登录接口：</p>
<ol>
<li>接受用户名和密码</li>
<li>校验用户名密码</li>
<li>生成token，可以使用UUID</li>
<li>把用户信息写入redis,key就是token</li>
<li>把token写入cookie</li>
<li>返回登录成功需要把token返回给客户端</li>
</ol>
<p>cookie在其他系统中也会取，因此放在common中</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/22/单点登录系统/" data-id="cj5uc4yk0000uiotx5buz4dq6" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Freemarker" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/20/Freemarker/" class="article-date">
  <time datetime="2017-07-20T15:54:27.277Z" itemprop="datePublished">2017-07-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/20/Freemarker/">Freemarker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Freemarker</p>
<hr>
<h2 id="一-Freemarker简介"><a href="#一-Freemarker简介" class="headerlink" title="一 . Freemarker简介"></a>一 . Freemarker简介</h2><p>FreeMarker是一个用Java语言编写的模板引擎，它基于模板来生成文本输出。FreeMarker与Web容器无关，即在Web运行时，它并不知道Servlet或HTTP。它不仅可以用作表现层的实现技术，而且还可以用于生成XML，JSP或Java 等。</p>
<h2 id="二-Freemarker使用方法"><a href="#二-Freemarker使用方法" class="headerlink" title="二 . Freemarker使用方法"></a>二 . Freemarker使用方法</h2><p>第一步：把freemarker的jar包添加到工程中<br>第二步：freemarker的运行不依赖web容器，可以在java工程中运行。创建一个测试方法进行测试。<br>第三步：创建一个Configration对象<br>第四步：告诉config对象模板文件存放的路径。<br>第五步：设置config的默认字符集。一般是utf-8<br>第六步：从config对象中获得模板对象。需要制定一个模板文件的名字。<br>第七步：创建模板需要的数据集。可以是一个map对象也可以是一个pojo，把模板需要的数据都放入数据集。<br>第八步：创建一个Writer对象，指定生成的文件保存的路径及文件名。<br>第九步：调用模板对象的process方法生成静态文件。需要两个参数数据集和writer对象。<br>第十步：关闭writer对象。</p>
<p><strong>测试代码：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FreeMarkerTest</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFreeMarker</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// 第一步：把freemarker的jar包添加到工程中</span></div><div class="line">		<span class="comment">// 第二步：freemarker的运行不依赖web容器，可以在java工程中运行。创建一个测试方法进行测试。</span></div><div class="line">		<span class="comment">// 第三步：创建一个Configuration对象</span></div><div class="line">		Configuration configuration = <span class="keyword">new</span> Configuration(Configuration.getVersion());</div><div class="line">		<span class="comment">// 第四步：告诉config对象模板文件存放的路径。</span></div><div class="line">		configuration.setDirectoryForTemplateLoading(<span class="keyword">new</span> File(<span class="string">"D:\\workspaces\\JaveEE\\esale-portal\\src\\main\\webapp\\WEB-INF\\ftl"</span>));</div><div class="line">		<span class="comment">// 第五步：设置config的默认字符集。一般是utf-8</span></div><div class="line">		configuration.setDefaultEncoding(<span class="string">"utf-8"</span>);</div><div class="line">		<span class="comment">// 第六步：从config对象中获得模板对象。需要制定一个模板文件的名字。</span></div><div class="line">		Template template = configuration.getTemplate(<span class="string">"first.ftl"</span>);</div><div class="line">		<span class="comment">// 第七步：创建模板需要的数据集。可以是一个map对象也可以是一个pojo，把模板需要的数据都放入数据集。</span></div><div class="line">		Map root = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">		root.put(<span class="string">"hello"</span>, <span class="string">"hello freemarker"</span>);</div><div class="line">		<span class="comment">// 第八步：创建一个Writer对象，指定生成的文件保存的路径及文件名。</span></div><div class="line">		Writer out = <span class="keyword">new</span> FileWriter(<span class="keyword">new</span> File(<span class="string">"D:\\temp\\html\\hello.html"</span>));</div><div class="line">		<span class="comment">// 第九步：调用模板对象的process方法生成静态文件。需要两个参数数据集和writer对象。</span></div><div class="line">		template.process(root, out);</div><div class="line">		<span class="comment">// 第十步：关闭writer对象。</span></div><div class="line">		out.flush();</div><div class="line">		out.close();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>模板代码：<br><code>${hello}</code></p>
<h2 id="三-Freemarker模板写法"><a href="#三-Freemarker模板写法" class="headerlink" title="三 . Freemarker模板写法"></a>三 . Freemarker模板写法</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/20/Freemarker/" data-id="cj5uc4yhp0002iotxk5bmdjpm" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SSM的配置" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/11/SSM的配置/" class="article-date">
  <time datetime="2017-07-11T15:43:17.409Z" itemprop="datePublished">2017-07-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/11/SSM的配置/">SSM的配置</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： SSM 配置文件</p>
<hr>
<p>写此文重新回顾一些最基本的配置。</p>
<h2 id="1-在web-xml中进行配置"><a href="#1-在web-xml中进行配置" class="headerlink" title="1. 在web.xml中进行配置"></a>1. 在web.xml中进行配置</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></div><div class="line">	<span class="attr">xmlns</span>=<span class="string">"http://java.sun.com/xml/ns/javaee"</span> <span class="attr">xmlns:web</span>=<span class="string">"http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd"</span></div><div class="line">	<span class="attr">id</span>=<span class="string">"esale"</span> <span class="attr">version</span>=<span class="string">"2.5"</span>&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">display-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">display-name</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">welcome-file-list</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>index.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.html<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.htm<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">welcome-file</span>&gt;</span>default.jsp<span class="tag">&lt;/<span class="name">welcome-file</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">welcome-file-list</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 初始化spring容器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context-param</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/applicationContext-*.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">listener</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 解决post乱码 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div><div class="line"></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- springmvc的前端控制器 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- contextConfigLocation不是必须的， 如果不配置contextConfigLocation， springmvc的配置文件默认在：WEB-INF/servlet的name+"-servlet.xml" --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>esale-manager<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 使用/会导致静态资源被拦截 ，需要在springmvc.xml中配置--&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></div><div class="line">	</div><div class="line">	</div><div class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="2-创建SpringMVC的xml配置文件"><a href="#2-创建SpringMVC的xml配置文件" class="headerlink" title="2. 创建SpringMVC的xml配置文件"></a>2. 创建SpringMVC的xml配置文件</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:p</span>=<span class="string">"http://www.springframework.org/schema/p"</span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></div><div class="line">        http://www.springframework.org/schema/mvc http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd</div><div class="line">        http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">    </div><div class="line">    <span class="comment">&lt;!-- 配置包扫描器 --&gt;</span>    </div><div class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.esale.controller"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 配置注解驱动 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 视图解析器 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">bean</span></span></div><div class="line">		<span class="attr">class</span>=<span class="string">"org.springframework.web.servlet.view.InternalResourceViewResolver"</span>&gt;</div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"prefix"</span> <span class="attr">value</span>=<span class="string">"/WEB-INF/jsp/"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"suffix"</span> <span class="attr">value</span>=<span class="string">".jsp"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 静态资源映射，只有"/"时能够用到 ,这部分需要注意！！！！！！！--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/11/SSM的配置/" data-id="cj5uc4yjk000iiotxmrip2acr" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/07/09/Redis/" class="article-date">
  <time datetime="2017-07-09T15:44:35.156Z" itemprop="datePublished">2017-07-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/07/09/Redis/">Redis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Redis</p>
<hr>
<h1 id="Redis"><a href="#Redis" class="headerlink" title="Redis"></a>Redis</h1><p>Redis是一个key-value数据库，支持<em>持久化</em>、<em>数据备份</em>等。</p>
<p>Redis运行在内存中但可以持久化到硬盘中，并且在内存中可以完成很多复杂性强的工作。</p>
<p>Redis有五种数据结构：<strong>字符串String、列表List、哈希表Hash、集合Set、有序集合ZSet</strong>。</p>
<p>Redis不使用表，它的数据库也没有预定义或者强制的方式来要求用户关联Redis存储的不同数据</p>
<p>使用Redis而不是关系数据库或者其他磁盘存储数据库，可以避免写入不必要的临时数据，也免去了对临时数据进行扫描或者删除的麻烦，并最终改善程序的性能。</p>
<ul>
<li><strong>使用场景：</strong><br>缓存（数据查询、短连接、新闻内容、商品内容等等）。（最多使用）<br>分布式集群架构中的session分离。<br>聊天室的在线好友列表。<br>任务队列。（秒杀、抢购、12306等等）<br>应用排行榜。<br>网站访问统计。<br>数据过期处理（可以精确到毫秒）</li>
</ul>
<h2 id="1-Redis的单机版"><a href="#1-Redis的单机版" class="headerlink" title="1. Redis的单机版"></a>1. Redis的单机版</h2><p><strong>安装步骤</strong>：</p>
<ol>
<li>安装gcc编译环境<br>yum install gcc-c++</li>
<li>把redis源码上传到服务器</li>
<li>解压缩<br>tar -zxvf redis-3.0.0.tar.gz</li>
<li>make</li>
<li>make install PREFIX=/usr/local(要安装的位置)</li>
</ol>
<p><strong>启动redis:</strong></p>
<p>前端启动：./redis-server</p>
<p>后台启动：<br>将redis解压后的源码包中的redis.conf拷贝到bin目录下，编辑此文件：daemonize yes<br>./redis-server redis.conf</p>
<p><strong>关闭:</strong><br>强制关闭：kill -9 进程号<br>正常关闭：./redis-cli shutdown</p>
<p>在项目中，建议使用正常关闭。因为redis作为缓存来使用的话，将数据存储到内存中，如果使用正常关闭，则会将内存数据持久化到本地之后再关闭；若是强制关闭，可能会导致部分数据的丢失。</p>
<h2 id="2-Redis客户端"><a href="#2-Redis客户端" class="headerlink" title="2. Redis客户端"></a>2. Redis客户端</h2><h3 id="2-1-启动客户端命令："><a href="#2-1-启动客户端命令：" class="headerlink" title="2.1 启动客户端命令："></a>2.1 启动客户端命令：</h3><p>./redis-cli-p 端口 -h ip地址 &lt;-c&gt;连接集群时使用此参数<br>（其中，-h表示指定访问的redis服务器的ip地址；-p表示指定访问的redis服务器的port端口）</p>
<p><strong>默认端口是6379，ip是localhost:</strong><br>使用：./redis-cli</p>
<p><strong>关闭:</strong></p>
<ol>
<li>ctrl+c</li>
<li>127.0.0.1 &gt; quit</li>
</ol>
<h3 id="2-2-图形界面客户端"><a href="#2-2-图形界面客户端" class="headerlink" title="2.2 图形界面客户端"></a>2.2 图形界面客户端</h3><p>若连接失败，需要设置防火墙：<br>vim /etc/sysconfig/iptables<br>端口设置完成之后，需要重新启动：service iptables restart </p>
<p>redis.conf中设置了默认的数据库16个，如果不指定哪个数据库的话，就默认将数据存储到下标为0的数据库。</p>
<p><strong>redis.conf中的数据库数量的设置：</strong><br><code>databases 16</code></p>
<p><strong>redis.conf中的选择数据库的方式：</strong><br>使用select加上数据库的下标就可以选择指定的数据库来使用(下标从0开始) —&gt;<br>127.0.0.1 &gt; select 15</p>
<h3 id="2-3-Java客户端-Jedis"><a href="#2-3-Java客户端-Jedis" class="headerlink" title="2.3 Java客户端 : Jedis"></a>2.3 Java客户端 : Jedis</h3><p>使用jedis先添加两个jar包：common-pool2-2.3.jar  ， jedis-2.7.0.jar</p>
<p><strong>单实例连接redis：</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisClient</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// Jedis</span></div><div class="line">		Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过redis赋值</span></div><div class="line">		jedis.set(<span class="string">"s2"</span>, <span class="string">"222"</span>);</div><div class="line">		<span class="comment">// 通过redis取值</span></div><div class="line">		String result = jedis.get(<span class="string">"s2"</span>);</div><div class="line">		System.out.println(result);</div><div class="line">		<span class="comment">// 关闭jedis</span></div><div class="line">		jedis.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p><strong>使用jedis连接池连接redis服务器:</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">jedisPool</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// JedisPool</span></div><div class="line">		JedisPool pool = <span class="keyword">new</span> JedisPool(<span class="string">"192.168.242.137"</span>, <span class="number">6379</span>);</div><div class="line">		<span class="comment">// 通过连接池获取jedis对象</span></div><div class="line">		Jedis jedis = pool.getResource();</div><div class="line"></div><div class="line">		jedis.set(<span class="string">"s4"</span>, <span class="string">"444"</span>);</div><div class="line"></div><div class="line">		String result = jedis.get(<span class="string">"s3"</span>);</div><div class="line">		System.out.println(result);</div><div class="line"></div><div class="line">		<span class="comment">// 关闭jedis客户端</span></div><div class="line">		jedis.close();</div><div class="line"></div><div class="line">		<span class="comment">// 关闭连接池</span></div><div class="line">		pool.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h2 id="3-Redis数据类型"><a href="#3-Redis数据类型" class="headerlink" title="3. Redis数据类型"></a>3. Redis数据类型</h2><h3 id="3-1-String类型"><a href="#3-1-String类型" class="headerlink" title="3.1 String类型"></a>3.1 String类型</h3><ul>
<li>赋值：set key value</li>
<li>取值：get key value</li>
<li>赋值并取值：getset key value</li>
<li>设置/获取多个键值：<br>MSET key value [key value …]<br>MGET key [key …]</li>
<li>删除：DEL key</li>
<li>数值增减：<br>INCR key<br>INCRBY key increment<br>DECR key<br>DECRBY key decrement</li>
</ul>
<p><strong>应用：</strong><br>商品编号、订单号采用string的递增数字特性生成。</p>
<h3 id="3-2-Hash类型"><a href="#3-2-Hash类型" class="headerlink" title="3.2 Hash类型"></a>3.2 Hash类型</h3><p>假设有User对象以JSON序列化的形式存储到Redis中，User对象有id，username、password、age、name等属性，存储的过程如下：<br>保存、更新：<br>User对象 —&gt;  json(string) —&gt; redis<br>如果在业务上只是更新age属性，其他的属性并不做更新应该怎么做呢？ 如果仍然采用上边的方法在传输、处理时会造成资源浪费。而hash可以很好的解决这个问题。</p>
<p>hash叫散列类型，它提供了字段和字段值的映射。字段值只能是字符串类型，不支持散列类型、集合类型等其它类型。其结构为：键、字段、字段值。</p>
<ul>
<li><p>赋值（一个字段值）：HSET key field value</p>
</li>
<li><p>赋值（多个字段值）：HMSET key field value [field value …]</p>
</li>
<li><p>取值（一次取一个值）：HGET key field    </p>
</li>
<li><p>取值（一次可以获取多个字段值）：HMGET key field [field …]    </p>
</li>
<li><p>取值（获取所有字段值）：HGETALL key</p>
</li>
<li><p>删除字段：HDEL key field [field …]、</p>
</li>
<li><p>增加数字：HINCRBY key field increment</p>
</li>
</ul>
<p><strong>应用：存储商品信息</strong></p>
<ul>
<li>定义商品信息的key：<br>商品1001的信息在 Redis中的key为：[items:1001]</li>
<li>存储商品信息：<code>HMSET items:1001 id 3 name apple price 999.9</code></li>
</ul>
<h3 id="3-3-List类型"><a href="#3-3-List类型" class="headerlink" title="3.3 List类型"></a>3.3 List类型</h3><p>Arraylist是使用数组来存储数据，特点：查询快、增删慢<br>Linkedlist是使用双向链表存储数据，特点：增删快、查询慢，但是查询链表两端的数据也很快。</p>
<p><strong>Redis的list是采用来链表来存储的，所以对于redis的list数据类型的操作，是操作list的两端数据来操作的。</strong></p>
<ul>
<li><p>向列表两端增加元素：<br>LPUSH key value [value …]<br>RPUSH key value [value …]</p>
</li>
<li><p>查看列表：LRANGE key start stop<br>例如：lrange list1 0 -1（-1表示右边最后一个元素）</p>
</li>
<li><p>从列表两端弹出元素：<br>LPOP key<br>RPOP key</p>
</li>
<li><p>获取列表中元素的个数：LLEN key</p>
</li>
</ul>
<p><strong>应用：商品评论列表</strong><br>思路：  在redis中创建商品评论列表，用户发布商品信息，将评论信息转成json存储到list中，用户在页面查询评论列表时，从redis中取出json数据展示到页面</p>
<p>定义：商品评论列表key<br>商品编号为1001的商品评论key [item:comment:1001]<br><code>LPUSH items:comment:1001 &#39;{&quot;id&quot;:1,&quot;name&quot;:&quot;商品不错，很好！！&quot;,&quot;date&quot;:1430295077289}&#39;</code></p>
<h3 id="3-4-Set类型"><a href="#3-4-Set类型" class="headerlink" title="3.4 Set类型"></a>3.4 Set类型</h3><p>特点：无序、不可重复</p>
<ul>
<li><p>增加/删除元素：<br>SADD key member [member …]<br>SREM key member [member …]</p>
</li>
<li><p>获得集合中的所有元素：<br>SMEMBERS key</p>
</li>
<li><p>判断元素是否在集合中：<br>SISMEMBER key member</p>
</li>
<li><p>运算命令（差集、交集、并集）</p>
</li>
<li><p>获得元素的个数：scard key</p>
</li>
</ul>
<h3 id="3-5-Zset类型"><a href="#3-5-Zset类型" class="headerlink" title="3.5 Zset类型"></a>3.5 Zset类型</h3><p>有序、不重复、有分数，<strong>根据分数进行排序</strong>。</p>
<ul>
<li><p>增加元素：ZADD key score member [score member …]</p>
</li>
<li><p>获取元素的分数：ZSCORE key member</p>
</li>
<li><p>删除元素：ZREM key member [member …]</p>
</li>
<li><p>获得排名在某个范围的元素列表：    按照元素分数从小到大的顺序返回索引从start到stop之间的所有元素（包含两端的元素）<br>ZRANGE key start stop [WITHSCORES]</p>
</li>
</ul>
<p>从小到大：ZREVRANGE key start stop [WITHSCORES]</p>
<p><strong>应用：商品销售排行榜</strong></p>
<h2 id="4-keys命令"><a href="#4-keys命令" class="headerlink" title="4. keys命令"></a>4. keys命令</h2><ul>
<li>keys：查询所有的key</li>
<li>exits：确认一个key是否存在</li>
<li>rename：重命名key</li>
<li>type：返回值的类型</li>
<li>expire：设置key的生存时间</li>
<li>ttl：查询key的生存时间</li>
</ul>
<h2 id="5-redis持久化方案"><a href="#5-redis持久化方案" class="headerlink" title="5. redis持久化方案"></a>5. redis持久化方案</h2><h3 id="5-1-Rdb"><a href="#5-1-Rdb" class="headerlink" title="5.1 Rdb"></a>5.1 Rdb</h3><p>redis的默认方式，reids通过快照来将数据持久化到磁盘中。</p>
<p><strong>设置持久化快照的条件：</strong><br>在redis.conf中修改持久化快照的条件</p>
<p><strong>rdb问题：</strong><br>一旦redis非法关闭，那么会丢失最后一次持久化之后的数据。</p>
<h3 id="5-2-Aof方式"><a href="#5-2-Aof方式" class="headerlink" title="5.2 Aof方式"></a>5.2 Aof方式</h3><p>redis默认是不使用该方式持久化的。Aof方式的持久化，是操作一次redis数据库，则将操作的记录存储到aof持久化文件中。<br><code>appendonly no</code>改为<br><code>appendonly yes</code><br>加上：<br><code>appendfilename &quot;appendonly.aof&quot;</code></p>
<h3 id="5-3-总结"><a href="#5-3-总结" class="headerlink" title="5.3 总结"></a>5.3 总结</h3><p>在使用aof和rdb方式时，如果redis重启，则数据从aof中加载</p>
<h2 id="6-redis主从复制"><a href="#6-redis主从复制" class="headerlink" title="6. redis主从复制"></a>6. redis主从复制</h2><p>redis的主从复制可以避免单点故障（比如在redis服务器的磁盘损坏）。<br>一个主机可以有多个从机，主机和从机保持同步；从机也可以作为主机。</p>
<h3 id="6-1-主从复制设置"><a href="#6-1-主从复制设置" class="headerlink" title="6.1 主从复制设置"></a>6.1 主从复制设置</h3><p><strong>主机配置：</strong></p>
<p>无需配置</p>
<p><strong>从机配置：</strong></p>
<ul>
<li><p>第一步：复制出一个从机（将文件夹复制出来）</p>
</li>
<li><p>第二步：修改redis.conf中的配置：<br>语法：<br><code>salveof &lt;masterip&gt; &lt;masterport&gt;</code><br>—&gt;<br><code>slaveof ip地址 端口号</code></p>
</li>
<li><p>第三步：修改从机中的ip地址或者端口号</p>
</li>
<li><p>第四步：清楚从机中的持久化文件</p>
</li>
<li><p>第五步：启动从机</p>
</li>
<li><p>启动从机的客户端</p>
</li>
</ul>
<p><strong>注意：</strong>注意一旦发生增删改操作，那么从机会将数据同步到从机中；从机不能执行写操作。</p>
<h2 id="7-Redis集群"><a href="#7-Redis集群" class="headerlink" title="7. Redis集群"></a>7. Redis集群</h2><p>集群中应该至少有三个节点，每个节点有一备份节点。需要6台服务器。</p>
<p>步骤：</p>
<ol>
<li>创建6个redis实例，指定端口从7001到7006</li>
<li>修改redis.conf打开Cluster-enable yes前面的注释</li>
<li>需要一个ruby脚本。在redis源码文件夹下的src目录下。redis-trib.rb</li>
<li>把redis-trib.rb文件复制到到redis-cluster目录下。</li>
<li><strong>执行ruby脚本之前，需要安装ruby环境。</strong><ul>
<li>yum install ruby</li>
<li>yum install rubygems</li>
<li>安装redis-trib.rb运行依赖的ruby的包</li>
</ul>
</li>
</ol>
<p>[root@bogon ~]# gem install redis-3.0.0.gem</p>
<ol>
<li>启动所有的redis实例。 </li>
<li>使用redis-trib.rb创建集群。<br>./redis-trib.rb create –replicas 1 192.168.25.153:7001 192.168.25.153:7002 192.168.25.153:7003 192.168.25.153:7004 192.168.25.153:7005  192.168.25.153:7006</li>
</ol>
<p><strong>使用客户端连接集群： redis01/redis-cli -p 7001 -c</strong></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/07/09/Redis/" data-id="cj5uc4yjb000diotxy0mbrers" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Redis与Jedis" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/Redis与Jedis/" class="article-date">
  <time datetime="2017-06-29T14:41:38.114Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/Redis与Jedis/">Redis与Jedis</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： jedis redis spring</p>
<hr>
<h2 id="jedis客户端"><a href="#jedis客户端" class="headerlink" title="jedis客户端"></a>jedis客户端</h2><p>在redis搭建完后，需要在java中使用redis,我们使用jedis连接redis服务器。<br>jedis是redis的java版本的客户端实现</p>
<p><strong>jedis连接单机版和集群版有区别。</strong></p>
<h3 id="1-连接单机版"><a href="#1-连接单机版" class="headerlink" title="1 . 连接单机版"></a>1 . 连接单机版</h3><p>先把jedis依赖的jar包添加到工程中。 </p>
<h3 id="4-项目中使用jedis"><a href="#4-项目中使用jedis" class="headerlink" title="4 . 项目中使用jedis"></a>4 . 项目中使用jedis</h3><p>思路：创建一个redis操作的接口。分别创建两个实现类对应redis的单机版和集群版。当使用单机版redis时，配置单机版的实现类，当使用集群版本的时候，配置集群版的实现类。</p>
<p><strong>单机版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * redis客户端单机版实现类</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientSingle</span> <span class="keyword">implements</span> <span class="title">JedisClient</span></span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisPool jedisPool;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.set(key, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.get(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.hset(key, item, value);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		String result = jedis.hget(key, item);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.incr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.decr(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.expire(key, second);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		Jedis jedis = jedisPool.getResource();</div><div class="line">		Long result = jedis.ttl(key);</div><div class="line">		jedis.close();</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>集群版实现类</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JedisClientCluster</span> <span class="keyword">implements</span> <span class="title">JedisClient</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="meta">@Autowired</span></div><div class="line">	<span class="keyword">private</span> JedisCluster jedisCluster;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">set</span><span class="params">(String key, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.set(key, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.get(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">hset</span><span class="params">(String key, String item, String value)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hset(key, item, value);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.hget(key, item);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">incr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.incr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">decr</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.decr(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">expire</span><span class="params">(String key, <span class="keyword">int</span> second)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.expire(key, second);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">ttl</span><span class="params">(String key)</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> jedisCluster.ttl(key);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong>spring的配置</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置redis客户端单机版 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisPool"</span> <span class="attr">class</span>=<span class="string">"redis.clients.jedis.JedisPool"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"host"</span> <span class="attr">value</span>=<span class="string">"192.168.25.153"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">"port"</span> <span class="attr">value</span>=<span class="string">"6379"</span>&gt;</span><span class="tag">&lt;/<span class="name">constructor-arg</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置redis客户端实现类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jedisClientSingle"</span> <span class="attr">class</span>=<span class="string">"com.taotao.rest.component.impl.JedisClientSingle"</span>/&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 配置redis客户端集群版 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;bean id="jedisCluster" class="redis.clients.jedis.JedisCluster"&gt;</span></div><div class="line">		&lt;constructor-arg&gt;</div><div class="line">			&lt;set&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7001"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7002"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7003"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7004"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7005"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">				&lt;bean class="redis.clients.jedis.HostAndPort"&gt;</div><div class="line">					&lt;constructor-arg name="host" value="192.168.25.153"/&gt;</div><div class="line">					&lt;constructor-arg name="port" value="7006"/&gt;</div><div class="line">				&lt;/bean&gt;</div><div class="line">			&lt;/set&gt;</div><div class="line">		&lt;/constructor-arg&gt;</div><div class="line">	&lt;/bean&gt;</div><div class="line">	&lt;bean id="jedisClientCluster" class="com.taotao.rest.component.impl.JedisClientCluster"/&gt; --&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>若要测试单机版，将集群版进行注释即可；若要测试集群版，将单机版进行注释。</p>
<p><strong>测试</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJedisClientSpring</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">//创建一个spring容器</span></div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">"classpath:spring/applicationContext-*.xml"</span>);</div><div class="line">		<span class="comment">//从容器中获得JedisClient对象</span></div><div class="line">		JedisClient jedisClient = applicationContext.getBean(JedisClient.class);</div><div class="line">		<span class="comment">//jedisClient操作redis</span></div><div class="line">		jedisClient.set(<span class="string">"cliet1"</span>, <span class="string">"1000"</span>);</div><div class="line">		String string = jedisClient.get(<span class="string">"cliet1"</span>);</div><div class="line">		System.out.println(string);</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<h3 id="5-业务逻辑中添加缓存"><a href="#5-业务逻辑中添加缓存" class="headerlink" title="5 . 业务逻辑中添加缓存"></a>5 . 业务逻辑中添加缓存</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> List&lt;TbContent&gt; <span class="title">getContentList</span><span class="params">(Long cid)</span> </span>&#123;</div><div class="line">		<span class="comment">//添加缓存</span></div><div class="line">		<span class="comment">//查询数据库之前先查询缓存，如果有直接返回</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//从redis中取缓存数据</span></div><div class="line">			String json = jedisClient.hget(REDIS_CONTENT_KEY, cid+<span class="string">""</span>);</div><div class="line">			<span class="keyword">if</span> (!StringUtils.isBlank(json)) &#123;</div><div class="line">				<span class="comment">//把json转换成List</span></div><div class="line">				List&lt;TbContent&gt; list = JsonUtils.jsonToList(json, TbContent.class);</div><div class="line">				<span class="keyword">return</span> list;</div><div class="line">			&#125;</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="comment">// 根据cid查询内容列表</span></div><div class="line">		TbContentExample example = <span class="keyword">new</span> TbContentExample();</div><div class="line">		Criteria criteria = example.createCriteria();</div><div class="line">		criteria.andCategoryIdEqualTo(cid);</div><div class="line">		<span class="comment">//执行查询</span></div><div class="line">		List&lt;TbContent&gt; list = contentMapper.selectByExampleWithBLOBs(example);</div><div class="line">		</div><div class="line">		<span class="comment">//返回结果之前，向缓存中添加数据</span></div><div class="line">		<span class="keyword">try</span> &#123;</div><div class="line">			<span class="comment">//为了规范key可以使用hash</span></div><div class="line">			<span class="comment">//定义一个保存内容的key，hash中每个项就是cid</span></div><div class="line">			<span class="comment">//value是list，需要把list转换成json数据。</span></div><div class="line">			jedisClient.hset(REDIS_CONTENT_KEY, cid+<span class="string">""</span>, JsonUtils.objectToJson(list));</div><div class="line">		&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">			e.printStackTrace();</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">return</span> list;</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
<h3 id="6-缓存同步"><a href="#6-缓存同步" class="headerlink" title="6 . 缓存同步"></a>6 . 缓存同步</h3><p>当后台修改信息后，只需要把redis中缓存的数据删除即可。<br>后台系统并不会直接操作redis数据库。<br>可以发布一个服务，在后台修改数据时，调用该服务。该服务的功能就是删除redis中的缓存。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/29/Redis与Jedis/" data-id="cj5uc4yjv000qiotxdl8x4jve" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Solr" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/29/Solr/" class="article-date">
  <time datetime="2017-06-29T14:41:12.850Z" itemprop="datePublished">2017-06-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/29/Solr/">Solr</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Solr 搜索系统</p>
<h2 id="Solr"><a href="#Solr" class="headerlink" title="Solr"></a>Solr</h2><p>搜索功能需要发布服务供pc端、移动端使用。根据关键词搜索，得到json格式的搜索结果。创建一个搜索系统，发布搜索服务。</p>
<p>搜索系统使用的技术：</p>
<ul>
<li>mybatis</li>
<li>spring</li>
<li>springmvc</li>
<li>solrj(solr服务的客户端)</li>
</ul>
<h3 id="1-solr服务的搭建"><a href="#1-solr服务的搭建" class="headerlink" title="1 . solr服务的搭建"></a>1 . solr服务的搭建</h3><p>需要在linux系统下搭建solr服务。</p>
<ol>
<li>需要安装tomcat</li>
<li>安装jdk</li>
</ol>
<p><strong>1.1 centos单机版安装：</strong><br>第一步：安装jdk、安装tomcat<br>第二步：解压solr压缩包。<br>第三步：把dist/solr-4.10.3.war部署到tomcat下。<br>第四步：解压缩war包。启动tomcat解压。<br>第五步：需要把/root/solr-4.10.3/example/lib/ext目录下的所有的jar包添加到solr工程中。<br>第六步：创建solrhome。把/root/solr-4.10.3/example/solr文件夹复制一份作为solrhome。<br>第七步：告诉solr服务solrhome的位置。需要修改web.xml<br>第八步：启动tomcat。</p>
<p><strong>1.2 配置中文分析器、自定义业务域</strong></p>
<p>分析器使用IKAnalyzer</p>
<p>使用方法：<br><strong>第一步</strong>：把IKAnalyzer依赖的jar包添加到solr工程中。把分析器使用的扩展词典添加到classpath中。<br><strong>第二步</strong>：需要自定义一个FieldType。Schema.xml中定义。可以在FieldType中指定中文分析器。<br><strong>第三步</strong>：自定义域。指定域的类型为自定义的FieldType</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/29/Solr/" data-id="cj5uc4yjg000giotxol73m3tm" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式——桥接模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/22/设计模式——桥接模式/" class="article-date">
  <time datetime="2017-06-22T14:46:58.567Z" itemprop="datePublished">2017-06-22</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/22/设计模式——桥接模式/">设计模式——桥接模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="标签-：-设计模式-结构型模式-桥接模式"><a href="#标签-：-设计模式-结构型模式-桥接模式" class="headerlink" title="标签 ： 设计模式 结构型模式 桥接模式"></a>标签 ： 设计模式 结构型模式 桥接模式</h2><h1 id="桥接模式（Bridge-Pattern）"><a href="#桥接模式（Bridge-Pattern）" class="headerlink" title="桥接模式（Bridge Pattern）"></a>桥接模式（Bridge Pattern）</h1><h2 id="一-概述"><a href="#一-概述" class="headerlink" title="一 . 概述"></a>一 . 概述</h2><p>将抽象部分和其实现部分进行分离，使他们可以独立地变化。</p>
<h2 id="二-适用性"><a href="#二-适用性" class="headerlink" title="二 . 适用性"></a>二 . 适用性</h2><ol>
<li>类的抽象以及它的实现都应该可以通过生成子类的方法加以扩充</li>
<li>对一个抽象的实现部分的修改应对客户不产生影响，即客户的代码不必重新编译。</li>
<li>你不希望在抽象和它的实现部分之间有一个固定的绑定关系。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/22/设计模式——桥接模式/" data-id="cj5uc4yk5000xiotx266qgp25" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-设计模式——适配器模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/16/设计模式——适配器模式/" class="article-date">
  <time datetime="2017-06-16T07:43:12.347Z" itemprop="datePublished">2017-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/16/设计模式——适配器模式/">设计模式——————适配器模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 设计模式 结构型模式</p>
<hr>
<h1 id="适配器模式（Adapter-Pattern）"><a href="#适配器模式（Adapter-Pattern）" class="headerlink" title="适配器模式（Adapter Pattern）"></a>适配器模式（Adapter Pattern）</h1><h2 id="一-概述"><a href="#一-概述" class="headerlink" title="一 . 概述"></a>一 . 概述</h2><p>适配器模式（Adapter Pattern）是作为两个不兼容的接口之间的桥梁。这种类型的设计模式属于结构型模式，它结合了两个独立接口的功能。</p>
<p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p><strong>实例</strong>：</p>
<ol>
<li>美国电器 110V，中国 220V，就要有一个适配器将 110V 转化为 220V。</li>
<li>JAVA JDK 1.1 提供了 Enumeration 接口，而在 1.2 中提供了 Iterator 接口，想要使用 1.2 的 JDK，则要将以前系统的 Enumeration 接口转化为 Iterator 接口，这时就需要适配器模式。 </li>
<li>在 LINUX 上运行 WINDOWS 程序。 </li>
<li>JAVA 中的 jdbc。</li>
</ol>
<p><strong>解决方式：</strong><br><em>继承</em>  或者 <em>对象组合</em></p>
<h2 id="二-适用性"><a href="#二-适用性" class="headerlink" title="二 . 适用性"></a>二 . 适用性</h2><ol>
<li>你想使用一个已经存在的类，而它的接口不符合你的需求。</li>
<li>想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作 </li>
<li>（仅适用于对象Adapter）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口</li>
</ol>
<h2 id="三-模式中的角色"><a href="#三-模式中的角色" class="headerlink" title="三 . 模式中的角色"></a>三 . 模式中的角色</h2><ul>
<li>目标角色（Target）<br>客户所期待的接口，可以是类、接口、抽象类。</li>
<li>源角色（Adaptee）<br>需要适配的接口</li>
<li>适配器角色（Adapter）<br>适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而<strong>必须是具体类</strong>。</li>
</ul>
<h2 id="四-适配器模式的结构"><a href="#四-适配器模式的结构" class="headerlink" title="四 . 适配器模式的结构"></a>四 . 适配器模式的结构</h2><p>适配器模式有<strong>类适配器模式</strong>和<strong>对象适配器模式</strong>两种不同的形式。</p>
<h2 id="五-对象适配器模式"><a href="#五-对象适配器模式" class="headerlink" title="五 . 对象适配器模式"></a>五 . 对象适配器模式</h2><p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/DD5242C4A3CD4F339C174B3A8478563B/665" alt="此处输入图片的描述"></p>
<p>从上图可以看出，Adaptee类没有sampleOperation2()方法，而客户端则期待这个方法。为使客户端能够使用Adaptee类，需要提供一个(Wrapper)包装类Adapter。这个包装类包装了一个Adaptee的实例，从而此包装类能够把Adaptee的API与Target类的API衔接起来。Adapter与Adaptee是委派关系，这决定了适配器模式是对象的。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>Target<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Target</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//Adaptee有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="comment">//Adaptee没有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adaptee<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Adaptee</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adapter<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Target</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> Adaptee adaptee;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(Adaptee adaptee)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee = adaptee;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee有方法sampleOperation1</div><div class="line">     * 因此适配器类直接委派即可</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee.sampleOperation1();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee没有方法sampleOperation2</div><div class="line">     * 因此由适配器类需要补充此方法</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">//写相关的功能代码</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试类Client<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Target target = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> Adaptee());</div><div class="line">        target.sampleOperation1();</div><div class="line">        </div><div class="line">        target.sampleOperation2();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/16/设计模式——适配器模式/" data-id="cj5uc4yk2000wiotx4u6t0aq8" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring框架学习二" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/09/spring框架学习二/" class="article-date">
  <time datetime="2017-06-09T15:57:54.276Z" itemprop="datePublished">2017-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/09/spring框架学习二/">spring框架学习二</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： spring </p>
<hr>
<h2 id="一-AOP"><a href="#一-AOP" class="headerlink" title="一 . AOP"></a>一 . AOP</h2><h3 id="1-AOP介绍"><a href="#1-AOP介绍" class="headerlink" title="1. AOP介绍"></a>1. AOP介绍</h3><p>aop底层将采用代理机制进行实现<br>接口 + 实现类：spring采用jdk的动态代理Proxy<br>实现类：spring采用cglib字节码增强</p>
<h4 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a><strong>AOP术语</strong></h4><ol>
<li><p>target：目标类，需要被代理的类。例如：UserSerVice</p>
</li>
<li><p>Joinpoint：指那些可能被拦截的方法，例如:所有方法</p>
</li>
<li><p>PointCut : 已经被增强的连接点。例如：addUser()</p>
</li>
<li><p>advice : 通知，增强代码。例如：after()、befor()</p>
</li>
<li><p>Weaving ： 织入，把增强advice应用到目标对象target来创建新的代理对象proxy的过程</p>
</li>
<li><p>proxy ： 代理类</p>
</li>
<li><p>Aspect : 切入点pointcut和通知advice的结合</p>
</li>
</ol>
<h3 id="2-手动方式"><a href="#2-手动方式" class="headerlink" title="2. 手动方式"></a>2. 手动方式</h3><h4 id="2-1-JDK的动态代理"><a href="#2-1-JDK的动态代理" class="headerlink" title="2.1 JDK的动态代理"></a>2.1 JDK的动态代理</h4><p>JDK动态代理对“装饰者”设计模式简化。使用前提：必须有接口<br>目标类：接口 + 实现类<br>切面类：用于存放通知<br>工厂类：编写工厂生成代理<br>测试 : </p>
<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"updateUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"adeleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyAspect.java<br>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设开启事务"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设关闭事务"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyBeanFactory.java<br>工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title">createService</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//1 目标类</span></div><div class="line">		<span class="keyword">final</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</div><div class="line">		<span class="comment">//2切面类</span></div><div class="line">		<span class="keyword">final</span> MyAspect myAspect = <span class="keyword">new</span> MyAspect();</div><div class="line">		<span class="comment">/* 3 代理类：将目标类（切入点）和 切面类（通知） 结合 --&gt; 切面</span></div><div class="line">		 * 	Proxy.newProxyInstance</div><div class="line">		 * 		参数1：loader ，类加载器，动态代理类 运行时创建，任何类都需要类加载器将其加载到内存。</div><div class="line">		 * 			一般情况：当前类.class.getClassLoader();</div><div class="line">		 * 					目标类实例.getClass().get...</div><div class="line">		 * 		参数2：Class[] interfaces 代理类需要实现的所有接口</div><div class="line">		 * 			方式1：目标类实例.getClass().getInterfaces()  ;注意：只能获得自己接口，不能获得父元素接口</div><div class="line">		 * 			方式2：new Class[]&#123;UserService.class&#125;   </div><div class="line">		 * 			例如：jdbc 驱动  --&gt; DriverManager  获得接口 Connection</div><div class="line">		 * 		参数3：InvocationHandler  处理类，接口，必须进行实现类，一般采用匿名内部</div><div class="line">		 * 			提供 invoke 方法，代理类的每一个方法执行时，都将调用一次invoke</div><div class="line">		 * 				参数31：Object proxy ：代理对象</div><div class="line">		 * 				参数32：Method method : 代理对象当前执行的方法的描述对象（反射）</div><div class="line">		 * 					执行方法名：method.getName()</div><div class="line">		 * 					执行方法：method.invoke(对象，实际参数)</div><div class="line">		 * 				参数33：Object[] args :方法实际参数</div><div class="line">		 * </div><div class="line">		 */</div><div class="line">		UserService proxService = (UserService)Proxy.newProxyInstance(</div><div class="line">								MyBeanFactory.class.getClassLoader(), </div><div class="line">								userService.getClass().getInterfaces(), </div><div class="line">								<span class="keyword">new</span> InvocationHandler() &#123;</div><div class="line">									</div><div class="line">									<span class="meta">@Override</span></div><div class="line">									<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">										<span class="comment">//前执行</span></div><div class="line">										myAspect.before();</div><div class="line">										<span class="comment">//执行目标类的方法</span></div><div class="line">										Object obj = method.invoke(userService, args);</div><div class="line">										<span class="comment">//后执行</span></div><div class="line">										myAspect.after();</div><div class="line">										<span class="keyword">return</span> obj;</div><div class="line">									&#125;</div><div class="line">								&#125;);</div><div class="line">		<span class="keyword">return</span> proxService;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test01.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		UserService userService = MyBeanFactory.createService();</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：<br>假设开启事务<br>addUser<br>假设关闭事务<br>假设开启事务<br>updateUser<br>假设关闭事务<br>假设开启事务<br>deleteUser<br>假设关闭事务</p>
<h4 id="2-2-CGLIB字节码增强"><a href="#2-2-CGLIB字节码增强" class="headerlink" title="2.2 CGLIB字节码增强"></a>2.2 CGLIB字节码增强</h4><p>在没有定义业务接口的时候，不能使用JDK动态代理，此时就需要使用CGLIB来完成。其采用了底层的字节码技术，将业务层实现类通过字节码技术来创建子类，并使用拦截器，从而达到动态代理的的效果。</p>
<h3 id="AOP联盟通知模型"><a href="#AOP联盟通知模型" class="headerlink" title="AOP联盟通知模型"></a>AOP联盟通知模型</h3><h3 id="3-spring编写代理：半自动"><a href="#3-spring编写代理：半自动" class="headerlink" title="3. spring编写代理：半自动"></a>3. spring编写代理：半自动</h3><p>让spring创建代理对象，从spring容器中手动获取代理对象。</p>
<ol>
<li>导入jar包：</li>
</ol>
<ul>
<li>4 + 1  </li>
<li>AOP：AOP联盟（规范）；spring-aop（实现）</li>
</ul>
<ol>
<li>目标类和目标类接口</li>
</ol>
<p>UserService.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>UserServiceImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean updateUser"</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean deleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3.切面类</p>
<p>MyAspect.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类中确定通知，需要实现不同接口，接口就是规范，从而就确定方法名称。</div><div class="line"> * 采用“环绕通知” MethodInterceptor</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = mi.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4.配置spring</p>
<p>beans.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 3 创建代理类 </span></div><div class="line">		* 使用工厂bean FactoryBean ，底层调用 getObject() 返回特殊bean</div><div class="line">		* ProxyFactoryBean 用于创建代理工厂bean，生成特殊代理对象</div><div class="line">			interfaces : 确定接口们</div><div class="line">				通过&lt;array&gt;可以设置多个值</div><div class="line">				只有一个值时，value=""</div><div class="line">			target : 确定目标类</div><div class="line">			interceptorNames : 通知 切面类的名称，类型String[]，如果设置一个值 value=""</div><div class="line">			optimize :强制使用cglib</div><div class="line">				&lt;property name="optimize" value="true"&gt;&lt;/property&gt;</div><div class="line">		底层机制</div><div class="line">			如果目标类有接口，采用jdk动态代理</div><div class="line">			如果没有接口，采用cglib 字节码增强</div><div class="line">			如果声明 optimize = true ，无论是否有接口，都采用cglib</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyServiceId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interfaces"</span> <span class="attr">value</span>=<span class="string">"com.itheima.b_factory_bean.UserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"userServiceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"myAspectId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFactoryBean</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		String xmlPath = <span class="string">"com/yao/factory_bean/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		<span class="comment">//获得代理类</span></div><div class="line">		UserService userService = (UserService) applicationContext.getBean(<span class="string">"proxyServiceId"</span>);</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="4-spring-aop编程：全自动"><a href="#4-spring-aop编程：全自动" class="headerlink" title="4. spring aop编程：全自动"></a>4. spring aop编程：全自动</h3><p>从spring容器中获得目标类，如果我们配置了AOP，spring将自动生成代理。<br>要确定目标类，aspectj的切入点表达式，导入jar包:<br><strong>spring-framework-3.0.2.RELEASE-dependencies\org.aspectj\com.springsource.org.aspectj.weaver\1.6.8.RELEASE</strong></p>
<p><strong>目标类和切面类同上。没有变化。</strong></p>
<p>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		3.1 导入命名空间</div><div class="line">		3.2 使用 &lt;aop:config&gt;进行配置</div><div class="line">				proxy-target-class="true" 声明时使用cglib代理</div><div class="line">			&lt;aop:pointcut&gt; 切入点 ，从目标对象获得具体方法</div><div class="line">			&lt;aop:advisor&gt; 特殊的切面，只有一个通知 和 一个切入点</div><div class="line">				advice-ref 通知引用</div><div class="line">				pointcut-ref 切入点引用</div><div class="line">		3.3 切入点表达式</div><div class="line">			execution(* com.itheima.c_spring_aop.*.*(..))</div><div class="line">			选择方法         返回值任意   包                                             类名任意   方法名任意   参数任意</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.c_spring_aop.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAspectId"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpringAop</span></span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">        String xml = <span class="string">"com/yao/springaop/ApplicationContext.xml"</span></div><div class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">        </div><div class="line">        UserService userService = (UserService)applicationContext.getBean(<span class="string">"userServiceId"</span>);</div><div class="line">        userService.addUser();</div><div class="line">        userService.updateUser();</div><div class="line">        userService.deleteUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="5-aspectJ"><a href="#5-aspectJ" class="headerlink" title="5. aspectJ"></a>5. aspectJ</h3><h4 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5.1 介绍"></a>5.1 介绍</h4><p>AspectJ是一个基于Java语言的AOP框架。Spring2.0以后新增了对AspectJ切点表达式支持。<br>@AspectJ 是AspectJ1.5新增功能，通过JDK5注解技术，允许直接在Bean类中定义切面新版本Spring框架，建议使用AspectJ方式来开发AOP。<br>主要用途：自定义开发</p>
<pre><code>此处输入代码
</code></pre><h4 id="5-2-切入点表达式"><a href="#5-2-切入点表达式" class="headerlink" title="5.2 切入点表达式"></a>5.2 切入点表达式</h4><ol>
<li><p>execution()用于描述方法<br> 语法：execution(修饰符 返回值 包.类.方法(参数) throws异常)</p>
<pre><code>修饰符 一般省略
    public        公共方法
    *            任意

返回值，不能省略
    void        返回没有值
    String        返回值字符串
    *             任意

包，[省略]
    com.test.crm            固定包
    com.test.crm.*.service    crm包下面子包任意 （例如：com.test.crm.staff.service）
    com.test.crm..            crm包下面的所有子包（含自己）
    com.test.crm.*.service..  crm包下面任意子包，固定目录service，service目录任意包

类，[省略]
    UserServiceImpl            指定类
    *Impl                    以Impl结尾
    User*                    以User开头
    *                        任意
方法名，不能省略
    addUser                    固定方法
    add*                    以add开头
    *Do                        以Do结尾
    *                        任意
(参数)
    ()                            无参
    (int)                        一个整型
    (int ,int)                    两个
    (..)                        参数任意

throws ,可省略，一般不写。
</code></pre></li>
</ol>
<hr>
<h4 id="5-2-AspectJ通知类型"><a href="#5-2-AspectJ通知类型" class="headerlink" title="5.2 AspectJ通知类型"></a>5.2 AspectJ通知类型</h4><p>aop联盟定义的通知类型，具有特定的接口，必须实现，从而确定方法的名称。<br>AspectJ通知类型，只定义类型名称。</p>
<p>around：环绕通知(应用：十分强大，可以做任何事情)<br>        方法执行前后分别执行，可以阻止方法的执行<br>        <strong>必须手动执行目标方法</strong></p>
<h4 id="5-3-导入jar包"><a href="#5-3-导入jar包" class="headerlink" title="5.3 导入jar包"></a>5.3 导入jar包</h4><p>4个：aop联盟规范 、 spring aop实现 、aspect规范 、 spring aspect实现</p>
<hr>
<h4 id="5-4-基于XML"><a href="#5-4-基于XML" class="headerlink" title="5.4 基于XML"></a>5.4 基于XML</h4><p><strong>首先需要搭建环境</strong></p>
<ol>
<li>目标类 ： 接口 + 实现类</li>
<li>切面类 ： 编写多个通知，采用aspectj通知名称任意（方法名任意）</li>
<li>aop编程： 将通知应用到目标类</li>
<li>测试</li>
</ol>
<p>目标类：省略不写，无变化。</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">**</div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		&lt;aop:aspect&gt; 将切面类 声明“切面”，从而获得通知（方法）</div><div class="line">			ref 切面类引用</div><div class="line">		&lt;aop:pointcut&gt; 声明一个切入点，所有的通知都可以使用。</div><div class="line">			expression 切入点表达式</div><div class="line">			id 名称，用于其它通知引用</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspectId"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.d_aspect.a_xml.UserServiceImpl.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.1 前置通知 </span></div><div class="line">				&lt;aop:before method="" pointcut="" pointcut-ref=""/&gt;</div><div class="line">					method : 通知，及方法名</div><div class="line">					pointcut :**切入点表达式**，此表达式只能当前通知使用。</div><div class="line">					pointcut-ref ： 切入点引用，可以与其他通知共享切入点。</div><div class="line">				通知方法格式：public void myBefore(JoinPoint joinPoint)&#123;</div><div class="line">					参数1：org.aspectj.lang.JoinPoint  用于描述连接点（目标方法），获得目标方法名等</div><div class="line">				例如：</div><div class="line">			&lt;aop:before method="myBefore" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.2后置通知  ,目标方法后执行，获得返回值</span></div><div class="line">				&lt;aop:after-returning method="" pointcut-ref="" returning=""/&gt;</div><div class="line">					returning 通知方法第二个参数的名称</div><div class="line">				通知方法格式：public void myAfterReturning(JoinPoint joinPoint,Object ret)&#123;</div><div class="line">					参数1：连接点描述</div><div class="line">					参数2：类型Object，参数名 returning="ret" 配置的</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-returning method="myAfterReturning" pointcut-ref="myPointCut" returning="ret" /&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.3 环绕通知 </span></div><div class="line">				&lt;aop:around method="" pointcut-ref=""/&gt;</div><div class="line">				通知方法格式：public Object myAround(ProceedingJoinPoint joinPoint) throws Throwable&#123;</div><div class="line">					返回值类型：Object</div><div class="line">					方法名：任意</div><div class="line">					参数：org.aspectj.lang.ProceedingJoinPoint</div><div class="line">					抛出异常</div><div class="line">				执行目标方法：Object obj = joinPoint.proceed();</div><div class="line">				例如：</div><div class="line">			&lt;aop:around method="myAround" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.4 抛出异常</span></div><div class="line">				&lt;aop:after-throwing method="" pointcut-ref="" throwing=""/&gt;</div><div class="line">					throwing ：通知方法的第二个参数名称</div><div class="line">				通知方法格式：public void myAfterThrowing(JoinPoint joinPoint,Throwable e)&#123;</div><div class="line">					参数1：连接点描述对象</div><div class="line">					参数2：获得异常信息，类型Throwable ，参数名由throwing="e" 配置</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-throwing method="myAfterThrowing" pointcut-ref="myPointCut" throwing="e"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.5 最终通知 --&gt;</span>			</div><div class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"myAfter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类不变，getBean中还是得到目标类的bean。</p>
<hr>
<h4 id="5-5-基于注解"><a href="#5-5-基于注解" class="headerlink" title="5.5 基于注解"></a>5.5 基于注解</h4><ol>
<li>替换bean</li>
</ol>
<ol>
<li>替换aop</li>
</ol>
<p>必须进行aspectj代理 </p>
<p>声明切面</p>
<p>替换前置通知 </p>
<p>替换公共切入点</p>
<p>替换抛出异常</p>
<p>@around  在只有一个参数的时候，value是可以省略的；但是有超过一个参数的时候，value就不可以省略</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//切入点当前有效</span></div><div class="line"><span class="comment">//	@Before("execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//声明公共切入点</span></div><div class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))"</span>)</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">myPointCut</span><span class="params">()</span></span>&#123;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterReturning(value="myPointCut()" ,returning="ret")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@Around(value = "myPointCut()")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterThrowing(value="execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))" ,throwing="e")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@After</span>(<span class="string">"myPointCut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 1.扫描 注解类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.itheima.d_aspect.b_anno"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 2.确定 aop注解生效 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="5-6-aop注解总结"><a href="#5-6-aop注解总结" class="headerlink" title="5.6 aop注解总结"></a>5.6 aop注解总结</h4><pre><code>@Aspect 声明切面，修饰切面类，从而获得通知。
</code></pre><p>通知<br>    @Before  前置<br>    @AfterReturning  后置<br>    @Around 环绕<br>    @AfterThrowing 抛出异常<br>    @After 最终</p>
<p>切入点<br>    @PointCut ，修饰方法 private void xxx(){}  之后通过“方法名”获得切入点引用</p>
<hr>
<h2 id="二-JdbcTemplate"><a href="#二-JdbcTemplate" class="headerlink" title="二 . JdbcTemplate"></a>二 . JdbcTemplate</h2><ul>
<li>spring所提供的用于操作JDBC的工具类，相当于DBUtils。</li>
<li>依赖连接池DataSource(数据源)</li>
</ul>
<p>步骤目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1.1 环境搭建</div><div class="line"></div><div class="line">1.2 使用api</div><div class="line"></div><div class="line">1.3 配置DBCP</div><div class="line"></div><div class="line">1.4 配置C3P0</div><div class="line"></div><div class="line">1.5 使用JdbcDaoSupport</div><div class="line"></div><div class="line">1.6 配置properties</div></pre></td></tr></table></figure></p>
<h3 id="1-1-环境搭建"><a href="#1-1-环境搭建" class="headerlink" title="1.1 环境搭建"></a>1.1 环境搭建</h3><p>1.1.1 <strong><em>创建表</em></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">creat database spring_day0410;</div><div class="line"><span class="keyword">use</span> spring_day0410;</div><div class="line">creat table t_user(</div><div class="line">id int primary key auto_inrement;</div><div class="line">username varchar(20);</div><div class="line">password varchar(20);</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'tom'</span>,<span class="number">123</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'jerry'</span>,<span class="number">223</span>);</div></pre></td></tr></table></figure>
<p>1.1.2 <strong><em>导包</em></strong></p>
<p><strong><em>注意：spring3.2和jdk1.8会发生冲突。</em></strong></p>
<p>4+1；<br>数据库驱动；<br>spring-jdba开发；<br>spring事务；<br>c3p0连接池；<br>dbcp连接池（2个）</p>
<p>1.1.3 <strong><em>javabean</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String passsword;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-2-使用api"><a href="#1-2-使用api" class="headerlink" title="1.2 使用api"></a>1.2 使用api</h3><p>通过对api的使用，能够进一步理解spring配置DBCP和C3P0；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApi</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">        <span class="comment">//创建数据源</span></div><div class="line">        BasiataSource dataSource = <span class="keyword">new</span> BasicDataSource();</div><div class="line">        dataSource.setDriveerClassName(<span class="string">"com.sql.jdbc.Driver"</span>);</div><div class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql://localhost:3306/spring_day0410"</span>);</div><div class="line">        dataSource.setUsername(<span class="string">"root"</span>);</div><div class="line">        dataSource.setPassword(<span class="string">"admin"</span>);</div><div class="line">        <span class="comment">//创建模板</span></div><div class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</div><div class="line">        jdbcTemplate.setDataSource(dataSource);</div><div class="line">        <span class="comment">//api操作</span></div><div class="line">        jdbcTemplate.update(<span class="string">"insert into t_user(username,password) values(?,?);"</span>, <span class="string">"tom"</span>,<span class="string">"998"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-配置DBCP"><a href="#1-3-配置DBCP" class="headerlink" title="1.3 配置DBCP"></a>1.3 配置DBCP</h3><p>对照着1.2对api的使用，进行配置DBCP.<br>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 创建数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceId"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ee19_spring_day02"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 创建模板 ,需要注入数据源--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplateId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置dao --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDaoId"</span> <span class="attr">class</span>=<span class="string">"com.yao.c_dbcp.UserDao"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplateId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>UserDao.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line">	<span class="comment">//jdbc模板将由spring注入</span></div><div class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>&#123;</div><div class="line">		String sql = <span class="string">"update t_user set username=?,password=? where id =?"</span>;</div><div class="line">		Object[] args = &#123;user.getUsername(),user.getPassword(),user.getId()&#125;;</div><div class="line">		jdbcTemplate.update(sql, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDBCP</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		User user = <span class="keyword">new</span> User();</div><div class="line">		user.setId(<span class="number">1</span>);</div><div class="line">		user.setUsername(<span class="string">"sam"</span>);</div><div class="line">		user.setPassword(<span class="string">"999"</span>);</div><div class="line">		</div><div class="line">		String xmlPath = <span class="string">"com/itheima/c_dbcp/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		</div><div class="line">		<span class="comment">//获得目标类</span></div><div class="line">		UserDao userDao = (UserDao) applicationContext.getBean(<span class="string">"userDaoId"</span>);</div><div class="line">		userDao.update(user);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-4-配置C3P0"><a href="#1-4-配置C3P0" class="headerlink" title="1.4 配置C3P0"></a>1.4 配置C3P0</h3><p>在创建数据源的部分有变化，<br><code>&lt;bean id=&quot;&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</code></p>
<h3 id="1-5-使用JdbcDaoSupport"><a href="#1-5-使用JdbcDaoSupport" class="headerlink" title="1.5 使用JdbcDaoSupport"></a>1.5 使用JdbcDaoSupport</h3><p>将C3P0和DBCP中的jdbc模板写到了JdbcDaoSupport，作为父类，且作为final存在。<br>因此，要使用JdbcTemplate，就<code>this.getJdbcTemplate()</code>即可。<br>从而，在dao层中， 只需要注入数据源，底层将自动创建模板。</p>
<h3 id="1-6-配置properties"><a href="#1-6-配置properties" class="headerlink" title="1.6 配置properties"></a>1.6 配置properties</h3><p>在spring配置中—–<br>加载配置文件：”classpath:”表示src下<br>使用配置文件：通过${key获得内容}</p>
<p>1.6.1 <strong><em>properties文件</em></strong></p>
<p>1.6.2 <strong><em>spring配置</em></strong></p>
<h2 id="三-整合Junit"><a href="#三-整合Junit" class="headerlink" title="三 . 整合Junit"></a>三 . 整合Junit</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/09/spring框架学习二/" data-id="cj5uc4yjz000tiotxo0rez4pp" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/07/js跨域/" class="article-date">
  <time datetime="2017-06-07T15:57:36.265Z" itemprop="datePublished">2017-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Js跨域"><a href="#Js跨域" class="headerlink" title="Js跨域"></a>Js跨域</h1><p>js为了安全进行了限制，不允许跨域访问。</p>
<p>如果：</p>
<ol>
<li>两个url的域名不同</li>
<li>url相同，端口不同</li>
<li>ip不同</li>
</ol>
<p>则是跨域了。</p>
<p>在esale-portal中不能使用ajax直接调用esale-rest的服务。</p>
<h2 id="解决跨域的问题"><a href="#解决跨域的问题" class="headerlink" title="解决跨域的问题"></a>解决跨域的问题</h2><p>可以使用jsonp来解决跨域问题。</p>
<ol>
<li>在js中不能跨域请求数据，但是<strong>js可以跨域请求js片段</strong>。可以把数据包装成js。</li>
<li>可以把数据使用js方法来包装，形成一条方法的调用语句。</li>
<li>可以使用ajax请求js片段，当js到达浏览器会被立即执行</li>
<li>在浏览器端，先创建好回调方法，在回调方法中通过参数可以获得请求的数据。</li>
</ol>
<p>前期准备：</p>
<ol>
<li>把js的回调方法写好</li>
<li>在ajax请求时，需要把回调方法的方法名传递给服务端</li>
<li>服务端接收回调方法，把数据包装好，响应给客户端。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/07/js跨域/" data-id="cj5uc4yjy000riotxvuup7ym9" class="article-share-link">Partager</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Articles récents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/07/22/单点登录系统/">单点登录系统</a>
          </li>
        
          <li>
            <a href="/2017/07/20/Freemarker/">Freemarker</a>
          </li>
        
          <li>
            <a href="/2017/07/11/SSM的配置/">SSM的配置</a>
          </li>
        
          <li>
            <a href="/2017/07/09/Redis/">Redis</a>
          </li>
        
          <li>
            <a href="/2017/06/29/Redis与Jedis/">Redis与Jedis</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Yao<br>
      Propulsé by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>
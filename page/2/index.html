<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>We-Param</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="New Land">
<meta property="og:type" content="website">
<meta property="og:title" content="We-Param">
<meta property="og:url" content="http://yoursite.com/page/2/index.html">
<meta property="og:site_name" content="We-Param">
<meta property="og:description" content="New Land">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="We-Param">
<meta name="twitter:description" content="New Land">
  
    <link rel="alternate" href="/atom.xml" title="We-Param" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">We-Param</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-设计模式——适配器模式" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/16/设计模式——适配器模式/" class="article-date">
  <time datetime="2017-06-16T07:43:12.347Z" itemprop="datePublished">2017-06-16</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/16/设计模式——适配器模式/">设计模式——————适配器模式</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： 设计模式 结构型模式</p>
<hr>
<h1 id="适配器模式（Adapter-Pattern）"><a href="#适配器模式（Adapter-Pattern）" class="headerlink" title="适配器模式（Adapter Pattern）"></a>适配器模式（Adapter Pattern）</h1><h2 id="一-概述"><a href="#一-概述" class="headerlink" title="一 . 概述"></a>一 . 概述</h2><p>适配器模式（Adapter Pattern）是作为两个不兼容的接口之间的桥梁。这种类型的设计模式属于结构型模式，它结合了两个独立接口的功能。</p>
<p>将一个类的接口转换成客户希望的另外一个接口。Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。</p>
<p><strong>实例</strong>：</p>
<ol>
<li>美国电器 110V，中国 220V，就要有一个适配器将 110V 转化为 220V。</li>
<li>JAVA JDK 1.1 提供了 Enumeration 接口，而在 1.2 中提供了 Iterator 接口，想要使用 1.2 的 JDK，则要将以前系统的 Enumeration 接口转化为 Iterator 接口，这时就需要适配器模式。 </li>
<li>在 LINUX 上运行 WINDOWS 程序。 </li>
<li>JAVA 中的 jdbc。</li>
</ol>
<p><strong>解决方式：</strong><br><em>继承</em>  或者 <em>对象组合</em></p>
<h2 id="二-适用性"><a href="#二-适用性" class="headerlink" title="二 . 适用性"></a>二 . 适用性</h2><ol>
<li>你想使用一个已经存在的类，而它的接口不符合你的需求。</li>
<li>想创建一个可以复用的类，该类可以与其他不相关的类或不可预见的类（即那些接口可能不一定兼容的类）协同工作 </li>
<li>（仅适用于对象Adapter）你想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配它们的接口。对象适配器可以适配它的父类接口</li>
</ol>
<h2 id="三-模式中的角色"><a href="#三-模式中的角色" class="headerlink" title="三 . 模式中的角色"></a>三 . 模式中的角色</h2><ul>
<li>目标角色（Target）<br>客户所期待的接口，可以是类、接口、抽象类。</li>
<li>源角色（Adaptee）<br>需要适配的接口</li>
<li>适配器角色（Adapter）<br>适配器类是本模式的核心。适配器把源接口转换成目标接口。显然，这一角色不可以是接口，而<strong>必须是具体类</strong>。</li>
</ul>
<h2 id="四-适配器模式的结构"><a href="#四-适配器模式的结构" class="headerlink" title="四 . 适配器模式的结构"></a>四 . 适配器模式的结构</h2><p>适配器模式有<strong>类适配器模式</strong>和<strong>对象适配器模式</strong>两种不同的形式。</p>
<h2 id="五-对象适配器模式"><a href="#五-对象适配器模式" class="headerlink" title="五 . 对象适配器模式"></a>五 . 对象适配器模式</h2><p><img src="http://note.youdao.com/yws/public/resource/9a0c71e86f2d1fafa0560e962a2f8588/xmlnote/DD5242C4A3CD4F339C174B3A8478563B/665" alt="此处输入图片的描述"></p>
<p>从上图可以看出，Adaptee类没有sampleOperation2()方法，而客户端则期待这个方法。为使客户端能够使用Adaptee类，需要提供一个(Wrapper)包装类Adapter。这个包装类包装了一个Adaptee的实例，从而此包装类能够把Adaptee的API与Target类的API衔接起来。Adapter与Adaptee是委派关系，这决定了适配器模式是对象的。</p>
<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><p>Target<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">Target</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="comment">//Adaptee有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">    </div><div class="line">    <span class="comment">//Adaptee没有的功能方法</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adaptee<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> class <span class="title">Adaptee</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Adapter<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Adapter</span> <span class="keyword">implements</span> <span class="title">Target</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> Adaptee adaptee;</div><div class="line">    </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Adapter</span><span class="params">(Adaptee adaptee)</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee = adaptee;</div><div class="line">    &#125;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee有方法sampleOperation1</div><div class="line">     * 因此适配器类直接委派即可</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation1</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">this</span>.adaptee.sampleOperation1();</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Adaptee没有方法sampleOperation2</div><div class="line">     * 因此由适配器类需要补充此方法</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sampleOperation2</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="comment">//写相关的功能代码</span></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试类Client<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        Target target = <span class="keyword">new</span> Adapter(<span class="keyword">new</span> Adaptee());</div><div class="line">        target.sampleOperation1();</div><div class="line">        </div><div class="line">        target.sampleOperation2();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/16/设计模式——适配器模式/" data-id="cj70kwxcn000xi4tx88guibyz" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-spring框架学习二" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/09/spring框架学习二/" class="article-date">
  <time datetime="2017-06-09T15:57:54.276Z" itemprop="datePublished">2017-06-09</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/06/09/spring框架学习二/">spring框架学习二</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： spring </p>
<hr>
<h2 id="一-AOP"><a href="#一-AOP" class="headerlink" title="一 . AOP"></a>一 . AOP</h2><h3 id="1-AOP介绍"><a href="#1-AOP介绍" class="headerlink" title="1. AOP介绍"></a>1. AOP介绍</h3><p>aop底层将采用代理机制进行实现<br>接口 + 实现类：spring采用jdk的动态代理Proxy<br>实现类：spring采用cglib字节码增强</p>
<h4 id="AOP术语"><a href="#AOP术语" class="headerlink" title="AOP术语"></a><strong>AOP术语</strong></h4><ol>
<li><p>target：目标类，需要被代理的类。例如：UserSerVice</p>
</li>
<li><p>Joinpoint：指那些可能被拦截的方法，例如:所有方法</p>
</li>
<li><p>PointCut : 已经被增强的连接点。例如：addUser()</p>
</li>
<li><p>advice : 通知，增强代码。例如：after()、befor()</p>
</li>
<li><p>Weaving ： 织入，把增强advice应用到目标对象target来创建新的代理对象proxy的过程</p>
</li>
<li><p>proxy ： 代理类</p>
</li>
<li><p>Aspect : 切入点pointcut和通知advice的结合</p>
</li>
</ol>
<h3 id="2-手动方式"><a href="#2-手动方式" class="headerlink" title="2. 手动方式"></a>2. 手动方式</h3><h4 id="2-1-JDK的动态代理"><a href="#2-1-JDK的动态代理" class="headerlink" title="2.1 JDK的动态代理"></a>2.1 JDK的动态代理</h4><p>JDK动态代理对“装饰者”设计模式简化。使用前提：必须有接口<br>目标类：接口 + 实现类<br>切面类：用于存放通知<br>工厂类：编写工厂生成代理<br>测试 : </p>
<p>UserService.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>UserServiceImpl.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"updateUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">		System.out.println(<span class="string">"adeleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyAspect.java<br>切面类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">before</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设开启事务"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">after</span><span class="params">()</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"假设关闭事务"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>MyBeanFactory.java<br>工厂类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBeanFactory</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> UserService <span class="title">createService</span><span class="params">()</span></span>&#123;</div><div class="line">		<span class="comment">//1 目标类</span></div><div class="line">		<span class="keyword">final</span> UserService userService = <span class="keyword">new</span> UserServiceImpl();</div><div class="line">		<span class="comment">//2切面类</span></div><div class="line">		<span class="keyword">final</span> MyAspect myAspect = <span class="keyword">new</span> MyAspect();</div><div class="line">		<span class="comment">/* 3 代理类：将目标类（切入点）和 切面类（通知） 结合 --&gt; 切面</span></div><div class="line">		 * 	Proxy.newProxyInstance</div><div class="line">		 * 		参数1：loader ，类加载器，动态代理类 运行时创建，任何类都需要类加载器将其加载到内存。</div><div class="line">		 * 			一般情况：当前类.class.getClassLoader();</div><div class="line">		 * 					目标类实例.getClass().get...</div><div class="line">		 * 		参数2：Class[] interfaces 代理类需要实现的所有接口</div><div class="line">		 * 			方式1：目标类实例.getClass().getInterfaces()  ;注意：只能获得自己接口，不能获得父元素接口</div><div class="line">		 * 			方式2：new Class[]&#123;UserService.class&#125;   </div><div class="line">		 * 			例如：jdbc 驱动  --&gt; DriverManager  获得接口 Connection</div><div class="line">		 * 		参数3：InvocationHandler  处理类，接口，必须进行实现类，一般采用匿名内部</div><div class="line">		 * 			提供 invoke 方法，代理类的每一个方法执行时，都将调用一次invoke</div><div class="line">		 * 				参数31：Object proxy ：代理对象</div><div class="line">		 * 				参数32：Method method : 代理对象当前执行的方法的描述对象（反射）</div><div class="line">		 * 					执行方法名：method.getName()</div><div class="line">		 * 					执行方法：method.invoke(对象，实际参数)</div><div class="line">		 * 				参数33：Object[] args :方法实际参数</div><div class="line">		 * </div><div class="line">		 */</div><div class="line">		UserService proxService = (UserService)Proxy.newProxyInstance(</div><div class="line">								MyBeanFactory.class.getClassLoader(), </div><div class="line">								userService.getClass().getInterfaces(), </div><div class="line">								<span class="keyword">new</span> InvocationHandler() &#123;</div><div class="line">									</div><div class="line">									<span class="meta">@Override</span></div><div class="line">									<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">										<span class="comment">//前执行</span></div><div class="line">										myAspect.before();</div><div class="line">										<span class="comment">//执行目标类的方法</span></div><div class="line">										Object obj = method.invoke(userService, args);</div><div class="line">										<span class="comment">//后执行</span></div><div class="line">										myAspect.after();</div><div class="line">										<span class="keyword">return</span> obj;</div><div class="line">									&#125;</div><div class="line">								&#125;);</div><div class="line">		<span class="keyword">return</span> proxService;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Test01.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		UserService userService = MyBeanFactory.createService();</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果：<br>假设开启事务<br>addUser<br>假设关闭事务<br>假设开启事务<br>updateUser<br>假设关闭事务<br>假设开启事务<br>deleteUser<br>假设关闭事务</p>
<h4 id="2-2-CGLIB字节码增强"><a href="#2-2-CGLIB字节码增强" class="headerlink" title="2.2 CGLIB字节码增强"></a>2.2 CGLIB字节码增强</h4><p>在没有定义业务接口的时候，不能使用JDK动态代理，此时就需要使用CGLIB来完成。其采用了底层的字节码技术，将业务层实现类通过字节码技术来创建子类，并使用拦截器，从而达到动态代理的的效果。</p>
<h3 id="AOP联盟通知模型"><a href="#AOP联盟通知模型" class="headerlink" title="AOP联盟通知模型"></a>AOP联盟通知模型</h3><h3 id="3-spring编写代理：半自动"><a href="#3-spring编写代理：半自动" class="headerlink" title="3. spring编写代理：半自动"></a>3. spring编写代理：半自动</h3><p>让spring创建代理对象，从spring容器中手动获取代理对象。</p>
<ol>
<li>导入jar包：</li>
</ol>
<ul>
<li>4 + 1  </li>
<li>AOP：AOP联盟（规范）；spring-aop（实现）</li>
</ul>
<ol>
<li>目标类和目标类接口</li>
</ol>
<p>UserService.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span></span>;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>UserServiceImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title">UserService</span> </span>&#123;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean addUser"</span>);</div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean updateUser"</span>);</div><div class="line"></div><div class="line">	&#125;</div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		System.out.println(<span class="string">"factory_bean deleteUser"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3.切面类</p>
<p>MyAspect.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类中确定通知，需要实现不同接口，接口就是规范，从而就确定方法名称。</div><div class="line"> * 采用“环绕通知” MethodInterceptor</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> <span class="keyword">implements</span> <span class="title">MethodInterceptor</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">invoke</span><span class="params">(MethodInvocation mi)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = mi.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>4.配置spring</p>
<p>beans.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.b_factory_bean.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 3 创建代理类 </span></div><div class="line">		* 使用工厂bean FactoryBean ，底层调用 getObject() 返回特殊bean</div><div class="line">		* ProxyFactoryBean 用于创建代理工厂bean，生成特殊代理对象</div><div class="line">			interfaces : 确定接口们</div><div class="line">				通过&lt;array&gt;可以设置多个值</div><div class="line">				只有一个值时，value=""</div><div class="line">			target : 确定目标类</div><div class="line">			interceptorNames : 通知 切面类的名称，类型String[]，如果设置一个值 value=""</div><div class="line">			optimize :强制使用cglib</div><div class="line">				&lt;property name="optimize" value="true"&gt;&lt;/property&gt;</div><div class="line">		底层机制</div><div class="line">			如果目标类有接口，采用jdk动态代理</div><div class="line">			如果没有接口，采用cglib 字节码增强</div><div class="line">			如果声明 optimize = true ，无论是否有接口，都采用cglib</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"proxyServiceId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.aop.framework.ProxyFactoryBean"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interfaces"</span> <span class="attr">value</span>=<span class="string">"com.itheima.b_factory_bean.UserService"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"target"</span> <span class="attr">ref</span>=<span class="string">"userServiceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"interceptorNames"</span> <span class="attr">value</span>=<span class="string">"myAspectId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestFactoryBean</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		String xmlPath = <span class="string">"com/yao/factory_bean/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		<span class="comment">//获得代理类</span></div><div class="line">		UserService userService = (UserService) applicationContext.getBean(<span class="string">"proxyServiceId"</span>);</div><div class="line">		userService.addUser();</div><div class="line">		userService.updateUser();</div><div class="line">		userService.deleteUser();</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="4-spring-aop编程：全自动"><a href="#4-spring-aop编程：全自动" class="headerlink" title="4. spring aop编程：全自动"></a>4. spring aop编程：全自动</h3><p>从spring容器中获得目标类，如果我们配置了AOP，spring将自动生成代理。<br>要确定目标类，aspectj的切入点表达式，导入jar包:<br><strong>spring-framework-3.0.2.RELEASE-dependencies\org.aspectj\com.springsource.org.aspectj.weaver\1.6.8.RELEASE</strong></p>
<p><strong>目标类和切面类同上。没有变化。</strong></p>
<p>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.c_spring_aop.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		3.1 导入命名空间</div><div class="line">		3.2 使用 &lt;aop:config&gt;进行配置</div><div class="line">				proxy-target-class="true" 声明时使用cglib代理</div><div class="line">			&lt;aop:pointcut&gt; 切入点 ，从目标对象获得具体方法</div><div class="line">			&lt;aop:advisor&gt; 特殊的切面，只有一个通知 和 一个切入点</div><div class="line">				advice-ref 通知引用</div><div class="line">				pointcut-ref 切入点引用</div><div class="line">		3.3 切入点表达式</div><div class="line">			execution(* com.itheima.c_spring_aop.*.*(..))</div><div class="line">			选择方法         返回值任意   包                                             类名任意   方法名任意   参数任意</div><div class="line">		</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span> <span class="attr">proxy-target-class</span>=<span class="string">"true"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.c_spring_aop.*.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">"myAspectId"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSpringAop</span></span>&#123;</div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo1</span><span class="params">()</span></span>&#123;</div><div class="line">        String xml = <span class="string">"com/yao/springaop/ApplicationContext.xml"</span></div><div class="line">        ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">        </div><div class="line">        UserService userService = (UserService)applicationContext.getBean(<span class="string">"userServiceId"</span>);</div><div class="line">        userService.addUser();</div><div class="line">        userService.updateUser();</div><div class="line">        userService.deleteUser();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="5-aspectJ"><a href="#5-aspectJ" class="headerlink" title="5. aspectJ"></a>5. aspectJ</h3><h4 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5.1 介绍"></a>5.1 介绍</h4><p>AspectJ是一个基于Java语言的AOP框架。Spring2.0以后新增了对AspectJ切点表达式支持。<br>@AspectJ 是AspectJ1.5新增功能，通过JDK5注解技术，允许直接在Bean类中定义切面新版本Spring框架，建议使用AspectJ方式来开发AOP。<br>主要用途：自定义开发</p>
<pre><code>此处输入代码
</code></pre><h4 id="5-2-切入点表达式"><a href="#5-2-切入点表达式" class="headerlink" title="5.2 切入点表达式"></a>5.2 切入点表达式</h4><ol>
<li><p>execution()用于描述方法<br> 语法：execution(修饰符 返回值 包.类.方法(参数) throws异常)</p>
<pre><code>修饰符 一般省略
    public        公共方法
    *            任意

返回值，不能省略
    void        返回没有值
    String        返回值字符串
    *             任意

包，[省略]
    com.test.crm            固定包
    com.test.crm.*.service    crm包下面子包任意 （例如：com.test.crm.staff.service）
    com.test.crm..            crm包下面的所有子包（含自己）
    com.test.crm.*.service..  crm包下面任意子包，固定目录service，service目录任意包

类，[省略]
    UserServiceImpl            指定类
    *Impl                    以Impl结尾
    User*                    以User开头
    *                        任意
方法名，不能省略
    addUser                    固定方法
    add*                    以add开头
    *Do                        以Do结尾
    *                        任意
(参数)
    ()                            无参
    (int)                        一个整型
    (int ,int)                    两个
    (..)                        参数任意

throws ,可省略，一般不写。
</code></pre></li>
</ol>
<hr>
<h4 id="5-2-AspectJ通知类型"><a href="#5-2-AspectJ通知类型" class="headerlink" title="5.2 AspectJ通知类型"></a>5.2 AspectJ通知类型</h4><p>aop联盟定义的通知类型，具有特定的接口，必须实现，从而确定方法的名称。<br>AspectJ通知类型，只定义类型名称。</p>
<p>around：环绕通知(应用：十分强大，可以做任何事情)<br>        方法执行前后分别执行，可以阻止方法的执行<br>        <strong>必须手动执行目标方法</strong></p>
<h4 id="5-3-导入jar包"><a href="#5-3-导入jar包" class="headerlink" title="5.3 导入jar包"></a>5.3 导入jar包</h4><p>4个：aop联盟规范 、 spring aop实现 、aspect规范 、 spring aspect实现</p>
<hr>
<h4 id="5-4-基于XML"><a href="#5-4-基于XML" class="headerlink" title="5.4 基于XML"></a>5.4 基于XML</h4><p><strong>首先需要搭建环境</strong></p>
<ol>
<li>目标类 ： 接口 + 实现类</li>
<li>切面类 ： 编写多个通知，采用aspectj通知名称任意（方法名任意）</li>
<li>aop编程： 将通知应用到目标类</li>
<li>测试</li>
</ol>
<p>目标类：省略不写，无变化。</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">**</div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 1 创建目标类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userServiceId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.UserServiceImpl"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 2 创建切面类（通知） --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"myAspectId"</span> <span class="attr">class</span>=<span class="string">"com.itheima.d_aspect.a_xml.MyAspect"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 3 aop编程 </span></div><div class="line">		&lt;aop:aspect&gt; 将切面类 声明“切面”，从而获得通知（方法）</div><div class="line">			ref 切面类引用</div><div class="line">		&lt;aop:pointcut&gt; 声明一个切入点，所有的通知都可以使用。</div><div class="line">			expression 切入点表达式</div><div class="line">			id 名称，用于其它通知引用</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">"myAspectId"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">"execution(* com.itheima.d_aspect.a_xml.UserServiceImpl.*(..))"</span> <span class="attr">id</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.1 前置通知 </span></div><div class="line">				&lt;aop:before method="" pointcut="" pointcut-ref=""/&gt;</div><div class="line">					method : 通知，及方法名</div><div class="line">					pointcut :**切入点表达式**，此表达式只能当前通知使用。</div><div class="line">					pointcut-ref ： 切入点引用，可以与其他通知共享切入点。</div><div class="line">				通知方法格式：public void myBefore(JoinPoint joinPoint)&#123;</div><div class="line">					参数1：org.aspectj.lang.JoinPoint  用于描述连接点（目标方法），获得目标方法名等</div><div class="line">				例如：</div><div class="line">			&lt;aop:before method="myBefore" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.2后置通知  ,目标方法后执行，获得返回值</span></div><div class="line">				&lt;aop:after-returning method="" pointcut-ref="" returning=""/&gt;</div><div class="line">					returning 通知方法第二个参数的名称</div><div class="line">				通知方法格式：public void myAfterReturning(JoinPoint joinPoint,Object ret)&#123;</div><div class="line">					参数1：连接点描述</div><div class="line">					参数2：类型Object，参数名 returning="ret" 配置的</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-returning method="myAfterReturning" pointcut-ref="myPointCut" returning="ret" /&gt;</div><div class="line">			--&gt;</div><div class="line">			</div><div class="line">			<span class="comment">&lt;!-- 3.3 环绕通知 </span></div><div class="line">				&lt;aop:around method="" pointcut-ref=""/&gt;</div><div class="line">				通知方法格式：public Object myAround(ProceedingJoinPoint joinPoint) throws Throwable&#123;</div><div class="line">					返回值类型：Object</div><div class="line">					方法名：任意</div><div class="line">					参数：org.aspectj.lang.ProceedingJoinPoint</div><div class="line">					抛出异常</div><div class="line">				执行目标方法：Object obj = joinPoint.proceed();</div><div class="line">				例如：</div><div class="line">			&lt;aop:around method="myAround" pointcut-ref="myPointCut"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.4 抛出异常</span></div><div class="line">				&lt;aop:after-throwing method="" pointcut-ref="" throwing=""/&gt;</div><div class="line">					throwing ：通知方法的第二个参数名称</div><div class="line">				通知方法格式：public void myAfterThrowing(JoinPoint joinPoint,Throwable e)&#123;</div><div class="line">					参数1：连接点描述对象</div><div class="line">					参数2：获得异常信息，类型Throwable ，参数名由throwing="e" 配置</div><div class="line">				例如：</div><div class="line">			&lt;aop:after-throwing method="myAfterThrowing" pointcut-ref="myPointCut" throwing="e"/&gt;</div><div class="line">			--&gt;</div><div class="line">			<span class="comment">&lt;!-- 3.5 最终通知 --&gt;</span>			</div><div class="line">			<span class="tag">&lt;<span class="name">aop:after</span> <span class="attr">method</span>=<span class="string">"myAfter"</span> <span class="attr">pointcut-ref</span>=<span class="string">"myPointCut"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>测试类不变，getBean中还是得到目标类的bean。</p>
<hr>
<h4 id="5-5-基于注解"><a href="#5-5-基于注解" class="headerlink" title="5.5 基于注解"></a>5.5 基于注解</h4><ol>
<li>替换bean</li>
</ol>
<ol>
<li>替换aop</li>
</ol>
<p>必须进行aspectj代理 </p>
<p>声明切面</p>
<p>替换前置通知 </p>
<p>替换公共切入点</p>
<p>替换抛出异常</p>
<p>@around  在只有一个参数的时候，value是可以省略的；但是有超过一个参数的时候，value就不可以省略</p>
<p>切面类MyAspect.java</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 切面类，含有多个通知</div><div class="line"> */</div><div class="line"><span class="meta">@Component</span></div><div class="line"><span class="meta">@Aspect</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyAspect</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="comment">//切入点当前有效</span></div><div class="line"><span class="comment">//	@Before("execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myBefore</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"前置通知 ： "</span> + joinPoint.getSignature().getName());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="comment">//声明公共切入点</span></div><div class="line">	<span class="meta">@Pointcut</span>(<span class="string">"execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))"</span>)</div><div class="line">	<span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">myPointCut</span><span class="params">()</span></span>&#123;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterReturning(value="myPointCut()" ,returning="ret")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterReturning</span><span class="params">(JoinPoint joinPoint,Object ret)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"后置通知 ： "</span> + joinPoint.getSignature().getName() + <span class="string">" , --&gt;"</span> + ret);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@Around(value = "myPointCut()")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> Object <span class="title">myAround</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable</span>&#123;</div><div class="line">		System.out.println(<span class="string">"前"</span>);</div><div class="line">		<span class="comment">//手动执行目标方法</span></div><div class="line">		Object obj = joinPoint.proceed();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"后"</span>);</div><div class="line">		<span class="keyword">return</span> obj;</div><div class="line">	&#125;</div><div class="line">	</div><div class="line"><span class="comment">//	@AfterThrowing(value="execution(* com.itheima.d_aspect.b_anno.UserServiceImpl.*(..))" ,throwing="e")</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfterThrowing</span><span class="params">(JoinPoint joinPoint,Throwable e)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"抛出异常通知 ： "</span> + e.getMessage());</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="meta">@After</span>(<span class="string">"myPointCut()"</span>)</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myAfter</span><span class="params">(JoinPoint joinPoint)</span></span>&#123;</div><div class="line">		System.out.println(<span class="string">"最终通知"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>配置spring</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 1.扫描 注解类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">"com.itheima.d_aspect.b_anno"</span>&gt;</span><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 2.确定 aop注解生效 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">aop:aspectj-autoproxy</span>&gt;</span><span class="tag">&lt;/<span class="name">aop:aspectj-autoproxy</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure>
<h4 id="5-6-aop注解总结"><a href="#5-6-aop注解总结" class="headerlink" title="5.6 aop注解总结"></a>5.6 aop注解总结</h4><pre><code>@Aspect 声明切面，修饰切面类，从而获得通知。
</code></pre><p>通知<br>    @Before  前置<br>    @AfterReturning  后置<br>    @Around 环绕<br>    @AfterThrowing 抛出异常<br>    @After 最终</p>
<p>切入点<br>    @PointCut ，修饰方法 private void xxx(){}  之后通过“方法名”获得切入点引用</p>
<hr>
<h2 id="二-JdbcTemplate"><a href="#二-JdbcTemplate" class="headerlink" title="二 . JdbcTemplate"></a>二 . JdbcTemplate</h2><ul>
<li>spring所提供的用于操作JDBC的工具类，相当于DBUtils。</li>
<li>依赖连接池DataSource(数据源)</li>
</ul>
<p>步骤目录<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">1.1 环境搭建</div><div class="line"></div><div class="line">1.2 使用api</div><div class="line"></div><div class="line">1.3 配置DBCP</div><div class="line"></div><div class="line">1.4 配置C3P0</div><div class="line"></div><div class="line">1.5 使用JdbcDaoSupport</div><div class="line"></div><div class="line">1.6 配置properties</div></pre></td></tr></table></figure></p>
<h3 id="1-1-环境搭建"><a href="#1-1-环境搭建" class="headerlink" title="1.1 环境搭建"></a>1.1 环境搭建</h3><p>1.1.1 <strong><em>创建表</em></strong></p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">creat database spring_day0410;</div><div class="line"><span class="keyword">use</span> spring_day0410;</div><div class="line">creat table t_user(</div><div class="line">id int primary key auto_inrement;</div><div class="line">username varchar(20);</div><div class="line">password varchar(20);</div><div class="line">);</div><div class="line"></div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'tom'</span>,<span class="number">123</span>);</div><div class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t_user(username,<span class="keyword">password</span>) <span class="keyword">values</span>(<span class="string">'jerry'</span>,<span class="number">223</span>);</div></pre></td></tr></table></figure>
<p>1.1.2 <strong><em>导包</em></strong></p>
<p><strong><em>注意：spring3.2和jdk1.8会发生冲突。</em></strong></p>
<p>4+1；<br>数据库驱动；<br>spring-jdba开发；<br>spring事务；<br>c3p0连接池；<br>dbcp连接池（2个）</p>
<p>1.1.3 <strong><em>javabean</em></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</div><div class="line">    <span class="keyword">private</span> String username;</div><div class="line">    <span class="keyword">private</span> String passsword;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-2-使用api"><a href="#1-2-使用api" class="headerlink" title="1.2 使用api"></a>1.2 使用api</h3><p>通过对api的使用，能够进一步理解spring配置DBCP和C3P0；</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestApi</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span>&#123;</div><div class="line">        <span class="comment">//创建数据源</span></div><div class="line">        BasiataSource dataSource = <span class="keyword">new</span> BasicDataSource();</div><div class="line">        dataSource.setDriveerClassName(<span class="string">"com.sql.jdbc.Driver"</span>);</div><div class="line">        dataSource.setUrl(<span class="string">"jdbc:mysql://localhost:3306/spring_day0410"</span>);</div><div class="line">        dataSource.setUsername(<span class="string">"root"</span>);</div><div class="line">        dataSource.setPassword(<span class="string">"admin"</span>);</div><div class="line">        <span class="comment">//创建模板</span></div><div class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate();</div><div class="line">        jdbcTemplate.setDataSource(dataSource);</div><div class="line">        <span class="comment">//api操作</span></div><div class="line">        jdbcTemplate.update(<span class="string">"insert into t_user(username,password) values(?,?);"</span>, <span class="string">"tom"</span>,<span class="string">"998"</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="1-3-配置DBCP"><a href="#1-3-配置DBCP" class="headerlink" title="1.3 配置DBCP"></a>1.3 配置DBCP</h3><p>对照着1.2对api的使用，进行配置DBCP.<br>spring配置<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">       <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></div><div class="line">       <span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">       <span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span></div><div class="line">       <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">       					   http://www.springframework.org/schema/beans/spring-beans.xsd</div><div class="line">       					   http://www.springframework.org/schema/aop </div><div class="line">       					   http://www.springframework.org/schema/aop/spring-aop.xsd</div><div class="line">       					   http://www.springframework.org/schema/context </div><div class="line">       					   http://www.springframework.org/schema/context/spring-context.xsd"&gt;</div><div class="line">	<span class="comment">&lt;!-- 创建数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSourceId"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/ee19_spring_day02"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"1234"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 创建模板 ,需要注入数据源--&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"jdbcTemplateId"</span> <span class="attr">class</span>=<span class="string">"org.springframework.jdbc.core.JdbcTemplate"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSourceId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置dao --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDaoId"</span> <span class="attr">class</span>=<span class="string">"com.yao.c_dbcp.UserDao"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbcTemplate"</span> <span class="attr">ref</span>=<span class="string">"jdbcTemplateId"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>UserDao.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line">	<span class="comment">//jdbc模板将由spring注入</span></div><div class="line">	<span class="keyword">private</span> JdbcTemplate jdbcTemplate;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setJdbcTemplate</span><span class="params">(JdbcTemplate jdbcTemplate)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.jdbcTemplate = jdbcTemplate;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">(User user)</span></span>&#123;</div><div class="line">		String sql = <span class="string">"update t_user set username=?,password=? where id =?"</span>;</div><div class="line">		Object[] args = &#123;user.getUsername(),user.getPassword(),user.getId()&#125;;</div><div class="line">		jdbcTemplate.update(sql, args);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>测试<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestDBCP</span> </span>&#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">demo01</span><span class="params">()</span></span>&#123;</div><div class="line">		User user = <span class="keyword">new</span> User();</div><div class="line">		user.setId(<span class="number">1</span>);</div><div class="line">		user.setUsername(<span class="string">"sam"</span>);</div><div class="line">		user.setPassword(<span class="string">"999"</span>);</div><div class="line">		</div><div class="line">		String xmlPath = <span class="string">"com/itheima/c_dbcp/beans.xml"</span>;</div><div class="line">		ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(xmlPath);</div><div class="line">		</div><div class="line">		<span class="comment">//获得目标类</span></div><div class="line">		UserDao userDao = (UserDao) applicationContext.getBean(<span class="string">"userDaoId"</span>);</div><div class="line">		userDao.update(user);</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="1-4-配置C3P0"><a href="#1-4-配置C3P0" class="headerlink" title="1.4 配置C3P0"></a>1.4 配置C3P0</h3><p>在创建数据源的部分有变化，<br><code>&lt;bean id=&quot;&quot; class=&quot;com.mchange.v2.c3p0.ComboPooledDataSource&quot;&gt;</code></p>
<h3 id="1-5-使用JdbcDaoSupport"><a href="#1-5-使用JdbcDaoSupport" class="headerlink" title="1.5 使用JdbcDaoSupport"></a>1.5 使用JdbcDaoSupport</h3><p>将C3P0和DBCP中的jdbc模板写到了JdbcDaoSupport，作为父类，且作为final存在。<br>因此，要使用JdbcTemplate，就<code>this.getJdbcTemplate()</code>即可。<br>从而，在dao层中， 只需要注入数据源，底层将自动创建模板。</p>
<h3 id="1-6-配置properties"><a href="#1-6-配置properties" class="headerlink" title="1.6 配置properties"></a>1.6 配置properties</h3><p>在spring配置中—–<br>加载配置文件：”classpath:”表示src下<br>使用配置文件：通过${key获得内容}</p>
<p>1.6.1 <strong><em>properties文件</em></strong></p>
<p>1.6.2 <strong><em>spring配置</em></strong></p>
<h2 id="三-整合Junit"><a href="#三-整合Junit" class="headerlink" title="三 . 整合Junit"></a>三 . 整合Junit</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/09/spring框架学习二/" data-id="cj70kwxcl000wi4tx89da03hy" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-js跨域" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/07/js跨域/" class="article-date">
  <time datetime="2017-06-07T15:57:36.265Z" itemprop="datePublished">2017-06-07</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Js跨域"><a href="#Js跨域" class="headerlink" title="Js跨域"></a>Js跨域</h1><p>js为了安全进行了限制，不允许跨域访问。</p>
<p>如果：</p>
<ol>
<li>两个url的域名不同</li>
<li>url相同，端口不同</li>
<li>ip不同</li>
</ol>
<p>则是跨域了。</p>
<p>在esale-portal中不能使用ajax直接调用esale-rest的服务。</p>
<h2 id="解决跨域的问题"><a href="#解决跨域的问题" class="headerlink" title="解决跨域的问题"></a>解决跨域的问题</h2><p>可以使用jsonp来解决跨域问题。</p>
<ol>
<li>在js中不能跨域请求数据，但是<strong>js可以跨域请求js片段</strong>。可以把数据包装成js。</li>
<li>可以把数据使用js方法来包装，形成一条方法的调用语句。</li>
<li>可以使用ajax请求js片段，当js到达浏览器会被立即执行</li>
<li>在浏览器端，先创建好回调方法，在回调方法中通过参数可以获得请求的数据。</li>
</ol>
<p>前期准备：</p>
<ol>
<li>把js的回调方法写好</li>
<li>在ajax请求时，需要把回调方法的方法名传递给服务端</li>
<li>服务端接收回调方法，把数据包装好，响应给客户端。</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/07/js跨域/" data-id="cj70kwxcg000si4tx93ukbeen" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Esale商城项目" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/06/02/Esale商城项目/" class="article-date">
  <time datetime="2017-06-02T14:42:55.102Z" itemprop="datePublished">2017-06-02</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Esale商城项目"><a href="#Esale商城项目" class="headerlink" title="Esale商城项目"></a>Esale商城项目</h1><h2 id="1-基本构建思路"><a href="#1-基本构建思路" class="headerlink" title="1 . 基本构建思路"></a>1 . 基本构建思路</h2><p>该商城和互联网上存在的商城类似，具备有基本的功能。</p>
<h3 id="1-1-技术选型"><a href="#1-1-技术选型" class="headerlink" title="1.1 技术选型"></a>1.1 技术选型</h3><ul>
<li>数据库：mysql</li>
<li>数据库连接池：druid</li>
<li>Dao层：MyBatis</li>
<li>缓存：redis</li>
<li>搜索：solr</li>
<li>Service层：spring</li>
<li>表现层Web层：springmvc jstl EasyUI freemark</li>
<li>图片服务器：FastDFS</li>
<li>反向代理服务器：nginx</li>
<li>定时器：Quartz</li>
<li>Web服务器：tomcat</li>
<li>工程管理：maven</li>
</ul>
<h3 id="1-2-后台管理系统搭建"><a href="#1-2-后台管理系统搭建" class="headerlink" title="1.2 . 后台管理系统搭建"></a>1.2 . 后台管理系统搭建</h3><p>使用maven管理工程：完成项目构建和依赖管理</p>
<p>大致的构架如下：</p>
<p>Taotao-parent（父工程管理jar包的版本）</p>
<p>  |–Taotao-common（把通用的工具类打包）</p>
<p>  |–Taotao-manager（继承父工程）</p>
<pre><code>|-taotao-manager-pojo

  |-taotao-manager-dao

  |-taotao-manager-service

  |-taotao-manager-web（war包）
</code></pre><h2 id="2-技术框架SSM"><a href="#2-技术框架SSM" class="headerlink" title="2 . 技术框架SSM"></a>2 . 技术框架SSM</h2><p>包括三层：dao层、service层、web层。</p>
<ul>
<li>dao层：整合mybatis和spring</li>
</ul>
<h2 id="4-商品列表展示"><a href="#4-商品列表展示" class="headerlink" title="4 . 商品列表展示"></a>4 . 商品列表展示</h2><p>需要展示列表，就需要引入js和css文件。但是如果将js和css文件放在WEB-INF下，则无法直接访问。因此在springmvc中，需要引入静态资源映射来完成资源的加载。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/js/"</span> <span class="attr">mapping</span>=<span class="string">"/js/**"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">"/WEB-INF/css/"</span> <span class="attr">mapping</span>=<span class="string">"/css/**"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>使用了easyUI模板完成了前端代码的编写，因此需要再次基础上进行后台代码的编写。</p>
<p>商品的列表展示除了要向数据库查询商品信息外，还需要进行分页处理。</p>
<p>在item-list.jsp页面中，有如下的一段代码：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"easyui-datagrid"</span> <span class="attr">id</span>=<span class="string">"itemList"</span> <span class="attr">title</span>=<span class="string">"商品列表"</span> </span></div><div class="line">       <span class="attr">data-options</span>=<span class="string">"singleSelect:false,collapsible:true,pagination:true,url:'/item/list',method:'get',pageSize:30,toolbar:toolbar"</span>&gt;</div><div class="line">    <span class="tag">&lt;<span class="name">thead</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">tr</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'ck',checkbox:true"</span>&gt;</span><span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        	<span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'id',width:60"</span>&gt;</span>商品ID<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'title',width:200"</span>&gt;</span>商品标题<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'cid',width:100"</span>&gt;</span>叶子类目<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'sellPoint',width:100"</span>&gt;</span>卖点<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'price',width:70,align:'right',formatter:TAOTAO.formatPrice"</span>&gt;</span>价格<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'num',width:70,align:'right'"</span>&gt;</span>库存数量<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'barcode',width:100"</span>&gt;</span>条形码<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'status',width:60,align:'center',formatter:TAOTAO.formatItemStatus"</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'created',width:130,align:'center',formatter:TAOTAO.formatDateTime"</span>&gt;</span>创建日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">th</span> <span class="attr">data-options</span>=<span class="string">"field:'updated',width:130,align:'center',formatter:TAOTAO.formatDateTime"</span>&gt;</span>更新日期<span class="tag">&lt;/<span class="name">th</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">thead</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这段代码则会发出如下的请求url:<a href="http://localhost:8080/item/list?page=1&amp;rows=30" target="_blank" rel="external">http://localhost:8080/item/list?page=1&amp;rows=30</a></p>
<p>而且，在easyUI中，datagrid要求<strong>响应的数据格式</strong>：json数据格式，并且需要包含”total”<br>和”rows”两个参数。</p>
<ul>
<li>参数说明</li>
</ul>
<p>Total：查询结果的总记录数</p>
<p>Rows：集合，包含显示的所有数据。其中集合中每个元素的key应该和dategrid的field对应。</p>
<ul>
<li>dao</li>
</ul>
<p>使用逆向工程生成的代码即可。</p>
<ul>
<li>service </li>
</ul>
<p>在service层中，接受到的参数是page（当前的页码）和row（每页所显示的记录数）数据；</p>
<p>返回值：自己创建的pojo对象,对象中包含两个参数。</p>
<p>EasyUIDataGridResult.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EasyUIDataGridResult</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> Long total;</div><div class="line">	<span class="keyword">private</span> List&lt;?&gt; rows;</div><div class="line">	<span class="function"><span class="keyword">public</span> Long <span class="title">getTotal</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> total;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTotal</span><span class="params">(Long total)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.total = total;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">public</span> List&lt;?&gt; getRows() &#123;</div><div class="line">		<span class="keyword">return</span> rows;</div><div class="line">	&#125;</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRows</span><span class="params">(List&lt;?&gt; rows)</span> </span>&#123;</div><div class="line">		<span class="keyword">this</span>.rows = rows;</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>此处，需要使用到Mybatis的分页插件，需要在maven工程的pom.xml文件中添加：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.miemiedev<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-paginator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.15<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.pagehelper<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>pagehelper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">version</span>&gt;</span>3.7.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>并且在SqlMapConfig.xml中添加配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- 配置分页插件 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"com.github.pagehelper.PageHelper"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 指定使用的数据库是什么 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dialect"</span> <span class="attr">value</span>=<span class="string">"mysql"</span>/&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>ItemServiceImpl.java<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function"><span class="keyword">public</span> EasyUIDataGridResult <span class="title">getItemList</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> rows)</span> </span>&#123;</div><div class="line">		<span class="comment">//分页处理</span></div><div class="line">		PageHelper.startPage(page, rows);</div><div class="line">		<span class="comment">//执行查询</span></div><div class="line">		TbItemExample example = <span class="keyword">new</span> TbItemExample();</div><div class="line">		List&lt;TbItem&gt; list = itemMapper.selectByExample(example);</div><div class="line">		<span class="comment">//取分页信息</span></div><div class="line">		PageInfo&lt;TbItem&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(list);</div><div class="line">		<span class="comment">//返回处理结果</span></div><div class="line">		EasyUIDataGridResult result = <span class="keyword">new</span> EasyUIDataGridResult();</div><div class="line">		result.setTotal(pageInfo.getTotal());</div><div class="line">		result.setRows(list);</div><div class="line">		</div><div class="line">		<span class="keyword">return</span> result;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<ul>
<li>controller </li>
</ul>
<p>在controller层需要拦截到page和rows参数。需要返回的是json格式的参数，因此会使用到<br>@ResponseBody注解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/item/list"</span>)</div><div class="line"><span class="meta">@ResponseBody</span></div><div class="line"><span class="function"><span class="keyword">public</span> EasyUIDataGridResult <span class="title">getItemList</span><span class="params">(Integer page,Integer rows)</span></span>&#123;</div><div class="line">	EasyUIDataGridResult result = itemService.getItemList(page, rows);</div><div class="line">	<span class="keyword">return</span> result;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h2 id="5-商品类目选择"><a href="#5-商品类目选择" class="headerlink" title="5 . 商品类目选择"></a>5 . 商品类目选择</h2><h2 id="6-图片上传"><a href="#6-图片上传" class="headerlink" title="6 . 图片上传"></a>6 . 图片上传</h2><ol>
<li>使用Nginx服务器</li>
<li>分布式文件系统FastDFS</li>
</ol>
<h2 id="7-规格参数模块"><a href="#7-规格参数模块" class="headerlink" title="7 . 规格参数模块"></a>7 . 规格参数模块</h2><h3 id="7-1-判断规格参数模板是否存在"><a href="#7-1-判断规格参数模板是否存在" class="headerlink" title="7.1 判断规格参数模板是否存在"></a>7.1 判断规格参数模板是否存在</h3><p>根据圣品的分类id查询tb_item_param表，如果查询到结果说明此模板已经添加。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">TAOTAO.initItemCat(&#123;</div><div class="line">	<span class="attr">fun</span>:<span class="function"><span class="keyword">function</span>(<span class="params">node</span>)</span>&#123;</div><div class="line">	$(<span class="string">".addGroupTr"</span>).hide().find(<span class="string">".param"</span>).remove();</div><div class="line">		<span class="comment">//  判断选择的目录是否已经添加过规格</span></div><div class="line">	  $.getJSON(<span class="string">"/item/param/query/itemcatid/"</span> + node.id,<span class="function"><span class="keyword">function</span>(<span class="params">data</span>)</span>&#123;</div><div class="line">		  <span class="keyword">if</span>(data.status == <span class="number">200</span> &amp;&amp; data.data)&#123;</div><div class="line">			  $.messager.alert(<span class="string">"提示"</span>, <span class="string">"该类目已经添加，请选择其他类目。"</span>, <span class="literal">undefined</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</div><div class="line">				 $(<span class="string">"#itemParamAddTable .selectItemCat"</span>).click();</div><div class="line">			  &#125;);</div><div class="line">			  <span class="keyword">return</span> ;</div><div class="line">		  &#125;</div><div class="line">		  $(<span class="string">".addGroupTr"</span>).show();</div><div class="line">	  &#125;);</div><div class="line">	&#125;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>分析这段js代码，先会向/item/param/query/itemcatid/{cid}进行请求，请求会返回json数据进行解析，判断其中的status和data. </p>
<p>请求的url:/item/param/query/itemcatid/{cid}</p>
<p>参数：cid</p>
<p>返回结果：status和data,因此可以使用esaleResult</p>
<ul>
<li>dao层</li>
</ul>
<p>可以使用逆向工程生成的代码</p>
<ul>
<li>service</li>
</ul>
<p>接受参数cid ，根据参数cid调用mapper查询模板是否存在，如果存在应该返回esaleResult，并且把查询的结果放到esaleResult的data属性；如果不存在，则直接返回esaleResult。</p>
<p>参数：cid</p>
<p>返回值：esaleResult</p>
<ul>
<li>controller</li>
</ul>
<h3 id="7-2-提交规格参数模板"><a href="#7-2-提交规格参数模板" class="headerlink" title="7.2 提交规格参数模板"></a>7.2 提交规格参数模板</h3><h3 id="7-3-保存规格参数"><a href="#7-3-保存规格参数" class="headerlink" title="7.3 保存规格参数"></a>7.3 保存规格参数</h3><p>生成规格参数json字符串的处理：<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//取商品的规格</span></div><div class="line">		<span class="keyword">var</span> paramJson = [];</div><div class="line">		$(<span class="string">"#itemAddForm .params li"</span>).each(<span class="function"><span class="keyword">function</span>(<span class="params">i,e</span>)</span>&#123;</div><div class="line">			<span class="keyword">var</span> trs = $(e).find(<span class="string">"tr"</span>);</div><div class="line">			<span class="keyword">var</span> group = trs.eq(<span class="number">0</span>).text();</div><div class="line">			<span class="keyword">var</span> ps = [];</div><div class="line">			<span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">1</span>;i&lt;trs.length;i++)&#123;</div><div class="line">				<span class="keyword">var</span> tr = trs.eq(i);</div><div class="line">				ps.push(&#123;</div><div class="line">					<span class="string">"k"</span> : $.trim(tr.find(<span class="string">"td"</span>).eq(<span class="number">0</span>).find(<span class="string">"span"</span>).text()),</div><div class="line">					<span class="string">"v"</span> : $.trim(tr.find(<span class="string">"input"</span>).val())</div><div class="line">				&#125;);</div><div class="line">			&#125;</div><div class="line">			paramJson.push(&#123;</div><div class="line">				<span class="string">"group"</span> : group,</div><div class="line">				<span class="string">"params"</span>: ps</div><div class="line">			&#125;);</div><div class="line">		&#125;);</div><div class="line">		<span class="comment">//把json对象转换成字符串</span></div><div class="line">		paramJson = <span class="built_in">JSON</span>.stringify(paramJson);</div><div class="line">		$(<span class="string">"#itemAddForm [name=itemParams]"</span>).val(paramJson);</div></pre></td></tr></table></figure></p>
<p>需要在controller和service中添加一个参数接受商品的规格参数即可。</p>
<ul>
<li>service</li>
</ul>
<h2 id="8-前台系统搭建——服务层和表现层"><a href="#8-前台系统搭建——服务层和表现层" class="headerlink" title="8 . 前台系统搭建——服务层和表现层"></a>8 . 前台系统搭建——服务层和表现层</h2><p><img src="http://note.youdao.com/noteshare?id=9a0c71e86f2d1fafa0560e962a2f8588" alt="image"></p>
<p>可以把业务逻辑提取出来，发布服务，供pc、移动端公用。</p>
<ul>
<li>好处：</li>
</ul>
<ol>
<li>提高代码复用度</li>
<li>可以灵活的进行分布式部署。</li>
<li>系统之间耦合度低</li>
<li>团队之间开发不冲突。</li>
</ol>
<ul>
<li>缺点</li>
</ul>
<ol>
<li>需要发布Webservice,系统之间需要远程调用。</li>
<li>工作量增加</li>
<li>需要系统之间协作才能完成业务，系统调用之间变得复杂</li>
</ol>
<p>需要创建两个工程：</p>
<p>服务层esale-rest：没有表现层只有业务逻辑，需要发布服务</p>
<p>表现层esale-portal：只有表现层，没有业务逻辑，不需要连接数据库</p>
<p>表现层和服务层通信，使用Webservice进行通信。Rest形式的Webservice:http+json数据</p>
<h3 id="8-1-服务层esale-rest工程搭建"><a href="#8-1-服务层esale-rest工程搭建" class="headerlink" title="8.1 服务层esale-rest工程搭建"></a>8.1 服务层esale-rest工程搭建</h3><p>使用maven来管理工程。需要发布和调用服务，因此是一个web工程，打包成war包。</p>
<ul>
<li>使用的技术</li>
</ul>
<ol>
<li>Mybatis</li>
<li>Spring</li>
<li>发布服务：springmvc（此处不用cxf）</li>
</ol>
<ul>
<li>框架整合</li>
</ul>
<p>参考esale-manager</p>
<ul>
<li>pom.xml</li>
</ul>
<p>添加esale-manager-dao的依赖</p>
<p>添加spring的一来</p>
<p>配置tomcat插件（注意改端口）</p>
<h3 id="8-2-表现层esale-portal"><a href="#8-2-表现层esale-portal" class="headerlink" title="8.2 表现层esale-portal"></a>8.2 表现层esale-portal</h3><ul>
<li>使用的技术：</li>
</ul>
<ol>
<li>spring</li>
<li>springmvc</li>
</ol>
<ul>
<li>依赖的jar包：</li>
</ul>
<ol>
<li>esale-manager-pojo</li>
<li>spring</li>
<li>tomcat插件（注意改端口）</li>
</ol>
<ul>
<li>框架整合</li>
</ul>
<p>spring和springmvc</p>
<p>Maven安装到本地仓库，跳过测试：clean install -DskipTest</p>
<h2 id="9-首页商品类目展示"><a href="#9-首页商品类目展示" class="headerlink" title="9 . 首页商品类目展示"></a>9 . 首页商品类目展示</h2><ol>
<li>类目展示需要异步加载；</li>
<li>商品类目从数据空中获得，调用esale-rest发布的服务获得数据；</li>
<li>可以在首页中使用js直接调用esale-rest发布的服务获得数据</li>
</ol>
<h3 id="9-1-发布商品类目查询服务"><a href="#9-1-发布商品类目查询服务" class="headerlink" title="9.1 发布商品类目查询服务"></a>9.1 发布商品类目查询服务</h3><ul>
<li>分析：<br>获得一个分类列表的数据，要从数据库中查找，从tb_item_cat表中取数据。</li>
</ul>
<p>可以创建一个pojo描述树形列表的节点，其中包含三个属性u\n\i。</p>
<ul>
<li>U：url        String</li>
<li>N：name        String</li>
<li>I：items        List</li>
</ul>
<p>业务逻辑：根据parentid查询子节点列表，并递归调用。</p>
<h2 id="10"><a href="#10" class="headerlink" title="10 ."></a>10 .</h2>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/06/02/Esale商城项目/" data-id="cj70kwxaa0003i4tx84jr15kb" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Nginx" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/31/Nginx/" class="article-date">
  <time datetime="2017-05-31T09:42:19.633Z" itemprop="datePublished">2017-05-31</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Nginx"><a href="#Nginx" class="headerlink" title="Nginx"></a>Nginx</h1><h2 id="1-介绍"><a href="#1-介绍" class="headerlink" title="1 . 介绍"></a>1 . 介绍</h2><p>Nginx是一个使用c语言开发的高性能的http服务器及反向代理服务器。</p>
<p>Nginx是一款高性能的http服务器/反向代理服务器及电子邮件（IMAP/POP3）代理服务器。由俄罗斯的程序设计师Igor Sysoev所开发，官方测试nginx能够支支撑5万并发链接，并且cpu、内存等资源消耗却非常低，运行非常稳定。</p>
<h2 id="2-应用场景"><a href="#2-应用场景" class="headerlink" title="2 . 应用场景"></a>2 . 应用场景</h2><ol>
<li>http服务器。Nginx是一个http服务可以独立提供http服务。可以做网页静态服务器。</li>
<li>虚拟主机。可以实现在一台服务器虚拟出多个网站。例如个人网站使用的虚拟主机。</li>
<li>反向代理，负载均衡。当网站的访问量达到一定程度后，单台服务器不能满足用户的请求时，需要用多台服务器集群可以使用n ginx做反向代理。并且多台服务器可以平均分担负载，不会因为某台服务器负载高宕机而某台服务器闲置的情况。</li>
</ol>
<h2 id="3-Nginx的安装"><a href="#3-Nginx的安装" class="headerlink" title="3 . Nginx的安装"></a>3 . Nginx的安装</h2><p>Nginx一般推荐安装在Linux系统，并且要安装c语言的编译环境gcc.</p>
<p><strong><em>注意：以下说明和操作都是在linux操作系统下进行的。</em></strong></p>
<h3 id="3-1-安装nginx依赖的包"><a href="#3-1-安装nginx依赖的包" class="headerlink" title="3.1 安装nginx依赖的包"></a>3.1 安装nginx依赖的包</h3><ul>
<li><p>gcc</p>
<p>  安装nginx需要先将官网下载的源码进行编译，编译依赖gcc环境，如果没有gcc环境，需要安装gcc：yum install gcc-c++ </p>
</li>
<li><p>PCRE</p>
<p>  PCRE(Perl Compatible RegularExpressions)是一个Perl库，包括perl兼容的正则表达式库。<br>nginx的http模块使用pcre来解析正则表达式，所以需要在linux上安装pcre库。<br>yum install -y pcre pcre-devel</p>
<p>  注：pcre-devel是使用pcre开发的一个二次开发库。nginx也需要此库。</p>
</li>
<li><p>zlib</p>
<p>  zlib库提供了很多种压缩和解压缩的方式，nginx使用zlib对http包的内容进行gzip，所以需要在linux上安装zlib库。yum install -y zlib zlib-devel</p>
</li>
<li><p>OpenSSL</p>
<p>  是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及SSL协议，并提供丰富的应用程序供测试或其它目的使用。<br>  nginx不仅支持http协议，还支持https（即在ssl协议上传输http），所以需要在linux安装openssl库。yum install -y openssl openssl-devel</p>
</li>
</ul>
<h3 id="3-2-安装nginx步骤"><a href="#3-2-安装nginx步骤" class="headerlink" title="3.2 安装nginx步骤"></a>3.2 安装nginx步骤</h3><ol>
<li>把nginx的源码上传到linux系统</li>
<li>把压缩包解压缩。</li>
<li><p>在当前文件夹中进行configure。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">./configure \</div><div class="line">--prefix=/usr/local/nginx \</div><div class="line">--pid-path=/var/run/nginx/nginx.pid \</div><div class="line">--lock-path=/var/lock/nginx.lock \</div><div class="line">--error-log-path=/var/log/nginx/error.log \</div><div class="line">--http-log-path=/var/log/nginx/access.log \</div><div class="line">--with-http_gzip_static_module \</div><div class="line">--http-client-body-temp-path=/var/temp/nginx/client \</div><div class="line">--http-proxy-temp-path=/var/temp/nginx/proxy \</div><div class="line">--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \</div><div class="line">--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \</div><div class="line">--http-scgi-temp-path=/var/temp/nginx/scgi</div></pre></td></tr></table></figure>
<p> 注意：上边将临时文件目录指定为/var/temp/nginx，需要在/var下创建temp及nginx目录</p>
</li>
<li><p>在当前文件夹中执行：make</p>
</li>
<li>在当前文件夹中执行：make install . 执行完毕后，在/usr/local/nginx/文件夹下会生成新的nginx文件夹</li>
</ol>
<h2 id="4-Nginx的启动和停止"><a href="#4-Nginx的启动和停止" class="headerlink" title="4 . Nginx的启动和停止"></a>4 . Nginx的启动和停止</h2><ul>
<li><p>启动</p>
<p>  进入nginx的sbin目录，./nginx就可以启动。<br>  如果正常启动但是无法访问，可能是防火墙造成的问题，使用指令：<br>  vim /etc/sysconfig/iptables来将端口号打开，再重启service iptables restart</p>
</li>
<li><p>停止</p>
<p>  关闭nginx：可以使用kill命令，但是不推荐使用。推荐使用：./nginx -s stop</p>
</li>
<li><p>刷新配置</p>
<p>  ./nginx -s reload</p>
</li>
</ul>
<h2 id="5-Nginx的配置"><a href="#5-Nginx的配置" class="headerlink" title="5 . Nginx的配置"></a>5 . Nginx的配置</h2><p>在/usr/local/nginx/conf目录下nginx.conf文件是nginx的配置文件。</p>
<p>截取部分配置代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">       listen       80;</div><div class="line">       server_name  localhost;</div><div class="line"></div><div class="line">       #charset koi8-r;</div><div class="line"></div><div class="line">       #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">       location / &#123;</div><div class="line">           root   html;</div><div class="line">           index  index.html index.htm;</div><div class="line">       &#125;</div></pre></td></tr></table></figure>
<p>其中，<br>一个server就是一个虚拟机；<br>80表示端口号；<br>root html表示虚拟主机的根目录；若配置了另一个虚拟主机，在改变了这个虚拟主机的端口号之后，可以重新配置root html至新的根目录，并且可以修改根目录中的显示内容。</p>
<h2 id="5-使用Nginx配置虚拟机，通过域名区分虚拟机"><a href="#5-使用Nginx配置虚拟机，通过域名区分虚拟机" class="headerlink" title="5 . 使用Nginx配置虚拟机，通过域名区分虚拟机"></a>5 . 使用Nginx配置虚拟机，通过域名区分虚拟机</h2><p>DNS服务器的作用：把域名转换成对应的ip地址，并进行返回。</p>
<p>可以通过修改host文件来指定域名的ip地址。</p>
<p>host文件的位置：C:\Windows\System32\drivers\etc</p>
<p>添加如下修改：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># test</div><div class="line">10.108.250.115 esale.com</div></pre></td></tr></table></figure></p>
<p>当在本地访问esale.com时，会跳转到10.108.250.115这个ip地址。</p>
<p><strong>若要通过域名区分虚拟机，需要修改nginx.conf配置文件。</strong></p>
<p>在nginx.conf中添加一段：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">server &#123;</div><div class="line">        listen       80;</div><div class="line">        server_name  test.esale.com;</div><div class="line"></div><div class="line">        #charset koi8-r;</div><div class="line"></div><div class="line">        #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">        location / &#123;</div><div class="line">            root   html-test;</div><div class="line">            index  index.html index.htm;</div><div class="line">        &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>然后配置DNS来指定域名对应的ip<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># test</div><div class="line">10.108.250.115 test.esale.com</div></pre></td></tr></table></figure></p>
<p>再在nginx文件夹下添加拷贝html文件夹并重命名为html-test，则可以访问成功。</p>
<h2 id="6-Nginx的反向代理"><a href="#6-Nginx的反向代理" class="headerlink" title="6 . Nginx的反向代理"></a>6 . Nginx的反向代理</h2><p>反向代理服务器是应用在服务端。决定哪台服务器提供服务。</p>
<h3 id="6-1-反向代理的模拟"><a href="#6-1-反向代理的模拟" class="headerlink" title="6.1 反向代理的模拟"></a>6.1 反向代理的模拟</h3><p>应该有一个nginx服务器，多个应用服务器（可以是tomcat）。需要安装一个nginx和多个tomcat进行模拟。</p>
<p>nginx服务器按上述的过程已经部署完毕。可以在/usr/local/中安装多个tomcat(此处安装了2个tomcat)。并且修改端口号以避免冲突：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">Server</span> <span class="attr">port</span>=<span class="string">"8006"</span> <span class="attr">shutdown</span>=<span class="string">"SHUTDOWN"</span>&gt;</span></div><div class="line">···</div><div class="line"> <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8081"</span> <span class="attr">protocol</span>=<span class="string">"HTTP/1.1"</span></span></div><div class="line">               <span class="attr">connectionTimeout</span>=<span class="string">"20000"</span></div><div class="line">               <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</div><div class="line">···</div><div class="line"><span class="comment">&lt;!-- Define an AJP 1.3 Connector on port 8009 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">Connector</span> <span class="attr">port</span>=<span class="string">"8010"</span> <span class="attr">protocol</span>=<span class="string">"AJP/1.3"</span> <span class="attr">redirectPort</span>=<span class="string">"8443"</span> /&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong><em>Nginx配置文件nginx.conf：</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">upstream tomcats&#123;</div><div class="line">	server 10.108.250.115:8080 ;</div><div class="line">	server 10.108.250.115:8081;</div><div class="line">&#125;</div><div class="line"></div><div class="line">server &#123;</div><div class="line">       listen       80;</div><div class="line">       server_name  tomcat.esale.com;</div><div class="line"></div><div class="line">       #charset koi8-r;</div><div class="line"></div><div class="line">       #access_log  logs/host.access.log  main;</div><div class="line"></div><div class="line">       location / &#123;</div><div class="line">           proxy_pass http://tomcats;</div><div class="line">           index  index.html index.htm;</div><div class="line">       	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong><em>负载均衡：</em></strong><br>只需要在upstream的server后面添加一个weight即可代表权重。权重越高，分配请求的数量就越多。默认权重是1。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">upstream tomcats&#123;</div><div class="line">	server 10.108.250.115:8080 ;</div><div class="line">	server 10.108.250.115:8081;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/31/Nginx/" data-id="cj70kwxbs000fi4txzei06ti7" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringMVC学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/25/SpringMVC学习/" class="article-date">
  <time datetime="2017-05-25T14:54:21.372Z" itemprop="datePublished">2017-05-25</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/25/SpringMVC学习/">SpringMVC学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： SpringMVC</p>
<hr>
<h2 id="二-SpringMVC入门案例"><a href="#二-SpringMVC入门案例" class="headerlink" title="二 . SpringMVC入门案例"></a>二 . SpringMVC入门案例</h2><h2 id="三-HandlerMapping"><a href="#三-HandlerMapping" class="headerlink" title="三 . HandlerMapping"></a>三 . HandlerMapping</h2><p>HandlerMapping：简单url处理器映射器，把url进行集中配置。</p>
<p>注意：映射器之间可以共存</p>
<h2 id="四-HandlerAdapter"><a href="#四-HandlerAdapter" class="headerlink" title="四 . HandlerAdapter"></a>四 . HandlerAdapter</h2><h3 id="4-1-SimpleControllerHandlerAdapter"><a href="#4-1-SimpleControllerHandlerAdapter" class="headerlink" title="4.1 SimpleControllerHandlerAdapter"></a>4.1 SimpleControllerHandlerAdapter</h3><p>继承Controller接口</p>
<h2 id="五-接收页面参数"><a href="#五-接收页面参数" class="headerlink" title="五 . 接收页面参数"></a>五 . 接收页面参数</h2><p>springmvc使用<strong><em>命令设计模式</em></strong>设计封装对象</p>
<h3 id="时间类型转换"><a href="#时间类型转换" class="headerlink" title="时间类型转换"></a>时间类型转换</h3><p>POJO类中定义了时间类Date(),使用initBinder()来进行时间类型转换。<br><code>binder.registerCustomEditor()</code></p>
<h2 id="六-注解开发"><a href="#六-注解开发" class="headerlink" title="六 . 注解开发"></a>六 . 注解开发</h2><h3 id="6-1-RequestMapping"><a href="#6-1-RequestMapping" class="headerlink" title="6.1 RequestMapping"></a>6.1 RequestMapping</h3><ul>
<li><p>集中使用方法：<br>requestMapping(“hello”)<br>requestMapping(“/hello.do”)<br>requestMapping(value=”/hello.do”)<br>requestMapping(value=”/hello.do”,method=RequestMethod.GET) — 注：使用GET方式，则不能直接使用url访问<br>requestMapping(value=”/hello.do”,method=RequestMethod.POST)<br>requestMapping(value=”/hello.do”,method={RequestMethod.POST, RequestMethod.GET})</p>
</li>
<li><p>RequestMapping根路径<br>在类的上方加上RequestMapping(/根路径)，例如：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/user"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>此举有利于解决在不同的Controller中出现相同方法时而不能正常封装参数的问题。</p>
<h3 id="6-2-SpringMVC封装参数"><a href="#6-2-SpringMVC封装参数" class="headerlink" title="6.2 SpringMVC封装参数"></a>6.2 SpringMVC封装参数</h3><p><strong><em>注意：springmvc没有成员变量，把需要传递参数对象放入方法中，当请求方法的时候，这个方法里的对象会自动被创建，需要封装的参数会自动被封装到方法的对象里面。</em></strong></p>
<p>在struts2中，参数的封装是基于属性封装的；在SpringMVC中，参数是基于方法进行封装。</p>
<p>SpringMVC可以接受的数据类型包括：基本类型、String类型、数组类型、POJO类型、包装类型、集合类型（List、Map等）···</p>
<p>在参数的接收方面需要注意一定的问题：</p>
<ul>
<li>在基本类型、String类型、数组类型中，表单input标签中的name属性值要和Controller中方法的参数名<strong>一致</strong></li>
</ul>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;form action=<span class="string">"$&#123;pageContext.request.contextPath &#125;/user/receiveInt.do"</span> method=<span class="string">"post"</span>&gt;</div><div class="line">ID：&lt;input type=<span class="string">"text"</span> name=<span class="string">"id"</span> id=<span class="string">"id"</span>&gt;</div><div class="line">&lt;input type=<span class="string">"submit"</span> value=<span class="string">"提交"</span>&gt;</div></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//接受int类型参数</span></div><div class="line"><span class="meta">@RequestMapping</span>(<span class="string">"receiveInt"</span>)</div><div class="line"><span class="function"><span class="keyword">public</span> String <span class="title">recieveInt</span><span class="params">(Integer id)</span></span>&#123;</div><div class="line">	System.out.println(id);</div><div class="line">	<span class="keyword">return</span> <span class="string">"success"</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>POJO类</li>
</ul>
<h2 id="七-SpringMVC支持json数据"><a href="#七-SpringMVC支持json数据" class="headerlink" title="七 . SpringMVC支持json数据"></a>七 . SpringMVC支持json数据</h2><p>@RequestBody接受前台json数据，把json数据自动封装javaBean。</p>
<p>@responseBody把后台pojo转换json对象，返回到页面。</p>
<h2 id="八-Springmvc多视图"><a href="#八-Springmvc多视图" class="headerlink" title="八 . Springmvc多视图"></a>八 . Springmvc多视图</h2><h2 id="十-Oscache整合SSM项目"><a href="#十-Oscache整合SSM项目" class="headerlink" title="十 . Oscache整合SSM项目"></a>十 . Oscache整合SSM项目</h2><p>约定 ： 商品页面访问量特别大，给商品页面缓存。items路径下所有请求都缓存。</p>
<p>在web.xml中配置过滤器：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>oscache<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.opensymphony.oscache.web.filter.CacheFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>time<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>3600<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>scope<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>application<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></div><div class="line">  </div><div class="line">  <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>oscache<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/items/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>利用断点来判断是否存在缓存。</p>
<h2 id="十-SpringMVC的拦截器"><a href="#十-SpringMVC的拦截器" class="headerlink" title="十 . SpringMVC的拦截器"></a>十 . SpringMVC的拦截器</h2><p>在请求处理器映射器映射的时候，就发生拦截。</p>
<h3 id="10-1-局部拦截器"><a href="#10-1-局部拦截器" class="headerlink" title="10.1 局部拦截器"></a>10.1 局部拦截器</h3><p>针对单个处理器映射器，就叫局部拦截器。</p>
<h3 id="10-2-全局拦截器"><a href="#10-2-全局拦截器" class="headerlink" title="10.2 全局拦截器"></a>10.2 全局拦截器</h3><p>在springmvc.xml中添加如下配置:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!--拦截器 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!--多个拦截器,顺序执行 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.yao.interceptor.Interceptor1"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">"/**"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"com.yao.interceptor.Interceptor2"</span>&gt;</span><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>拦截器类需要实现<strong><em>HandlerInterceptor接口</em></strong></p>
<p>preHandler在处理映射器之前进行执行<br>return false:拦截<br>return true ：放行</p>
<p>postHandler在还没有调用Controller，还没有返回modelAndView执行</p>
<p>afterCompletion在返回modelAndView之后执行</p>
<p><strong>测试</strong>：</p>
<ul>
<li>测试1<br>拦截器1放行，拦截器2放行：<br>HandlerInterceptor1………preHandle<br>HandlerInterceptor2………preHandle<br>HandlerInterceptor2………postHandle<br>HandlerInterceptor1………postHandle<br>HandlerInterceptor2………afterCompletion<br>HandlerInterceptor1………afterCompletion</li>
<li><p>测试2<br>拦截器1放行，拦截器2阻止：<br>HandlerInterceptor1………preHandle<br>HandlerInterceptor2………preHandle<br>HandlerInterceptor1………afterCompletion</p>
</li>
<li><p>测试3：<br>拦截器1阻止，拦截器2阻止：<br>HandlerInterceptor1………preHandle</p>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/25/SpringMVC学习/" data-id="cj70kwxc1000ii4txx9yhezix" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-SpringMVC的freemarker支持" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/23/SpringMVC的freemarker支持/" class="article-date">
  <time datetime="2017-05-23T13:48:35.767Z" itemprop="datePublished">2017-05-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/23/SpringMVC的freemarker支持/">SpringMVC的freemarker支持</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： SpringMVC freemarker</p>
<hr>
<h2 id="一-简介"><a href="#一-简介" class="headerlink" title="一 . 简介"></a>一 . 简介</h2><p>FreeMarker是一款模板引擎：即一种基于模板和要改变的数据，并用来生成输出文本（HTML网页、电子邮件、配置文件、源代码等）的通用工具。</p>
<p>FreeMarker 的设计实际上是被用来生成HTML网页，尤其是通过基于实现了MVC模式的Servlet应用程序。使用MVC 模式的动态网页的构思使得你可以将前端设计者(编写HTML)从程序员中分离出来。所有人各司其职，发挥其擅长的一面。网页设计师可以改写页面的显示效果而不受程序员编译代码的影响，因为应用程序的逻辑(Java程序)和页面设计(FreeMarker模板)已经分开了。页面模板代码不会受到复杂的程序代码影响。这种分离的思想即便对一个程序员和页面设计师是同一个人的项目来说都是非常有用的，因为分离使得代码保持简洁而且便于维护。</p>
<p>尽管FreeMarker 也有编程能力，但它也不是像PHP那样的一种全面的编程语言。反而，Java程序准备的数据来显示(比如SQL 查询)，FreeMarker 仅仅使用模板生成文本页面来呈现已经准备好的数据。</p>
<h2 id="二-实例编写"><a href="#二-实例编写" class="headerlink" title="二 . 实例编写"></a>二 . 实例编写</h2><ol>
<li><p>jar包<br>包括Freemarker包和spring-context-support.jar</p>
</li>
<li><p>配置freemarker视图支持</p>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/23/SpringMVC的freemarker支持/" data-id="cj70kwxcb000ni4txudtkb40y" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mybatis学习二" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/18/Mybatis学习二/" class="article-date">
  <time datetime="2017-05-18T15:13:41.942Z" itemprop="datePublished">2017-05-18</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/18/Mybatis学习二/">Mybatis学习二</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Mybatis</p>
<hr>
<h2 id="一-高级结果映射"><a href="#一-高级结果映射" class="headerlink" title="一 . 高级结果映射"></a>一 . 高级结果映射</h2><p>高级结果映射包括：<strong><em>一对一、一对多、多对多（没有多对一）</em></strong></p>
<p>结果映射可以使用两种方式：<strong><em>resultType</em></strong> <strong><em>resultMap</em></strong></p>
<p>两者存在一定的区别：</p>
<ul>
<li><p><strong>resultType</strong><br>使用resultType来进行一对一结果映射，查询出的列的个数和映射的属性的个数要一致。而且映射的属性要存在于一个大对象中，它是一种平铺式的映射，即数据库查询出多少条记录，则映射成多少个对象。</p>
</li>
<li><p><strong>resultMap</strong><br>在一对一结果映射时，使用resultType更加简单方便，如果有特殊要求（对象嵌套对象）时，需要使用resultMap进行映射。比如：查询订单列表，然后在点击列表中的查看订单明细按钮，这个时候就需要使用resultMap进行结果映射。而resultType更适应于查询明细信息，比如，查询订单明细列表。</p>
</li>
</ul>
<p>在实际开发中，从对象的角度出发，resultMap使用相对更多。</p>
<h3 id="1-1-一对一映射"><a href="#1-1-一对一映射" class="headerlink" title="1.1 一对一映射"></a>1.1 一对一映射</h3><h4 id="一对一映射—-resultType使用示例"><a href="#一对一映射—-resultType使用示例" class="headerlink" title="一对一映射—-resultType使用示例"></a>一对一映射—-resultType使用示例</h4><p>想要实现的功能：查询订单信息，并关联用户的信息</p>
<ul>
<li><p>拓展orders类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OrdersExt</span> <span class="keyword">extends</span> <span class="title">Orders</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> String username;</div><div class="line">	<span class="keyword">private</span> String sex;</div></pre></td></tr></table></figure>
</li>
<li><p>映射文件<br>注意sql语句（即需要打印的信息）</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yao.mybatis.mapper.OrdersMapper"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 一对一映射之resultType --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersAndUser"</span> <span class="attr">resultType</span>=<span class="string">"com.yao.mybatis.po.OrdersExt"</span>&gt;</span></div><div class="line">		SELECT</div><div class="line">		orders.`id`,</div><div class="line">		orders.`user_id`,</div><div class="line">		orders.`number`,</div><div class="line">		user.`username`,</div><div class="line">		user.`sex`</div><div class="line">		FROM</div><div class="line">		orders,</div><div class="line">		USER</div><div class="line">		WHERE orders.`user_id` = user.`id`</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span>/&gt;</span></div></pre></td></tr></table></figure>
</li>
<li><p>Mapper接口</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">OrderMapper</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;OrderExt&gt; <span class="title">findOrdersAndUser</span><span class="params">()</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>测试代码<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> SqlSessionFactory sqlSessionFactory;</div><div class="line"></div><div class="line">	<span class="meta">@Before</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// 读取配置文件</span></div><div class="line">		<span class="comment">// 全局配置文件的路径</span></div><div class="line">		String resource = <span class="string">"SqlMapConfig.xml"</span>;</div><div class="line">		InputStream inputStream = Resources.getResourceAsStream(resource);</div><div class="line">		<span class="comment">// 创建SqlSessionFactory</span></div><div class="line">		sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindOrdersAndUser</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="comment">// 创建OrdersMapper对象</span></div><div class="line">		SqlSession sqlSession = sqlSessionFactory.openSession();</div><div class="line"></div><div class="line">		OrdersMapper mapper = sqlSession.getMapper(OrdersMapper.class);</div><div class="line"></div><div class="line">		List&lt;OrdersExt&gt; list = mapper.findOrdersAndUser();</div><div class="line"></div><div class="line">		sqlSession.close();</div><div class="line">	&#125;</div></pre></td></tr></table></figure>
</li>
</ul>
<p>打印出的结果是平铺的，有几条查询结果就有几个对象。</p>
<h4 id="一对一映射—-resultMap使用示例"><a href="#一对一映射—-resultMap使用示例" class="headerlink" title="一对一映射—-resultMap使用示例"></a>一对一映射—-resultMap使用示例</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yao.mybatis.mapper.OrdersMapper"</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.yao.mybatis.po.OrdersExt"</span> <span class="attr">id</span>=<span class="string">"OrdersAndUserRstMap"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"number"</span> <span class="attr">property</span>=<span class="string">"number"</span>/&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 用户信息（一对一） --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- association：一对一关联映射 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- property：关联信息查询的结果将要映射的扩展类中的对象属性名称 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- id标签：建议在关联查询时必须写上，不写不会报错，但是会影响性能 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">"user"</span> <span class="attr">javaType</span>=<span class="string">"com.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"user_id"</span> <span class="attr">property</span>=<span class="string">"id"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"username"</span> <span class="attr">property</span>=<span class="string">"username"</span>/&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"sex"</span> <span class="attr">property</span>=<span class="string">"sex"</span>/&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">association</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 一对一映射之resultMap --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersAndUserRstMap"</span> <span class="attr">resultMap</span>=<span class="string">"OrdersAndUserRstMap"</span>&gt;</span></div><div class="line">		SELECT</div><div class="line">		orders.`id`,</div><div class="line">		orders.`user_id`,</div><div class="line">		orders.`number`,</div><div class="line">		user.`username`,</div><div class="line">		user.`sex`</div><div class="line">		FROM</div><div class="line">		orders,</div><div class="line">		USER</div><div class="line">		WHERE orders.`user_id` = user.`id`</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="1-2-一对多映射"><a href="#1-2-一对多映射" class="headerlink" title="1.2 一对多映射"></a>1.2 一对多映射</h3><ul>
<li>extends：可以继承一个已有的resultMap，指定resultMap的唯一标示即可。<strong>注意</strong>：继承时，只能继承type类型是一样的resultMap</li>
<li><strong>collection</strong> : 映射一对多关系</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">type</span>=<span class="string">"com.yao.mybatis.po.OrdersExt"</span> <span class="attr">id</span>=<span class="string">"OrdersAndDetailRstMap"</span></span></div><div class="line">	<span class="attr">extends</span>=<span class="string">"OrdersAndUserRstMap"</span>&gt;</div><div class="line">	<span class="comment">&lt;!-- 订单明细信息（一对多） --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- collection：映射一对多关系 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">"detailList"</span> <span class="attr">ofType</span>=<span class="string">"com.yao.mybatis.po.Orderdetail"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"detailId"</span> <span class="attr">property</span>=<span class="string">"id"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_id"</span> <span class="attr">property</span>=<span class="string">"itemsId"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"items_num"</span> <span class="attr">property</span>=<span class="string">"itemsNum"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">collection</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></div><div class="line"></div><div class="line"><span class="comment">&lt;!-- 一对多映射 --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findOrdersAndDetailRstMap"</span> <span class="attr">resultMap</span>=<span class="string">"OrdersAndDetailRstMap"</span>&gt;</span></div><div class="line">	SELECT</div><div class="line">	orders.`id`,</div><div class="line">	orders.`user_id`,</div><div class="line">	orders.`number`,</div><div class="line">	user.`username`,</div><div class="line">	user.`sex`,</div><div class="line">	orderdetail.`id` detailId,</div><div class="line">	orderdetail.`items_id`,</div><div class="line">	orderdetail.`items_num`</div><div class="line">	FROM</div><div class="line">	orders,</div><div class="line">	USER,</div><div class="line">	orderdetail</div><div class="line">	WHERE</div><div class="line">	orders.`user_id` = user.`id`</div><div class="line">	AND orders.`id` = orderdetail.`orders_id`</div><div class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></div></pre></td></tr></table></figure>
<h3 id="1-3-多对多映射"><a href="#1-3-多对多映射" class="headerlink" title="1.3 多对多映射"></a>1.3 多对多映射</h3><h2 id="二-延迟加载"><a href="#二-延迟加载" class="headerlink" title="二 . 延迟加载"></a>二 . 延迟加载</h2><h2 id="三-缓存机制"><a href="#三-缓存机制" class="headerlink" title="三 . 缓存机制"></a>三 . 缓存机制</h2><h2 id="四-ehcache"><a href="#四-ehcache" class="headerlink" title="四 . ehcache"></a>四 . ehcache</h2><h3 id="使用场景"><a href="#使用场景" class="headerlink" title="使用场景"></a>使用场景</h3><p>对于访问响应速度要求高，但是实时性不高的查询，可以采用二级缓存技术。<br>注意：在使用二级缓存的时候，要设置一下刷新间隔（cache标签中有一个flashInterval属性）来定时刷新二级缓存，这个刷新间隔根据具体需求来设置，比如设置30分钟、60分钟等，单位为毫秒。</p>
<h3 id="局限性"><a href="#局限性" class="headerlink" title="局限性"></a>局限性</h3><p><strong><em>Mybatis二级缓存对细粒度的数据，缓存实现不好。</em></strong><br>场景：对商品信息进行缓存，由于商品信息查询访问量大，但是要求用户每次查询都是最新的商品信息，此时如果使用二级缓存，就无法实现当一个商品发生变化只刷新该商品的缓存信息而不刷新其他商品缓存信息，因为二级缓存是mapper级别的，当一个商品的信息发送更新，所有的商品信息缓存数据都会清空。<br>解决此类问题，需要在业务层根据需要对数据有针对性的缓存。<br><strong><em>比如可以对经常变化的数据操作单独放到另一个namespace的mapper中。</em></strong></p>
<h2 id="五-Mybatis整合spring"><a href="#五-Mybatis整合spring" class="headerlink" title="五 . Mybatis整合spring"></a>五 . Mybatis整合spring</h2><h3 id="5-1-整合思路"><a href="#5-1-整合思路" class="headerlink" title="5.1 整合思路"></a>5.1 整合思路</h3><ol>
<li>数据源信息交给spring管理</li>
<li>SqlSessionFactory交给spring进行<strong>单例</strong>管理</li>
<li>由spring来管理原始dao的实现类或mapper代理的代理类</li>
</ol>
<h3 id="5-2-需求"><a href="#5-2-需求" class="headerlink" title="5.2 需求"></a>5.2 需求</h3><p>使用原始dao方式和mapper代理方式实现以下功能：<br>根据用户id查询商品信息</p>
<h3 id="5-3-工程搭建"><a href="#5-3-工程搭建" class="headerlink" title="5.3 工程搭建"></a>5.3 工程搭建</h3><ul>
<li>Mysql的驱动包</li>
<li>Mybatis的和核心包和依赖包</li>
<li>Mybatis和spring的整合包</li>
<li>Spring包</li>
<li>dbcp数据库连接池</li>
</ul>
<h3 id="5-4-整合"><a href="#5-4-整合" class="headerlink" title="5.4 整合"></a>5.4 整合</h3><p>一共有两种方式，一种是原始dao方式，一种是Mapper映射文件代理的方式。</p>
<p><strong><em>1. 原始dao方法</em></strong> </p>
<p>1.1 将db.properties和log4j.properties拷贝到config目录下。</p>
<p>1.2 在config下，创建mybatis目录，然后创建SqlMapConfig.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE configuration</span></div><div class="line">PUBLIC "-//mybatis.org//DTD Config 3.0//EN"</div><div class="line">"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 自定义别名 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.yao.ms.po"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 加载映射文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mybatis/sqlmap/User.xml"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>1.3 在config下，创建spring目录，然后创建applicationContext.xml;<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">		http://www.springframework.org/schema/beans/spring-beans-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/mvc </div><div class="line">		http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/context </div><div class="line">		http://www.springframework.org/schema/context/spring-context-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/aop </div><div class="line">		http://www.springframework.org/schema/aop/spring-aop-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/tx </div><div class="line">		http://www.springframework.org/schema/tx/spring-tx-3.2.xsd "&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 加载java的配置文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 创建数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- SqlSessionFactory --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 指定mybatis的全局配置文件的路径 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"mybatis/SqlMapConfig.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据源 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- UserDao --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userDao"</span> <span class="attr">class</span>=<span class="string">"com.yao.ms.dao.UserDaoImpl"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 依赖注入SqlSessionFactory --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">beans</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<p>1.4 在config/mybatis下创建sqlmap，然后创建User.xml:<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper    </span></div><div class="line">PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    </div><div class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"test"</span>&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 根据用户ID查询用户信息 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"user"</span>&gt;</span></div><div class="line">		SELECT</div><div class="line">		* FROM USER WHERE id =#&#123;id&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>1.5 dao接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line">	<span class="comment">// 1、 根据用户ID查询用户信息</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception</span>;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1.6 dao实现类<br>注意继承<strong>SqlSessionDaoSupport</strong>，并使用<strong>getSqlSession()</strong>进行数据库操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserDao</span> </span>&#123;</div><div class="line"></div><div class="line">	<span class="meta">@Override</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="keyword">return</span> <span class="keyword">this</span>.getSqlSession().selectOne(<span class="string">"test.findUserById"</span>, id);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1.7 dao方法测试代码<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDaoTest</span> </span>&#123;</div><div class="line">	</div><div class="line">	<span class="keyword">private</span> ApplicationContext ctx;</div><div class="line"></div><div class="line">	<span class="meta">@Before</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		ctx = <span class="keyword">new</span> ClassPathXmlApplicationContext(</div><div class="line">				<span class="string">"spring/applicationContext.xml"</span>);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindUserById</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</div><div class="line">		<span class="comment">// 创建UserDao</span></div><div class="line">		UserDao dao = (UserDao) ctx.getBean(<span class="string">"userDao"</span>);</div><div class="line">		</div><div class="line">		User user = dao.findUserById(<span class="number">1</span>);</div><div class="line">		</div><div class="line">		System.out.println(user);</div><div class="line">	&#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong><em>2. Mapper代理</em></strong><br>步骤1.1的添加数据库文件和日志文件 和 步骤 1.2的全局配置文件 保持不变</p>
<p>1.3 将映射文件放到UserMapper接口的同包下：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper    </span></div><div class="line">PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    </div><div class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.yao.ms.mapper.UserMapper"</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 根据用户ID查询用户信息 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"User"</span>&gt;</span></div><div class="line">		SELECT</div><div class="line">		* FROM USER WHERE id =#&#123;id&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>1.4 Mapper接口<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> interface <span class="title">UserMapper</span><span class="params">()</span></span>&#123;</div><div class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>1.5 spring配置文件<br><strong>注意：</strong>配置Mapper代理类有两种方式：一种是单独配置，一种是批量配置。<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></div><div class="line">	<span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:mvc</span>=<span class="string">"http://www.springframework.org/schema/mvc"</span></div><div class="line">	<span class="attr">xmlns:context</span>=<span class="string">"http://www.springframework.org/schema/context"</span></div><div class="line">	<span class="attr">xmlns:aop</span>=<span class="string">"http://www.springframework.org/schema/aop"</span> <span class="attr">xmlns:tx</span>=<span class="string">"http://www.springframework.org/schema/tx"</span></div><div class="line">	<span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans </span></div><div class="line">		http://www.springframework.org/schema/beans/spring-beans-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/mvc </div><div class="line">		http://www.springframework.org/schema/mvc/spring-mvc-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/context </div><div class="line">		http://www.springframework.org/schema/context/spring-context-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/aop </div><div class="line">		http://www.springframework.org/schema/aop/spring-aop-3.2.xsd </div><div class="line">		http://www.springframework.org/schema/tx </div><div class="line">		http://www.springframework.org/schema/tx/spring-tx-3.2.xsd "&gt;</div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 加载java的配置文件 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">"db.properties"</span> /&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 创建数据源 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"dataSource"</span> <span class="attr">class</span>=<span class="string">"org.apache.commons.dbcp.BasicDataSource"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driverClassName"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxActive"</span> <span class="attr">value</span>=<span class="string">"10"</span> /&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"maxIdle"</span> <span class="attr">value</span>=<span class="string">"5"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- SqlSessionFactory --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.SqlSessionFactoryBean"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 指定mybatis的全局配置文件的路径 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"configLocation"</span> <span class="attr">value</span>=<span class="string">"mybatis/SqlMapConfig.xml"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 数据源 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"dataSource"</span> <span class="attr">ref</span>=<span class="string">"dataSource"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!--单独配置mapper代理类--&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 配置UserMapper代理类 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"userMapper"</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperFactoryBean"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 设置代理类的接口 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"mapperInterface"</span> <span class="attr">value</span>=<span class="string">"com.yao.ms.mapper.UserMapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 依赖注入SqlSessionFactory --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactory"</span> <span class="attr">ref</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line">    </div><div class="line">    <span class="comment">&lt;!--批量配置mapper代理类--&gt;</span></div><div class="line">	<span class="comment">&lt;!-- 批量配置mapper代理类，默认bean的id为类名首字母小写 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">"org.mybatis.spring.mapper.MapperScannerConfigurer"</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置扫描的包 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"basePackage"</span> <span class="attr">value</span>=<span class="string">"com.yao.ms.mapper"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 默认不需要配置SqlSessionFactory（只有一个SqlSessionFactory时），单独配置也可以 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"sqlSessionFactoryBeanName"</span> <span class="attr">value</span>=<span class="string">"sqlSessionFactory"</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">bean</span>&gt;</span></div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/18/Mybatis学习二/" data-id="cj70kwxbr000ei4txlbuaf7oa" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mybatis学习一" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/15/Mybatis学习一/" class="article-date">
  <time datetime="2017-05-15T01:58:00.311Z" itemprop="datePublished">2017-05-15</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/15/Mybatis学习一/">Mybatis学习一</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Mybatis</p>
<hr>
<h2 id="一-简介"><a href="#一-简介" class="headerlink" title="一 . 简介"></a>一 . 简介</h2><p>mybatis就是一个封装来jdbc的持久层框架，它和hibernate都属于ORM框架，但是具体的说，hibernate是一个完全的orm框架，而mybatis是一个不完全的orm框架。</p>
<p>Mybatis可以让编写程序的人只关注sql本身，而不需要去关注如连接的创建、statement的创建等操作。</p>
<p>Mybatis会将<strong>输入参数、输出结果</strong>进行映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">			Connection connection = <span class="keyword">null</span>;</div><div class="line">			PreparedStatement preparedStatement = <span class="keyword">null</span>;</div><div class="line">			ResultSet resultSet = <span class="keyword">null</span>;</div><div class="line">			</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="comment">//1、加载数据库驱动</span></div><div class="line">				Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">				<span class="comment">//2、通过驱动管理类获取数据库链接</span></div><div class="line">				connection =  DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8"</span>, <span class="string">"root"</span>, <span class="string">"root"</span>);</div><div class="line">				<span class="comment">//3、定义sql语句 ?表示占位符</span></div><div class="line">			String sql = <span class="string">"select * from user where username = ?"</span>;</div><div class="line">				<span class="comment">//4、获取预处理statement</span></div><div class="line">				preparedStatement = connection.prepareStatement(sql);</div><div class="line">				<span class="comment">//5、设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个参数为设置的参数值</span></div><div class="line">				preparedStatement.setString(<span class="number">1</span>, <span class="string">"王五"</span>);</div><div class="line">				<span class="comment">//6、向数据库发出sql执行查询，查询出结果集</span></div><div class="line">				resultSet =  preparedStatement.executeQuery();</div><div class="line">				<span class="comment">//7、遍历查询结果集</span></div><div class="line">				<span class="keyword">while</span>(resultSet.next())&#123;</div><div class="line">					System.out.println(resultSet.getString(<span class="string">"id"</span>)+<span class="string">"  "</span>+resultSet.getString(<span class="string">"username"</span>));</div><div class="line">				&#125;</div><div class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;<span class="keyword">finally</span>&#123;</div><div class="line">				<span class="comment">//8、释放资源</span></div><div class="line">				<span class="keyword">if</span>(resultSet!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						resultSet.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(preparedStatement!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						preparedStatement.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(connection!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						connection.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<p>上述原始的Jdbc操作中，存在硬编码和频繁连接数据库的问题。<br>需解决此问题：</p>
<ul>
<li>在创建连接时使用全局配置文件；</li>
<li>在执行statement时配置映射文件；</li>
<li>在频繁连接和关闭数据库连接时，要使用数据库连接池。</li>
</ul>
<h2 id="二-Mybatis框架原理"><a href="#二-Mybatis框架原理" class="headerlink" title="二 . Mybatis框架原理"></a>二 . Mybatis框架原理</h2><ul>
<li><p>mybatis配置文件，包括Mybatis全局配置文件和Mybatis映射文件，<br>其中<strong>全局配置文件</strong>配置了数据源、事务等信息；<strong>映射文件</strong>配置了SQL执行相关的信息。</p>
</li>
<li><p>Mybatis通过读取配置文件信息（全局配置文件和映射文件），构造出SqlSessionFactory，即会话工厂。然后通过SqlSessionFactory，可以创建SqlSession即会话。Mybatis是通过SqlSession来操作数据库的。</p>
</li>
<li><p>SqlSession本身不能直接操作数据库，它是通过底层的Executor执行器接口来操作数据库的。Executor接口有两个实现类，一个是普通执行器，一个是<strong>缓存执行器（默认）</strong>。</p>
</li>
</ul>
<p><strong>注意：</strong>在执行<strong><em>增删改</em></strong>的操作时需要对SqlSession执行commit操作!!!</p>
<h2 id="三-原始Dao开发方式和Mapper代理开发方式"><a href="#三-原始Dao开发方式和Mapper代理开发方式" class="headerlink" title="三 . 原始Dao开发方式和Mapper代理开发方式"></a>三 . 原始Dao开发方式和Mapper代理开发方式</h2><p>原始Dao开发会存在一些模板代码和硬编码，因此选择Mapper代理开发方式。</p>
<p>Mapper代理开发方式的开发步骤：</p>
<ol>
<li>根据需求创建PO类</li>
<li>编写全局配置文件 —-  SqlMapConfig.xml</li>
<li>根据需求编写映射文件 —- UserMapper.xml</li>
<li>加载映射文件</li>
<li>编写Mapper接口</li>
</ol>
<p>第一步和第二步省略。SqlMapConfig.xml中配置了数据源和事务管理，并加载映射文件.<br><strong>根据需求编写映射文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper    </span></div><div class="line">PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    </div><div class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- namespace：此时用mapper代理方式，它的值必须等于对应mapper接口的全限定名  --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.yao.mybatis.mapper.UserMapper"</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 根据用户ID，查询用户信息 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[id]：statement的id，要求在命名空间内唯一  </div><div class="line">		[parameterType]：入参的java类型，可是是简单类型、POJO、HashMap</div><div class="line">		[resultType]：查询出的单条结果集对应的java类型</div><div class="line">		[#&#123;&#125;]： 表示一个占位符?</div><div class="line">		[#&#123;id&#125;]：表示该占位符待接收参数的名称为id。注意：如果参数为简单类型时，#&#123;&#125;里面的参数名称可以是任意定义</div><div class="line">	 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		SELECT * FROM USER WHERE id = #&#123;id&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 根据用户名称模糊查询用户信息列表 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[$&#123;&#125;]：表示拼接SQL字符串，即不加解释的原样输出</div><div class="line">	 	[$&#123;value&#125;]：表示要拼接的是简单类型参数。</div><div class="line">		 注意：</div><div class="line">		1、如果参数为简单类型时，$&#123;&#125;里面的参数名称必须为value </div><div class="line">		2、$&#123;&#125;会引起SQL注入，一般情况下不推荐使用。但是有些场景必须使用$&#123;&#125;，比如order by $&#123;colname&#125;</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUsersByName"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span> <span class="attr">resultType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		SELECT * FROM USER WHERE username LIKE '%$&#123;value&#125;%'</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 添加用户之自增主键返回（selectKey方式） --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[selectKey标签]：通过select查询来生成主键</div><div class="line">		[keyProperty]：指定存放生成主键的属性</div><div class="line">		[resultType]：生成主键所对应的Java类型</div><div class="line">		[order]：指定该查询主键SQL语句的执行顺序，相对于insert语句，此时选用AFTER</div><div class="line">		[last_insert_id]：MySQL的函数，要配合insert语句一起使用</div><div class="line">	 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></div><div class="line">			SELECT LAST_INSERT_ID()</div><div class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></div><div class="line">		INSERT INTO USER(username,sex,birthday,address) VALUES (#&#123;username&#125;,#&#123;sex&#125;,#&#123;birthday&#125;,#&#123;address&#125;)</div><div class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line">	</div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>加载mapper映射文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/UserMapper.xml"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>编写mapper接口</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</div><div class="line">	<span class="comment">//根据用户ID来查询用户信息</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line">	<span class="comment">//根据用户名称来模糊查询用户信息列表</span></div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUsersByName</span><span class="params">(String username)</span></span>;</div><div class="line">	<span class="comment">//添加用户</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</div></pre></td></tr></table></figure></p>
<h2 id="四-全局配置文件"><a href="#四-全局配置文件" class="headerlink" title="四 . 全局配置文件"></a>四 . 全局配置文件</h2><p>全局配置文件的命名可以是任意的，本文中就使用SqlMapConfig.xml来表示。</p>
<p><strong><em>SqlMapConfig.xml的配置内容和顺序如下（顺序不能乱）：</em></strong><br>Properties（属性）<br>Settings（全局参数设置）<br>typeAliases（类型别名）<br>typeHandlers（类型处理器）<br>objectFactory（对象工厂）<br>plugins（插件）<br>environments（环境信息集合）<br>———-environment（单个环境信息）<br>——————-transactionManager（事物）<br>——————-dataSource（数据源）<br>mappers（映射器）</p>
<h3 id="4-1-Properties"><a href="#4-1-Properties" class="headerlink" title="4.1 Properties"></a>4.1 Properties</h3><p>Db.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db.driver=com.mysql.jdbc.Driver</div><div class="line">db.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;characterEncoding=utf8</div><div class="line">db.username=root</div><div class="line">db.password=root</div></pre></td></tr></table></figure></p>
<p>SqlMapConfig.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 加载java的配置文件或者声明属性信息 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"db.username"</span> <span class="attr">value</span>=<span class="string">"123"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置mybatis的环境信息，与spring整合，该信息由spring来管理 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 配置JDBC事务控制，由mybatis进行管理 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 配置数据源，采用mybatis连接池 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="4-2-Settings"><a href="#4-2-Settings" class="headerlink" title="4.2 Settings"></a>4.2 Settings</h3><h3 id="4-3-typeAliases"><a href="#4-3-typeAliases" class="headerlink" title="4.3 typeAliases"></a>4.3 typeAliases</h3><p>对po类进行别名的定义,在开发中会更加方便<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 单个别名定义 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- &lt;typeAlias type="com.itheima.mybatis.po.User" alias="user"/&gt; --&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 批量别名定义（推荐） --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- package：指定包名称来为该包下的po类声明别名，默认的别名就是类名（首字母大小写都可） --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.itheima.mybatis.po"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="4-4-Mapper"><a href="#4-4-Mapper" class="headerlink" title="4.4 Mapper"></a>4.4 Mapper</h3><p>注册指定包下的映射文件<br><strong><em>注意：此种方法要求mapper接口和mapper映射文件要名称相同，且放到同一个目录下；</em></strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"User.xml"</span> /&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;mapper resource="mapper/UserMapper.xml" /&gt; --&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 批量加载映射文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.yao.mybatis.mapper"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="五-映射文件"><a href="#五-映射文件" class="headerlink" title="五 . 映射文件"></a>五 . 映射文件</h2><h3 id="5-1-输入映射"><a href="#5-1-输入映射" class="headerlink" title="5.1 输入映射"></a>5.1 输入映射</h3><p>可分为四种:</p>
<ul>
<li>简单类型</li>
<li>Pojo类型</li>
<li>包装Pojo类型</li>
<li>Map</li>
</ul>
<h3 id="5-2-输出映射"><a href="#5-2-输出映射" class="headerlink" title="5.2 输出映射"></a>5.2 输出映射</h3><h4 id="5-2-1-resultType"><a href="#5-2-1-resultType" class="headerlink" title="5.2.1 resultType"></a>5.2.1 resultType</h4><h4 id="5-2-2-resultMap"><a href="#5-2-2-resultMap" class="headerlink" title="5.2.2    resultMap"></a>5.2.2    resultMap</h4><p>resultMap可以进行高级结果映射<strong>（一对一、一对多映射)</strong></p>
<ul>
<li><p>使用resultType进行结果映射时，需要查询出的列名和映射的对象的属性名一致，才能映射成功。</p>
</li>
<li><p>如果查询的列名和对象的属性名全部不一致，那么映射的对象为空。</p>
</li>
<li><p>如果查询的列名和对象的属性名有一个一致，那么映射的对象不为空，但是只有映射正确那一个属性才有值。</p>
</li>
<li><p>如果查询的sql的列名有别名，那么这个别名就是和属性映射的列名。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;!-- resultMap入门 --&gt;</div><div class="line">	&lt;!-- id标签：专门为查询结果中唯一列映射 --&gt;</div><div class="line">	&lt;!-- result标签：映射查询结果中的普通列 --&gt;</div><div class="line">	&lt;resultMap type=&quot;user&quot; id=&quot;UserRstMap&quot;&gt;</div><div class="line">		&lt;id column=&quot;id_&quot; property=&quot;id&quot; /&gt;</div><div class="line">		&lt;result column=&quot;username_&quot; property=&quot;username&quot; /&gt;</div><div class="line">		&lt;result column=&quot;sex_&quot; property=&quot;sex&quot; /&gt;</div><div class="line">	&lt;/resultMap&gt;</div><div class="line"></div><div class="line">	&lt;select id=&quot;findUserRstMap&quot; parameterType=&quot;int&quot; resultMap=&quot;UserRstMap&quot;&gt;</div><div class="line">		Select id id_,username username_,sex sex_ from user where id = #&#123;id&#125;</div><div class="line">	&lt;/select&gt;</div></pre></td></tr></table></figure>
<h3 id="5-3-动态sql"><a href="#5-3-动态sql" class="headerlink" title="5.3 动态sql"></a>5.3 动态sql</h3><p>在mybatis中，它提供了一些动态sql标签，可以更快地进行mybatis的开发，这些动态sql可以提高sql的可重用性。<br>常用的动态sql标签：if标签、where标签、sql片段、foreach标签</p>
<ul>
<li><p>If标签：作为判断入参来使用的，如果符合条件，则把if标签体内的SQL拼接上。<br>注意：用if进行判断是否为空时，不仅要判断null，也要判断空字符串‘’；</p>
</li>
<li><p>Where标签：会去掉条件中的第一个and符号。</p>
</li>
<li><p>向sql传递数组或List时，mybatis使用foreach解析数组里的参数并拼接到SQL中。</p>
</li>
</ul>
<p><strong><em>sql片段</em></strong><br>sql片段可提高代码的重用性。<br>sql片段需要先定义后使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 定义sql片段 --&gt;</div><div class="line">	&lt;!-- sql片段内，可以定义sql语句中任何部分 --&gt;</div><div class="line">	&lt;!-- sql片段内，最好不用将where和select关键字声明在内 --&gt;</div><div class="line">	&lt;sql id=&quot;whereClause&quot;&gt;</div><div class="line">		&lt;!-- if标签：可以对输入的参数进行判断 --&gt;</div><div class="line">		&lt;!-- test:指定判断表达式 --&gt;</div><div class="line">		&lt;if test=&quot;user != null&quot;&gt;</div><div class="line">			&lt;if test=&quot;user.username != null and user.username != &apos;&apos;&quot;&gt;</div><div class="line">				AND username LIKE &apos;%$&#123;user.username&#125;%&apos;</div><div class="line">			&lt;/if&gt;</div><div class="line">			&lt;if test=&quot;user.sex != null and user.sex != &apos;&apos;&quot;&gt;</div><div class="line">				AND sex = #&#123;user.sex&#125;</div><div class="line">			&lt;/if&gt;</div><div class="line">		&lt;/if&gt;</div><div class="line">		</div><div class="line">&lt;!-- 综合查询，查询用户列表 --&gt;</div><div class="line">	&lt;select id=&quot;findUserList&quot; parameterType=&quot;com.yao.mybatis.po.UserQueryVO&quot;</div><div class="line">		resultType=&quot;user&quot;&gt;</div><div class="line">		SELECT * FROM user</div><div class="line">		&lt;!-- where标签：默认去掉后面第一个AND，如果没有参数，则把自己干掉 --&gt;</div><div class="line">		&lt;where&gt;</div><div class="line">			&lt;!-- 引入sql片段 --&gt;</div><div class="line">			&lt;include refid=&quot;whereClause&quot; /&gt;</div><div class="line">		&lt;/where&gt;</div><div class="line">	&lt;/select&gt;</div><div class="line"></div><div class="line">	&lt;!-- 综合查询用户总数 --&gt;</div><div class="line">	&lt;select id=&quot;findUserCount&quot; parameterType=&quot;com.yao.mybatis.po.UserQueryVO&quot;</div><div class="line">		resultType=&quot;int&quot;&gt;</div><div class="line">		SELECT count(*) FROM user</div><div class="line">		&lt;!-- where标签：默认去掉后面第一个AND，如果没有参数，则把自己干掉 --&gt;</div><div class="line">		&lt;where&gt;</div><div class="line">			&lt;!-- 引入sql片段 --&gt;</div><div class="line">			&lt;include refid=&quot;whereClause&quot; /&gt;</div><div class="line">		&lt;/where&gt;</div><div class="line">	&lt;/select&gt;</div></pre></td></tr></table></figure></p>
<p><strong><em><code>&lt;for:each&gt;</code>标签</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;if test=&quot;idList != null&quot;&gt;</div><div class="line">			&lt;!-- AND id IN (#&#123;id&#125;,#&#123;id&#125;,#&#123;id&#125;) --&gt;</div><div class="line"></div><div class="line">			&lt;!-- collection：表示pojo中集合属性的属性名称 --&gt;</div><div class="line">			&lt;!-- item:为遍历出的结果声明一个变量名称 --&gt;</div><div class="line">			&lt;!-- open：遍历开始时，需要拼接的字符串 --&gt;</div><div class="line">			&lt;!-- close:遍历结束时，需要拼接的字符串 --&gt;</div><div class="line">			&lt;!-- separator：遍历中间需要拼接的连接符 --&gt;</div><div class="line">			AND id IN</div><div class="line">			&lt;foreach collection=&quot;idList&quot; item=&quot;id&quot; open=&quot;(&quot; close=&quot;)&quot;</div><div class="line">				separator=&quot;,&quot;&gt;</div><div class="line">				#&#123;id&#125;</div><div class="line">			&lt;/foreach&gt;</div><div class="line">		&lt;/if&gt;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/15/Mybatis学习一/" data-id="cj70kwxbj0009i4tx69s5cal8" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-Mybatis学习" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/05/14/Mybatis学习/" class="article-date">
  <time datetime="2017-05-14T14:21:09.349Z" itemprop="datePublished">2017-05-14</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/05/14/Mybatis学习/">Mybatis学习</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>标签 ： Mybatis</p>
<hr>
<h2 id="一-简介"><a href="#一-简介" class="headerlink" title="一 . 简介"></a>一 . 简介</h2><p>mybatis就是一个封装来jdbc的持久层框架，它和hibernate都属于ORM框架，但是具体的说，hibernate是一个完全的orm框架，而mybatis是一个不完全的orm框架。</p>
<p>Mybatis可以让编写程序的人只关注sql本身，而不需要去关注如连接的创建、statement的创建等操作。</p>
<p>Mybatis会将<strong>输入参数、输出结果</strong>进行映射。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">			Connection connection = <span class="keyword">null</span>;</div><div class="line">			PreparedStatement preparedStatement = <span class="keyword">null</span>;</div><div class="line">			ResultSet resultSet = <span class="keyword">null</span>;</div><div class="line">			</div><div class="line">			<span class="keyword">try</span> &#123;</div><div class="line">				<span class="comment">//1、加载数据库驱动</span></div><div class="line">				Class.forName(<span class="string">"com.mysql.jdbc.Driver"</span>);</div><div class="line">				<span class="comment">//2、通过驱动管理类获取数据库链接</span></div><div class="line">				connection =  DriverManager.getConnection(<span class="string">"jdbc:mysql://localhost:3306/mybatis?characterEncoding=utf-8"</span>, <span class="string">"root"</span>, <span class="string">"root"</span>);</div><div class="line">				<span class="comment">//3、定义sql语句 ?表示占位符</span></div><div class="line">			String sql = <span class="string">"select * from user where username = ?"</span>;</div><div class="line">				<span class="comment">//4、获取预处理statement</span></div><div class="line">				preparedStatement = connection.prepareStatement(sql);</div><div class="line">				<span class="comment">//5、设置参数，第一个参数为sql语句中参数的序号（从1开始），第二个参数为设置的参数值</span></div><div class="line">				preparedStatement.setString(<span class="number">1</span>, <span class="string">"王五"</span>);</div><div class="line">				<span class="comment">//6、向数据库发出sql执行查询，查询出结果集</span></div><div class="line">				resultSet =  preparedStatement.executeQuery();</div><div class="line">				<span class="comment">//7、遍历查询结果集</span></div><div class="line">				<span class="keyword">while</span>(resultSet.next())&#123;</div><div class="line">					System.out.println(resultSet.getString(<span class="string">"id"</span>)+<span class="string">"  "</span>+resultSet.getString(<span class="string">"username"</span>));</div><div class="line">				&#125;</div><div class="line">			&#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">				e.printStackTrace();</div><div class="line">			&#125;<span class="keyword">finally</span>&#123;</div><div class="line">				<span class="comment">//8、释放资源</span></div><div class="line">				<span class="keyword">if</span>(resultSet!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						resultSet.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(preparedStatement!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						preparedStatement.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line">				<span class="keyword">if</span>(connection!=<span class="keyword">null</span>)&#123;</div><div class="line">					<span class="keyword">try</span> &#123;</div><div class="line">						connection.close();</div><div class="line">					&#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">						<span class="comment">// TODO Auto-generated catch block</span></div><div class="line">						e.printStackTrace();</div><div class="line">					&#125;</div><div class="line">				&#125;</div><div class="line"></div><div class="line">			&#125;</div><div class="line"></div><div class="line">		&#125;</div></pre></td></tr></table></figure>
<p>上述原始的Jdbc操作中，存在硬编码和频繁连接数据库的问题。<br>需解决此问题：</p>
<ul>
<li>在创建连接时使用全局配置文件；</li>
<li>在执行statement时配置映射文件；</li>
<li>在频繁连接和关闭数据库连接时，要使用数据库连接池。</li>
</ul>
<h2 id="二-Mybatis框架原理"><a href="#二-Mybatis框架原理" class="headerlink" title="二 . Mybatis框架原理"></a>二 . Mybatis框架原理</h2><ul>
<li><p>mybatis配置文件，包括Mybatis全局配置文件和Mybatis映射文件，<br>其中<strong>全局配置文件</strong>配置了数据源、事务等信息；<strong>映射文件</strong>配置了SQL执行相关的信息。</p>
</li>
<li><p>Mybatis通过读取配置文件信息（全局配置文件和映射文件），构造出SqlSessionFactory，即会话工厂。然后通过SqlSessionFactory，可以创建SqlSession即会话。Mybatis是通过SqlSession来操作数据库的。</p>
</li>
<li><p>SqlSession本身不能直接操作数据库，它是通过底层的Executor执行器接口来操作数据库的。Executor接口有两个实现类，一个是普通执行器，一个是<strong>缓存执行器（默认）</strong>。</p>
</li>
</ul>
<p><strong>注意：</strong>在执行<strong><em>增删改</em></strong>的操作时需要对SqlSession执行commit操作!!!</p>
<h2 id="三-原始Dao开发方式和Mapper代理开发方式"><a href="#三-原始Dao开发方式和Mapper代理开发方式" class="headerlink" title="三 . 原始Dao开发方式和Mapper代理开发方式"></a>三 . 原始Dao开发方式和Mapper代理开发方式</h2><p>原始Dao开发会存在一些模板代码和硬编码，因此选择Mapper代理开发方式。</p>
<p>Mapper代理开发方式的开发步骤：</p>
<ol>
<li>根据需求创建PO类</li>
<li>编写全局配置文件 —-  SqlMapConfig.xml</li>
<li>根据需求编写映射文件 —- UserMapper.xml</li>
<li>加载映射文件</li>
<li>编写Mapper接口</li>
</ol>
<p>第一步和第二步省略。SqlMapConfig.xml中配置了数据源和事务管理，并加载映射文件.<br><strong>根据需求编写映射文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</div><div class="line"><span class="meta">&lt;!DOCTYPE mapper    </span></div><div class="line">PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"    </div><div class="line">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;</div><div class="line"><span class="comment">&lt;!-- namespace：此时用mapper代理方式，它的值必须等于对应mapper接口的全限定名  --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"cn.yao.mybatis.mapper.UserMapper"</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 根据用户ID，查询用户信息 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[id]：statement的id，要求在命名空间内唯一  </div><div class="line">		[parameterType]：入参的java类型，可是是简单类型、POJO、HashMap</div><div class="line">		[resultType]：查询出的单条结果集对应的java类型</div><div class="line">		[#&#123;&#125;]： 表示一个占位符?</div><div class="line">		[#&#123;id&#125;]：表示该占位符待接收参数的名称为id。注意：如果参数为简单类型时，#&#123;&#125;里面的参数名称可以是任意定义</div><div class="line">	 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUserById"</span> <span class="attr">parameterType</span>=<span class="string">"int"</span> <span class="attr">resultType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		SELECT * FROM USER WHERE id = #&#123;id&#125;</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">	</div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 根据用户名称模糊查询用户信息列表 --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[$&#123;&#125;]：表示拼接SQL字符串，即不加解释的原样输出</div><div class="line">	 	[$&#123;value&#125;]：表示要拼接的是简单类型参数。</div><div class="line">		 注意：</div><div class="line">		1、如果参数为简单类型时，$&#123;&#125;里面的参数名称必须为value </div><div class="line">		2、$&#123;&#125;会引起SQL注入，一般情况下不推荐使用。但是有些场景必须使用$&#123;&#125;，比如order by $&#123;colname&#125;</div><div class="line">	--&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"findUsersByName"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span> <span class="attr">resultType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		SELECT * FROM USER WHERE username LIKE '%$&#123;value&#125;%'</div><div class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></div><div class="line">	</div><div class="line">	<span class="comment">&lt;!-- 添加用户之自增主键返回（selectKey方式） --&gt;</span></div><div class="line">	<span class="comment">&lt;!-- </span></div><div class="line">		[selectKey标签]：通过select查询来生成主键</div><div class="line">		[keyProperty]：指定存放生成主键的属性</div><div class="line">		[resultType]：生成主键所对应的Java类型</div><div class="line">		[order]：指定该查询主键SQL语句的执行顺序，相对于insert语句，此时选用AFTER</div><div class="line">		[last_insert_id]：MySQL的函数，要配合insert语句一起使用</div><div class="line">	 --&gt;</div><div class="line">	<span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"insertUser"</span> <span class="attr">parameterType</span>=<span class="string">"cn.yao.mybatis.po.User"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"id"</span> <span class="attr">resultType</span>=<span class="string">"int"</span> <span class="attr">order</span>=<span class="string">"AFTER"</span>&gt;</span></div><div class="line">			SELECT LAST_INSERT_ID()</div><div class="line">		<span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span></div><div class="line">		INSERT INTO USER(username,sex,birthday,address) VALUES (#&#123;username&#125;,#&#123;sex&#125;,#&#123;birthday&#125;,#&#123;address&#125;)</div><div class="line">	<span class="tag">&lt;/<span class="name">insert</span>&gt;</span></div><div class="line">	</div><div class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>加载mapper映射文件</strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"mapper/UserMapper.xml"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p><strong>编写mapper接口</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> </span>&#123;</div><div class="line">	<span class="comment">//根据用户ID来查询用户信息</span></div><div class="line">	<span class="function"><span class="keyword">public</span> User <span class="title">findUserById</span><span class="params">(<span class="keyword">int</span> id)</span></span>;</div><div class="line">	<span class="comment">//根据用户名称来模糊查询用户信息列表</span></div><div class="line">	<span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUsersByName</span><span class="params">(String username)</span></span>;</div><div class="line">	<span class="comment">//添加用户</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertUser</span><span class="params">(User user)</span></span>;</div></pre></td></tr></table></figure></p>
<h2 id="四-全局配置文件"><a href="#四-全局配置文件" class="headerlink" title="四 . 全局配置文件"></a>四 . 全局配置文件</h2><p>全局配置文件的命名可以是任意的，本文中就使用SqlMapConfig.xml来表示。</p>
<p><strong><em>SqlMapConfig.xml的配置内容和顺序如下（顺序不能乱）：</em></strong><br>Properties（属性）<br>Settings（全局参数设置）<br>typeAliases（类型别名）<br>typeHandlers（类型处理器）<br>objectFactory（对象工厂）<br>plugins（插件）<br>environments（环境信息集合）<br>———-environment（单个环境信息）<br>——————-transactionManager（事物）<br>——————-dataSource（数据源）<br>mappers（映射器）</p>
<h3 id="4-1-Properties"><a href="#4-1-Properties" class="headerlink" title="4.1 Properties"></a>4.1 Properties</h3><p>Db.properties<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">db.driver=com.mysql.jdbc.Driver</div><div class="line">db.url=jdbc:mysql://localhost:3306/mybatis?useUnicode=true&amp;characterEncoding=utf8</div><div class="line">db.username=root</div><div class="line">db.password=root</div></pre></td></tr></table></figure></p>
<p>SqlMapConfig.xml<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></div><div class="line"></div><div class="line">	<span class="comment">&lt;!-- 加载java的配置文件或者声明属性信息 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"db.properties"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"db.username"</span> <span class="attr">value</span>=<span class="string">"123"</span> /&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 配置mybatis的环境信息，与spring整合，该信息由spring来管理 --&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">"development"</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 配置JDBC事务控制，由mybatis进行管理 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"JDBC"</span>&gt;</span><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></div><div class="line">			<span class="comment">&lt;!-- 配置数据源，采用mybatis连接池 --&gt;</span></div><div class="line">			<span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">"POOLED"</span>&gt;</span></div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"driver"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.driver&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"url"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.url&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.username&#125;"</span> /&gt;</span></div><div class="line">				</div><div class="line">				<span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"$&#123;db.password&#125;"</span> /&gt;</span></div><div class="line">			<span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></div><div class="line">		<span class="tag">&lt;/<span class="name">environment</span>&gt;</span></div><div class="line">	<span class="tag">&lt;/<span class="name">environments</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="4-2-Settings"><a href="#4-2-Settings" class="headerlink" title="4.2 Settings"></a>4.2 Settings</h3><h3 id="4-3-typeAliases"><a href="#4-3-typeAliases" class="headerlink" title="4.3 typeAliases"></a>4.3 typeAliases</h3><p>对po类进行别名的定义,在开发中会更加方便<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">		<span class="comment">&lt;!-- 单个别名定义 --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- &lt;typeAlias type="com.itheima.mybatis.po.User" alias="user"/&gt; --&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 批量别名定义（推荐） --&gt;</span></div><div class="line">		<span class="comment">&lt;!-- package：指定包名称来为该包下的po类声明别名，默认的别名就是类名（首字母大小写都可） --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.itheima.mybatis.po"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="4-4-Mapper"><a href="#4-4-Mapper" class="headerlink" title="4.4 Mapper"></a>4.4 Mapper</h3><p>注册指定包下的映射文件<br><strong><em>注意：此种方法要求mapper接口和mapper映射文件要名称相同，且放到同一个目录下；</em></strong><br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"User.xml"</span> /&gt;</span></div><div class="line">	<span class="comment">&lt;!-- &lt;mapper resource="mapper/UserMapper.xml" /&gt; --&gt;</span></div><div class="line"></div><div class="line">		<span class="comment">&lt;!-- 批量加载映射文件 --&gt;</span></div><div class="line">		<span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.yao.mybatis.mapper"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="五-映射文件"><a href="#五-映射文件" class="headerlink" title="五 . 映射文件"></a>五 . 映射文件</h2><h3 id="5-1-输入映射"><a href="#5-1-输入映射" class="headerlink" title="5.1 输入映射"></a>5.1 输入映射</h3><p>可分为四种:</p>
<ul>
<li>简单类型</li>
<li>Pojo类型</li>
<li>包装Pojo类型</li>
<li>Map</li>
</ul>
<h3 id="5-2-输出映射"><a href="#5-2-输出映射" class="headerlink" title="5.2 输出映射"></a>5.2 输出映射</h3><h4 id="5-2-1-resultType"><a href="#5-2-1-resultType" class="headerlink" title="5.2.1 resultType"></a>5.2.1 resultType</h4><h4 id="5-2-2-resultMap"><a href="#5-2-2-resultMap" class="headerlink" title="5.2.2    resultMap"></a>5.2.2    resultMap</h4><p>resultMap可以进行高级结果映射<strong>（一对一、一对多映射)</strong></p>
<ul>
<li><p>使用resultType进行结果映射时，需要查询出的列名和映射的对象的属性名一致，才能映射成功。</p>
</li>
<li><p>如果查询的列名和对象的属性名全部不一致，那么映射的对象为空。</p>
</li>
<li><p>如果查询的列名和对象的属性名有一个一致，那么映射的对象不为空，但是只有映射正确那一个属性才有值。</p>
</li>
<li><p>如果查询的sql的列名有别名，那么这个别名就是和属性映射的列名。</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">&lt;!-- resultMap入门 --&gt;</div><div class="line">	&lt;!-- id标签：专门为查询结果中唯一列映射 --&gt;</div><div class="line">	&lt;!-- result标签：映射查询结果中的普通列 --&gt;</div><div class="line">	&lt;resultMap type=&quot;user&quot; id=&quot;UserRstMap&quot;&gt;</div><div class="line">		&lt;id column=&quot;id_&quot; property=&quot;id&quot; /&gt;</div><div class="line">		&lt;result column=&quot;username_&quot; property=&quot;username&quot; /&gt;</div><div class="line">		&lt;result column=&quot;sex_&quot; property=&quot;sex&quot; /&gt;</div><div class="line">	&lt;/resultMap&gt;</div><div class="line"></div><div class="line">	&lt;select id=&quot;findUserRstMap&quot; parameterType=&quot;int&quot; resultMap=&quot;UserRstMap&quot;&gt;</div><div class="line">		Select id id_,username username_,sex sex_ from user where id = #&#123;id&#125;</div><div class="line">	&lt;/select&gt;</div></pre></td></tr></table></figure>
<h3 id="5-3-动态sql"><a href="#5-3-动态sql" class="headerlink" title="5.3 动态sql"></a>5.3 动态sql</h3><p>在mybatis中，它提供了一些动态sql标签，可以更快地进行mybatis的开发，这些动态sql可以提高sql的可重用性。<br>常用的动态sql标签：if标签、where标签、sql片段、foreach标签</p>
<ul>
<li><p>If标签：作为判断入参来使用的，如果符合条件，则把if标签体内的SQL拼接上。<br>注意：用if进行判断是否为空时，不仅要判断null，也要判断空字符串‘’；</p>
</li>
<li><p>Where标签：会去掉条件中的第一个and符号。</p>
</li>
<li><p>向sql传递数组或List时，mybatis使用foreach解析数组里的参数并拼接到SQL中。</p>
</li>
</ul>
<p><strong><em>sql片段</em></strong><br>sql片段可提高代码的重用性。<br>sql片段需要先定义后使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">&lt;!-- 定义sql片段 --&gt;</div><div class="line">	&lt;!-- sql片段内，可以定义sql语句中任何部分 --&gt;</div><div class="line">	&lt;!-- sql片段内，最好不用将where和select关键字声明在内 --&gt;</div><div class="line">	&lt;sql id=&quot;whereClause&quot;&gt;</div><div class="line">		&lt;!-- if标签：可以对输入的参数进行判断 --&gt;</div><div class="line">		&lt;!-- test:指定判断表达式 --&gt;</div><div class="line">		&lt;if test=&quot;user != null&quot;&gt;</div><div class="line">			&lt;if test=&quot;user.username != null and user.username != &apos;&apos;&quot;&gt;</div><div class="line">				AND username LIKE &apos;%$&#123;user.username&#125;%&apos;</div><div class="line">			&lt;/if&gt;</div><div class="line">			&lt;if test=&quot;user.sex != null and user.sex != &apos;&apos;&quot;&gt;</div><div class="line">				AND sex = #&#123;user.sex&#125;</div><div class="line">			&lt;/if&gt;</div><div class="line">		&lt;/if&gt;</div><div class="line">		</div><div class="line">&lt;!-- 综合查询，查询用户列表 --&gt;</div><div class="line">	&lt;select id=&quot;findUserList&quot; parameterType=&quot;com.yao.mybatis.po.UserQueryVO&quot;</div><div class="line">		resultType=&quot;user&quot;&gt;</div><div class="line">		SELECT * FROM user</div><div class="line">		&lt;!-- where标签：默认去掉后面第一个AND，如果没有参数，则把自己干掉 --&gt;</div><div class="line">		&lt;where&gt;</div><div class="line">			&lt;!-- 引入sql片段 --&gt;</div><div class="line">			&lt;include refid=&quot;whereClause&quot; /&gt;</div><div class="line">		&lt;/where&gt;</div><div class="line">	&lt;/select&gt;</div><div class="line"></div><div class="line">	&lt;!-- 综合查询用户总数 --&gt;</div><div class="line">	&lt;select id=&quot;findUserCount&quot; parameterType=&quot;com.yao.mybatis.po.UserQueryVO&quot;</div><div class="line">		resultType=&quot;int&quot;&gt;</div><div class="line">		SELECT count(*) FROM user</div><div class="line">		&lt;!-- where标签：默认去掉后面第一个AND，如果没有参数，则把自己干掉 --&gt;</div><div class="line">		&lt;where&gt;</div><div class="line">			&lt;!-- 引入sql片段 --&gt;</div><div class="line">			&lt;include refid=&quot;whereClause&quot; /&gt;</div><div class="line">		&lt;/where&gt;</div><div class="line">	&lt;/select&gt;</div></pre></td></tr></table></figure></p>
<p><strong><em><code>&lt;for:each&gt;</code>标签</em></strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">&lt;if test=&quot;idList != null&quot;&gt;</div><div class="line">			&lt;!-- AND id IN (#&#123;id&#125;,#&#123;id&#125;,#&#123;id&#125;) --&gt;</div><div class="line"></div><div class="line">			&lt;!-- collection：表示pojo中集合属性的属性名称 --&gt;</div><div class="line">			&lt;!-- item:为遍历出的结果声明一个变量名称 --&gt;</div><div class="line">			&lt;!-- open：遍历开始时，需要拼接的字符串 --&gt;</div><div class="line">			&lt;!-- close:遍历结束时，需要拼接的字符串 --&gt;</div><div class="line">			&lt;!-- separator：遍历中间需要拼接的连接符 --&gt;</div><div class="line">			AND id IN</div><div class="line">			&lt;foreach collection=&quot;idList&quot; item=&quot;id&quot; open=&quot;(&quot; close=&quot;)&quot;</div><div class="line">				separator=&quot;,&quot;&gt;</div><div class="line">				#&#123;id&#125;</div><div class="line">			&lt;/foreach&gt;</div><div class="line">		&lt;/if&gt;</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/05/14/Mybatis学习/" data-id="cj70kwxbh0008i4tx5dk6dkni" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; __('prev')</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/">__('next') &raquo;</a>
  </nav>
</section>
        
          <aside id="sidebar">
  
    

  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/07/">July 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/04/">April 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/08/30/Python3 学习笔记/">Python3 学习笔记</a>
          </li>
        
          <li>
            <a href="/2017/08/15/《大型网站系统与Java中间件实践》读书笔记/">《大型网站系统与Java中间件实践》读书笔记</a>
          </li>
        
          <li>
            <a href="/2017/08/12/Hadoop/">Hadoop</a>
          </li>
        
          <li>
            <a href="/2017/08/02/单点登录系统/">单点登录系统</a>
          </li>
        
          <li>
            <a href="/2017/08/02/Redis/">Redis</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 Yao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>